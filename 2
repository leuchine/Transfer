1
 a priority queue—binary heaps in Chapter 6, red-black trees in Chapter 13,1 and Fibonacci heaps in Chapter 19. In each of these data structures, at least one important operation took O.lg n/ time, either worst case or amortized. In fact, because each
2
 0 < ˛ Ä 1? Compare these running times to the amortized costs of these operations for a Fibonacci heap. b. Show how to compute shortest paths from a single source on an -dense directed graph G D .V; E/ with no negative-weight edges in O.E/ time.
3
 T. C. Hu and M. T. Shing. Computation of matrix chain products. Part I. SIAM Journal on Computing, 11(2):362–373, 1982. [183] T. C. Hu and M. T. Shing. Computation of matrix chain products. Part II. SIAM Journal on Computing, 13(2):228–251,
4
 work for directed graphs that contain cycles? Explain. 26-3 Algorithmic consulting Professor Gore wants to open up an algorithmic consulting company. He has identiﬁed n important subareas of algorithms (roughly corresponding to different portions
5
 of each card in a deck and distribute the card into one of 12 bins depending on which place has been punched. An operator can then gather the cards bin by bin, so that cards with the ﬁrst place punched are on top of cards with the second place
6
 accurate count of the degree of x. Lemma 19.1 Let x be any node in a Fibonacci heap, and suppose that x:degree D k. Let y1 ; y2 ; : : : ; yk denote the children of x in the order in which they were linked to x, 0 and yi :degree i 2 for from the
7
 j contains a pointer to the head of the list of all stored elements that hash to j ; if there are no such elements, slot j contains NIL.  258  Chapter 11 Hash Tables  The dictionary operations on a hash table T are easy to implement when collisions
8
 loads a thread onto a processor for execution and switches it out when another thread needs to run. Although the operating system allows programmers to create and destroy threads, these operations are comparatively slow. Thus, for most
9
 T .1/ T .1/ T .1/ T .1/ T .1/ T .1/  …  T .1/ T .1/ T .1/  ‚.nlog4 3 /  nlog4 3 (d)  Total: O.n2 /  Figure 4.5 Constructing a recursion tree for the recurrence T .n/ D 3T .n=4/ C cn2 . Part (a) shows T .n/, which progressively expands in (b)–(d) to
10
 use a recursive subroutine that solves an m n problem by recursively solving either an .m 1/ n or an m .n 1/ subproblem. (Hint: Think about M AX H EAPIFY.) Deﬁne T .p/, where p D m C n, to be the maximum running time of E XTRACT-M IN on any m n Young
11
 algorithm for, 850, 897 ﬁnding an initial solution in, 886–891 fundamental theorem of, 892 interior-point methods for, 850, 897 Karmarkar’s algorithm for, 897 and maximum ﬂow, 860–861 and minimum-cost circulation, 896 pr. and minimum-cost ﬂow,
12
 book, thereby enabling scientists to accomplish tasks while using resources efﬁciently. The savings are in time, both human and machine, and in money, as more information can be extracted from laboratory techniques. The Internet enables people all
13
 MacDraw Pro is legacy software, having not been marketed for over a decade now. Happily, we still have a couple of Macintoshes that can run the Classic environment under OS 10.4, and hence they can run MacDraw Pro—mostly. Even under the
14
 the interval Œu:d; u:f . By Corollary 22.8, all be a descendant of u.  609  must after  Classiﬁcation of edges Another interesting property of depth-ﬁrst search is that the search can be used to classify the edges of the input graph G D .V; E/. The
15
 Wang and Lin [347] designed a hardware-pipelined version of van Emde Boas trees, which achieves constant amortized time per operation and uses O.lg lg u/ stages in the pipeline. A lower bound by Pˇatras¸cu and Thorup [273, 274] for ﬁnding
16
 Online, July 2008. [46] Patrick Billingsley. Probability and Measure. John Wiley & Sons, second edition, 1986. [47] Guy E. Blelloch. Scan Primitives and Parallel Vector Models. PhD thesis, Department of Electrical Engineering and Computer Science,
17
 S. B. Mitchell. Guillotine subdivisions approximate polygonal subdivisions: A simple polynomial-time approximation scheme for geometric TSP, k-MST, and related problems. SIAM Journal on Computing, 28(4):1298–1309, 1999. [258] Louis Monier.
18
 x produces tree T 0 , and then swapping leaves b and y produces tree T 00 . Since each swap does not increase the cost, the resulting tree T 00 is also an optimal tree.  in which x and y are sibling leaves of maximum depth. (Note that if x D b but y ¤
19
 A.BC / D .AB/C for compatible matrices A, B, and C . Matrix multiplication distributes over addition: A.B C C / D AB C AC ; .B C C /D D BD C CD : For nÂ> 1, multiplication Ã Âof n Ãn matrices is not commutative. For example, if 0 1 0 0 AD
20
 time of this algorithm be? 4.2-5 V. Pan has discovered a way of multiplying 68 68 matrices using 132,464 multiplications, a way of multiplying 70 70 matrices using 143,640 multiplications, and a way of multiplying 72 72 matrices using 155,424
21
 of reductions. We illustrate this methodology by showing that two formula-satisﬁability problems are NP-complete. With additional reductions, we show in Section 34.5 a variety of other problems to be NP-complete.  34.1 Polynomial time We begin
22
 are one-liners, taking constant time:  550  Chapter 20 van Emde Boas Trees  V EB-T REE -M INIMUM .V /  1  return V:min  V EB-T REE -M AXIMUM .V /  1  return V:max  Determining whether a value is in the set The procedure V EB-T REE -M EMBER .V;
23
 Convert the following linear program into standard form: minimize subject to  2x1 x1 3x1  C 7x2  C x3 x3  C x2  x2 x3  D  7 24 0 Ä 0 :  858  Chapter 29 Linear Programming  29.1-5 Convert the following linear program into slack form: maximize
24
 h, which are heavily shaded, are the roots of the depth-ﬁrst trees produced by the depth-ﬁrst search of G T . (c) The acyclic component graph G SCC obtained by contracting all edges within each strongly connected component of G so that only a single
25
 bye D bl =ale ; which proves the second statement. Similarly, using line 9 for each i 2 By we have xN i D byi D bi ai e bye ;  feg,  which proves the third statement. The formal simplex algorithm We are now ready to formalize the simplex algorithm,
26
 notions of trees. This section presents deﬁnitions and mathematical properties of several kinds of trees. Sections 10.4 and 22.1 describe how we can represent trees in computer memory. B.5.1 Free trees As deﬁned in Section B.4, a free tree is a
27
 interest: 1. A diagonal matrix has aij D 0 whenever i ¤ j . Because all of the off-diagonal elements are zero, we can specify the matrix by listing the elements along the diagonal:  ˙a  11  0 :: :  diag.a11 ; a22 ; : : : ; ann / D  0 2. The n  0
28
 changes and performing a left rotation on x:p, we can remove the extra black on x, making it singly black, without violating any of the red-black properties. Setting x to be the root causes the while loop to terminate when it tests the loop condition.
29
 per call to D ISCHARGE. As we have observed, D ISCHARGE is called O.V 3 / times, and thus the total time spent performing nonsaturating pushes is O.V 3 /. The running time of R ELABEL -T O -F RONT is therefore O.V 3 C VE/, which is O.V 3 /.
30
 choice of the hash function h drawn at random from the family H . Show that an -universal family of hash functions must have 1 jBj  1 : jU j  11.3-6 ? Let U be the set of n-tuples of values drawn from Zp , and let B D Zp , where p is prime. Deﬁne the
31
 undirected graph for use in Problem 22-2. The articulation points are the heavily shaded vertices, the bridges are the heavily shaded edges, and the biconnected components are the edges in the shaded regions, with a bcc numbering shown.  these
32
 has to be an OR of 3 literals. The second step of the reduction converts each clause i0 into conjunctive normal form. We construct a truth table for i0 by evaluating all possible assignments to its variables. Each row of the truth table consists of a
33
 of a red-black tree, however, because its branching factor, and hence the base of the logarithm that expresses its height, can be much larger. Therefore, we can also use B-trees to implement many dynamic-set operations in time O.lg n/. B-trees
34
 NQUEUE .Q; 1/, E NQUEUE .Q; 3/, D EQUEUE .Q/, E NQUEUE .Q; 8/, and D EQUEUE .Q/ on an initially empty queue Q stored in array QŒ1 : : 6. 10.1-4 Rewrite E NQUEUE and D EQUEUE to detect underﬂow and overﬂow of a queue.  236  Chapter 10 Elementary Data
35
 as Figure 33.9 shows, the right chain of CH.Q/. To construct the left chain, we start at pk and choose pkC1 as the point with the smallest polar angle with respect to pk , but from the negative x-axis. We continue on, forming the left chain
36
 “big-omega of g of n” or sometimes just “omega of g of n”) the set of functions .g.n// D ff .n/ W there exist positive constants c and n0 such that 0 Ä cg.n/ Ä f .n/ for all n n0 g : Figure 3.1(c) shows the intuition behind -notation. For all values n
37
 the feasible solution x D . 5; 3; 0; 1; 4/, and by Lemma 24.8, x D .d 5; d 3; d; d 1; d 4/ is also a feasible solution for any constant d . If the Bellman-Ford algorithm returns FALSE, there is no feasible solution to the system of difference
38
 call a toss in which a ball falls into an empty bin a “hit.” We want to know the expected number n of tosses required to get b hits. Using the hits, we can partition the n tosses into stages. The ith stage consists of the tosses after the .i 1/st hit
39
 0 , we have jM j jM 0 j. In this section, we shall restrict our attention to ﬁnding maximum matchings in bipartite graphs: graphs in which the vertex set can be partitioned into V D L [ R, where L and R are disjoint and all edges in E go between L and
40
 time ‚.n/ to handle any sequence of n I NSERT, S EARCH, and D ELETE operations containing O.m/ I NSERT operations. Proof Since the number of insertions is O.m/, we have n D O.m/ and so ˛ D O.1/. The I NSERT and D ELETE operations take constant
41
 .u; / is actually a safe edge for A. We have A Â T 0 , since A Â T and .x; y/ 62 A; thus, A [ f.u; /g Â T 0 . Consequently, since T 0 is a minimum spanning tree, .u; / is safe for A. Theorem 23.1 gives us a better understanding of the workings of the
42
 this case, while the spawned child is computing P-F IB .n 1/, the parent may go on to compute P-F IB .n 2/ in line 4 in parallel with the spawned child. Since the P-F IB procedure is recursive, these two subroutine calls themselves create nested
43
 leaf x stores exactly one key in the attribute x:key. The keys in the leaves may appear in any order. Each internal node x contains a value x:small that is equal to the smallest key stored in any leaf in the subtree rooted at x. The root r contains
44
 minimum spanning trees and shortest paths. Journal of Computer and System Sciences, 48(3):533–551, 1994. [117] Matteo Frigo and Steven G. Johnson. The design and implementation of FFTW3. Proceedings of the IEEE, 93(2):216–231, 2005. [118] Matteo
45
 s to as the minimum number of edges in any path from vertex s to vertex ; if there is no path from s to , then ı.s; / D 1. We call a path of length ı.s; / from s to a shortest path2 from s to . Before showing that breadth-ﬁrst search correctly computes
46
 value is the answer 5 if i == k 6 return AŒq 7 elseif i < k 8 return R ANDOMIZED -S ELECT .A; p; q 1; i/ 9 else return R ANDOMIZED -S ELECT .A; q C 1; r; i k/ The R ANDOMIZED -S ELECT procedure works as follows. Line 1 checks for the base case of
47
 each of which increments x in line 3. Although it might seem that R ACE E XAMPLE should always print the value 2 (its serialization certainly does), it could instead print the value 1. Let’s see how this anomaly might occur. When a processor
48
 pairs of vertices that can have an edge between them in a residual network, the total number of critical edges during  730  Chapter 26 Maximum Flow  the entire execution of the Edmonds-Karp algorithm is O.VE/. Each augmenting path has at least one
49
 method used in Johnson’s algorithm. Letting w D min.u; /2E fw.u; /g, just deﬁne w.u; y / D w.u; / w for all edges .u; / 2 E. What is wrong with the professor’s method of reweighting? 25.3-5 Suppose that we run Johnson’s algorithm on a directed graph G
50
  786  Chapter 27 Multithreaded Algorithms  1,8  1,4  5,8  1,2  1,1  3,4  2,2  3,3  5,6  4,4  5,5  7,8  6,6  7,7  8,8  Figure 27.4 A dag representing the computation of M AT-V EC -M AIN -L OOP.A; x; y; 8; 1; 8/. The two numbers within each rounded
51
 justify the equality E ŒE2 ŒX  D E2 ŒX , note that because E ŒX  is a real number and not a random variable, so is E2 ŒX . The equality E ŒX E ŒX  D E2 ŒX   1200  Appendix C  Counting and Probability  follows from equation (C.22), with a D E
52
 matrices that we will prove in Section 28.3. Theorem 28.2 (Inversion is no harder than multiplication) Suppose we can multiply two n n real matrices in time M.n/, where M.n/ D .n2 / and M.n/ satisﬁes the two regularity conditions M.n C k/ D
53
 (at the bottom, when we are combining pairs to form 2-element DFTs) to lg n (at the top, when we are combining two .n=2/-element DFTs to produce the ﬁnal result). The algorithm therefore has the following structure: 1 for s D 1 to lg n 2 for k D 0 to n
54
 connected component only if both u and are vertices of the component. A directed graph is strongly connected if every two vertices are reachable from each other. The strongly connected components of a directed graph are the equiv-  4 Some authors refer
55
 to discharge the overﬂowing vertex with the maximum height. The best algorithm to date for maximum bipartite matching, discovered by p Hopcroft and Karp [176], runs in O. V E/ time and is described in Problem 26-6. The book by Lov´asz and Plummer
56
 d < .n/, then the adversary can factor Alice’s modulus n in time polynomial in the number of bits in n. (Although you are not asked to prove it, you may be interested to know that this result remains true even if the condition e D 3 is removed. See
57
 a C b Á c .mod 4/ if and only if ˛.a/ ˛.b/ Á ˛.c/ .mod 5/. 31.3-2 List all subgroups of Z9 and of Z13 . 31.3-3 Prove Theorem 31.14. 31.3-4 Show that if p is prime and e is a positive integer, then .p e / D p e 1 .p  1/ :  31.3-5 Show that for any
58
 A standard point-value representation for A and B consists of n point-value pairs for each polynomial. When we multiply these together, we get n point-value pairs, but we need 2n pairs to interpolate a unique polynomial C of degree-bound 2n. (See
59
  33.4 Finding the closest pair of points  1041  1. Create an array Y 0 , which is the array Y with all points not in the 2ı-wide vertical strip removed. The array Y 0 is sorted by y-coordinate, just as Y is. 2. For each point p in the array Y 0 , try
60
 equation, 837 norm of a vector, 1222 NOT function (:), 1071 not a set member (62), 1158 not equivalent (6Á), 54 NOT gate, 1070 NP (complexity class), 1049, 1064, 1066 ex., 1105 NPC (complexity class), 1050, 1069 NP-complete, 1050, 1069
61
 is O.n/ C O.m. C n=q// ; where is the number of valid shifts. This running time is O.n/ if D O.1/ and we choose q m. That is, if the expected number of valid shifts is small (O.1/) and we choose the prime q to be larger than the length of the
62
 of M is incident on . We say that a vertex 2 V is matched by the matching M if some edge in M is incident on ; otherwise, is unmatched. A maximum matching is a matching of maximum cardinality, that is, a matching M such that for any matching M 0 , we
63
 solve this variant of the sorting problem. (Hint: It is not rigorous to simply combine the lower bounds for the individual subsequences.)  8.2  Counting sort Counting sort assumes that each of the n input elements is an integer in the range 0 to k,
64
 =2e elements from S. Explain how to implement this data structure so that any sequence of m I NSERT and D ELETE -L ARGER -H ALF operations runs in O.m/ time. Your implementation should also include a way to output the elements of S in O.jSj/ time. 
65
 ﬁnishing time f .C 0 / is maximum over all components other than C . Again, the search will visit all vertices in C 0 , but by Corollary 22.15, the only edges in G T from C 0 to any other component must be to C , which we have already visited. In
66
 forest with union by rank and path compression in worst-case time O.m ˛.n//. Proof  Immediate from Lemmas 21.7, 21.11, 21.12, and 21.13.  Exercises 21.4-1 Prove Lemma 21.4. 21.4-2 Prove that every node has rank at most blg nc. 21.4-3 In light of
67
 from Li every element that is greater than t 7 let ´ be the largest value in Ln 8 return ´ Line 2 initializes the list L0 to be the list containing just the element 0. The for loop in lines 3–6 computes Li as a sorted list containing a suitably
68
 during the ﬁrst execution of the for loop in lines 5–13. The second time through the loop, it computes mŒi; iC2 for i D 1; 2; : : : ; n 2 (the minimum costs for chains of length l D 3), and so forth. At each step, the mŒi; j  cost computed in lines
69
 A call to R ANDOM.3; 7/ returns either 3, 4, 5, 6, or 7, each with probability 1=5. Each integer returned by R ANDOM is independent of the integers returned on previous calls. You may imagine R ANDOM as rolling a .b a C 1/-sided die to obtain its
70
 subproblem. In rod cutting, we had ‚.n/ subproblems overall, and at most n choices to examine for each, yielding an O.n2 / running time. Matrix-chain multiplication had ‚.n2 / subproblems overall, and in each we had at most n 1 choices, giving an
71
 [175]; Horowitz, Sahni, and Rajasekaran [181]; Johnsonbaugh and Schaefer [193]; Kingston [205]; Kleinberg and Tardos [208]; Knuth [209, 210, 211]; Kozen [220]; Levitin [235]; Manber [242]; Mehlhorn [249, 250, 251]; Purdom and Brown [287]; Reingold,
72
 set of coefﬁcients and right-hand sides) is associated with those basic variables. Lemma 29.4 Let .A; b; c/ be a linear program in standard form. Given a set B of basic variables, the associated slack form is uniquely determined. Proof Assume for
73
 of trial runs, determines how best to decompose the FFT computation for the given problem size on the host machine. FFTW adapts to use the hardware cache efﬁciently, and once subproblems are small enough, FFTW solves them with optimized,
74
 node’s potential increases due to the F IND -S ET and that at least max.0; s .˛.n/ C 2// nodes on the ﬁnd path have their potential decrease by at least 1. To see that no node’s potential increases, we ﬁrst appeal to Lemma 21.10 for all nodes other
75
 have already been copied back into A. (a)–(h) The arrays A, L, and R, and their respective indices k, i, and j prior to each iteration of the loop of lines 12–17.  trated in Figure 2.3, perform the r loop invariant:  p C 1 basic steps by maintaining
76
 j  values in a table eŒ1 : : n C 1; 0 : : n. The ﬁrst index needs to run to n C 1 rather than n because in order to have a subtree containing only the dummy key dn , we need to compute and store eŒn C 1; n. The second index needs to start from 0
77
 u/ for the operations, let’s think about how we might obtain such running times. At the end of Section 4.3, we saw that by changing variables, we could show that the recurrence p ˘ n C lg n (20.1) T .n/ D 2T has the solution T .n/ D O.lg n lg lg n/.
78
 cannot use vertex t in the second problem, then we cannot solve it at all, since t is required to be on the path that we ﬁnd, and it is not the vertex at which we are “splicing” together the subproblem solutions (that vertex being r). Because we use
79
 Network ﬂow algorithms. In Bern[139] Andrew V. Goldberg, Eva hard Korte, L´aszl´o Lov´asz, Hans J¨urgen Pr¨omel, and Alexander Schrijver, editors, Paths, Flows, and VLSI-Layout, pages 101–164. Springer, 1990. [140] Andrew V. Goldberg and Robert E.
80
 at which they leave. Otherwise, crates would accumulate at intermediate cities. Modeling problems with antiparallel edges Suppose that the trucking ﬁrm offered Lucky Puck the opportunity to lease space for 10 crates in trucks going from Edmonton to
81
 1g. The same holds for path p2 from vertex k to vertex j .  fore, p1 is a shortest path from i to k with all intermediate vertices in the set f1; 2; : : : ; k 1g. Similarly, p2 is a shortest path from vertex k to vertex j with all intermediate vertices
82
 the second, by elementary linear algebra, also creates an equivalent problem. (See Exercise 29.3-3.) To demonstrate this equivalence, observe that our original basic solution .0; 0; 0; 30; 24; 36/ satisﬁes the new equations (29.65)–(29.67) and has
83
 that the problem of determining the minimum number of bins required is NP-hard. (Hint: Reduce from the subset-sum problem.) The ﬁrst-ﬁt heuristic takes each in turn and places it into the ﬁrst bin that Pobject n can accommodate it. Let S D i D1 si . b.
84
 by the method: “pushing” preﬂow and “relabeling” a vertex. Finally, we shall present a generic push-relabel algorithm and analyze its correctness and running time. Intuition You can understand the intuition behind the push-relabel method in terms of
85
 or 1) over GF.2/ the same as for a regular matrix, but with all arithmetic that determines linear independence performed over GF.2/. We deﬁne the range of an n n 0-1 matrix A by R.A/ D fy W y D Ax for some x 2 Sn g ; so that R.A/ is the set of numbers
86
 r. We replace y by its own right child x, and we set y to be r’s parent. Then, we set y to be q’s child and the parent of l.  298  Chapter 12 Binary Search Trees  With the T RANSPLANT procedure in hand, here is the procedure that deletes node ´ from
87
 that the ﬁrst q D 5 characters match. Matching characters, shown shaded, are connected by vertical lines. (b) Using only our knowledge of the 5 matched characters, we can deduce that a shift of s C 1 is invalid, but that a shift of s 0 D sC2 is
88
 a left and a right child. We ﬁnd ´’s successor y, which lies in ´’s right subtree and has no left child (see Exercise 12.2-5). We want to splice y out of its current location and have it replace ´ in the tree. If y is ´’s right child (part (c)),
89
 is polynomial in n C m. As in boolean combinational circuits, a truth assignment for a boolean formula is a set of values for the variables of , and a satisfying assignment is a truth assignment that causes it to evaluate to 1. A formula with a
90
 exactly 2t 1 keys.2 The simplest B-tree occurs when t D 2. Every internal node then has either 2, 3, or 4 children, and we have a 2-3-4 tree. In practice, however, much larger values of t yield B-trees with smaller height. The height of a B-tree The
91
 by introducing the decision-tree model in order to study the performance limitations of comparison sorts. Using this model, we prove a lower bound of .n lg n/ on the worst-case running time of any comparison sort on n inputs, thus showing that
92
 series and has the value n X 1 n.n C 1/ k D 2  (A.1)  kD1  D ‚.n2 / :  (A.2)  A.1 Summation formulas and properties  1147  Sums of squares and cubes We have the following summations of squares and cubes: n X n.n C 1/.2n C 1/ ; k2 D 6 kD0 n X kD0 
93
 although it usually depends on characteristics of the disk unit used. B-trees are similar to red-black trees in that every n-node B-tree has height O.lg n/. The exact height of a B-tree can be considerably less than that of a red-black tree, however,
94
 Proof We start by showing that the subtree rooted at any node x contains at least 2bh.x/ 1 internal nodes. We prove this claim by induction on the height of x. If the height of x is 0, then x must be a leaf (T:nil), and the subtree rooted at x indeed
95
 O.lg n/. In the second phase, the only structural changes to the underlying red-black tree are caused by rotations, of which there are at most two. Moreover, a rotation is a local operation: only two nodes have their size attributes invalidated. The
96
 how to compute the area of an n-vertex simple, but not necessarily convex, polygon in ‚.n/ time. (See Exercise 33.1-5 for deﬁnitions pertaining to polygons.)  33.2 Determining whether any pair of segments intersects This section presents an algorithm
97
 x is in the set at the time. Show how to ﬁnd the successor of x in a binary search tree when x is not stored in the tree. 20.1-4 p Suppose that instead of superimposing a tree of degree u, we were to superimpose a tree of degree u1=k , where k > 1 is a
98
  30  24 26  (f) 46  7  21  23  18  52  39  38  17  41  30  35 0 1 2 3  26  46  0 1 2 3  A  w,x  w,x 7  30  24  35  A  17  46  A  39  (g)  26 35  A w,x (e) 23  24  21 23  18 39  52  38 41  24 26 35  (h)  7  46 26  24  17  46  30  21 23  18 39  52  38
99
 vertices of the graph are points in the plane and the cost of traveling between two vertices is the ordinary euclidean distance between them, then the triangle inequality is satisﬁed. Furthermore, many cost functions other than euclidean distance
100
 -C OMPONENTS is run on the undirected graph G D .V; E/, where V D fa; b; c; d; e; f; g; h; i; j; kg and the edges of E are processed in the order .d; i/; .f; k/; .g; i/; .b; g/; .a; h/; .i; j /; .d; k/; .b; j /; .d; f /; .g; j /; .a; e/. List the
101
 26; 41; 58i. 2.1-2 Rewrite the I NSERTION -S ORT procedure to sort into nonincreasing instead of nondecreasing order. 2.1-3 Consider the searching problem: Input: A sequence of n numbers A D ha1 ; a2 ; : : : ; an i and a value . Output: An index i
102
 Nevertheless, in practice, if we rule out “expensive” encodings such as unary ones, the actual encoding of a problem makes little difference to whether the problem can be solved in polynomial time. For example, representing integers in base 3
103
 all vertices at distance k from s before discovering any vertices at distance k C 1. To keep track of progress, breadth-ﬁrst search colors each vertex white, gray, or black. All vertices start out white and may later become gray and then black. A
104
 34.10 illustrates how we overcome this problem, using as an example the circuit from Figure 34.8(a). For each wire xi in the circuit C , the formula  34.4 NP-completeness proofs  x1 x2  1081  x5 x8 x6 x9  x3  x4  x10  x7  Figure 34.10 Reducing circuit
105
 i for the next iteration refers to node 4. (c)–(e) Subsequent iterations of the for loop in B UILD -M AX -H EAP. Observe that whenever M AX -H EAPIFY is called on a node, the two subtrees of that node are both max-heaps. (f) The max-heap after B
106
 leaf nodes require no pointers to children, they could conceivably use a different (larger) t value than internal nodes for the same disk page size. Show how to modify the procedures for creating and inserting into a B-tree to handle this
107
 algorithm is within a factor of .n/ of the cost C of an optimal solution: Ã Â C C Ä .n/ : (35.13) ; max C C We call a randomized algorithm that achieves an approximation ratio of .n/ a randomized .n/-approximation algorithm. In other words, a
108
 1972. [151] Ronald L. Graham and Pavol Hell. On the history of the minimum spanning tree problem. Annals of the History of Computing, 7(1):43–57, 1985. [152] Ronald L. Graham, Donald E. Knuth, and Oren Patashnik. Addison-Wesley, second
109
 239 circular linked list, 236 see also linked list class complexity, 1059 equivalence, 1164 classiﬁcation of edges in breadth-ﬁrst search, 621 pr. in depth-ﬁrst search, 609–610, 611 ex. in a multithreaded dag, 778–779 clause, 1081–1082 clean area,
110
 The traveling-salesman problem 1111 35.3 The set-covering problem 1117 35.4 Randomization and linear programming 35.5 The subset-sum problem 1128  1123  1021  Contents  xi  VIII Appendix: Mathematical Background Introduction A  1143  Summations 1145
111
 : The function high.x/ gives the most signiﬁcant .lg u/=2 bits of x, producing the number of x’s cluster. The function low.x/ gives the least signiﬁcant .lg u/=2 bits of x and provides x’s position within its cluster. The function index.x; y/ builds an
112
 nonbasic variable xe , called the entering variable, and a basic variable xl , called the leaving variable, and exchanges their roles. The linear program described in equations (29.64)–(29.67) is equivalent to the linear program described in equations
113
 of the O.1/ amortized time of F IB -H EAP -D ECREASE -K EY and the O.D.n// amortized time of F IB -H EAP -E XTRACT-M IN. Since we shall see in Section 19.4 that D.n/ D O.lg n/, the amortized time of F IB -H EAP -D ELETE is O.lg n/. Exercises 19.3-1
114
 1 0 6 5 4 3 2 1 0 6 5 4 3 2 1 0  s –26 14  /14  x 0  5/5  y 19  8  14  /14  5/5  y 19  8  14  /14  5/5  y 11  8/8  3 s x z  5 s x z  6 s x z  7 s x z  8 s x z  9 s x z  4 s x z  z 0  s –26  x 0  2 s x z  z 0  s –26  x 0  1 s x z  z 8  Figure 26.9
115
 this loop, u D s.) Vertex u, therefore, has the smallest shortest-path estimate of any vertex in V S. Then, lines 7–8 relax each edge .u; / leaving u, thus updating the estimate :d and the predecessor : if we can improve the shortest path to
116
 pseudocode for P ROTO - V EB-D ELETE that uses the attribute n to decide when to reset summary bits to 0. What is the worst-case running time of your procedure? What other procedures need to change because of the new attribute? Do these changes
117
 Dp 1 3 j D r C1 4 while TRUE 5 repeat 6 j Dj 1 7 until AŒj  Ä x 8 repeat 9 i D i C1 10 until AŒi x 11 if i < j 12 exchange AŒi with AŒj  13 else return j a. Demonstrate the operation of H OARE -PARTITION on the array A D h13; 19; 9; 5; 12; 8; 7;
118
 Now consider a deterministic linear search algorithm, which we refer to as D ETERMINISTIC -S EARCH. Speciﬁcally, the algorithm searches A for x in order, considering AŒ1; AŒ2; AŒ3; : : : ; AŒn until either it ﬁnds AŒi D x or it reaches the end of
119
 to use the optimal substructure to show that we can construct an optimal solution to the problem from optimal solutions to subproblems. Given keys ki ; : : : ; kj , one of these keys, say kr (i Ä r Ä j ), is the root of an optimal subtree containing
120
 subset of fx1 ; x2 ; : : : ; xi g and summing its members. For example, if S D f1; 4; 5g, then P1 D f0; 1g ; P2 D f0; 1; 4; 5g ; P3 D f0; 1; 4; 5; 6; 9; 10g : Given the identity Pi D Pi  1  [ .Pi  1  C xi / ;  (35.23)  we can prove by induction on
121
 letter is the sequence of edge labels on the simple path from the root to the letter. Line 2 initializes the min-priority queue Q with the characters in C . The for loop in lines 3–8 repeatedly extracts the two nodes x and y of lowest frequency  432 
122
 network. We can continue, choosing the augmenting path s ! u ! ! t in the odd-numbered iterations and the augmenting path s ! ! u ! t in the even-numbered iterations. We would perform a total of 2,000,000 augmentations, increasing the ﬂow value by only
123
 some number 1, there is a polynomial-time approximation algorithm A with approximation ratio . Without loss of generality, we assume that is an integer, by rounding it up if necessary. We shall then show how to use A to solve instances of the
124
 its vertices as well. Although this chapter focuses on trees in terms of their edges, we shall operate with the understanding that the vertices of a tree T are those that some edge of T is incident on.  23.1 Growing a minimum spanning tree Assume
125
 only alternative is to abort with an error. We shall assume, however, that our software environment, like many modern ones, provides a memory-management system that can allocate and free blocks of storage on request. Thus, upon inserting an item
126
 this set of three  33.3 Finding the convex hull  pj  1035  pj  pk  pi  pi  pr pt  Qj  p2 p1  p0  p1 p0  (a)  (b)  Figure 33.8 The proof of correctness of G RAHAM -S CAN. (a) Because pi ’s polar angle relative to p0 is greater than pj ’s polar angle,
127
 comprises two steps: 1. Guess the form of the solution. 2. Use mathematical induction to ﬁnd the constants and show that the solution works. We substitute the guessed solution for the function when applying the inductive hypothesis to smaller
128
 created a violation of property 2. Case 1 corrected the lone violation of property 4 that existed at the start of this iteration. It then made ´0 red and left ´0 :p alone. If ´0 :p was black, there is no violation of property 4. If ´0 :p was red,
129
 during the entire execution of Q UICKSORT. Lemma 7.1 Let X be the number of comparisons performed in line 4 of PARTITION over the entire execution of Q UICKSORT on an n-element array. Then the running time of Q UICKSORT is O.n C X /. Proof By the
130
 of an algorithm, we can often split the summation and ignore a constant number of the P initial terms. Generally, this n technique applies when each term ak in a summation kD0 ak is independent of n.  A.2 Bounding summations  1153  Then for any
131
 a relaxation step on edge .u; / in O.1/ time: R ELAX .u; ; w/ 1 if :d > u:d C w.u; / 2 :d D u:d C w.u; / 3 : Du Figure 24.3 shows two examples of relaxing an edge, one in which a shortest-path estimate decreases and one in which no estimate
132
 is not a base case and x equals neither min nor max—is handled by the recursive call in line 5. Recurrence (20.4) characterizes the running time of the V EB-T REE -M EMBER procedure, and so this procedure takes O.lg lg u/ time. Finding the successor
133
 Paths  a 3  –4  b –1  3 s 0  5  4 c 5  6  d 11  8  –3 2  e –∞  3  f –∞  7  g –∞  h ∞  i ∞  2  –8  3 ∞ j  –6  Figure 24.1 Negative edge weights in a directed graph. The shortest-path weight from source s appears within each vertex. Because
134
 return y We break the code for T REE -S UCCESSOR into two cases. If the right subtree of node x is nonempty, then the successor of x is just the leftmost node in x’s right subtree, which we ﬁnd in line 2 by calling T REE -M INIMUM .x:right/. For
135
 those that can admit more ﬂow; those edges .u; / whose ﬂow equals their capacity have cf .u; / D 0, and they are not in Gf . The residual network Gf may also contain edges that are not in G, however. As an algorithm manipulates the ﬂow, with the goal
136
 on sorting networks and the PRAM (Parallel RandomAccess Machine) model. The data-parallel model [48, 168] is another popular algorithmic programming model, which features operations on vectors and matrices as primitives.  812  Chapter 27
137
 any location of memory. Other parallel computers employ distributed memory, where each processor’s memory is private, and an explicit message must be sent between processors in order for one processor to access the memory of another. With the
138
 J. L. Bentley has suggested that we simplify the problem by restricting our attention to bitonic tours, that is, tours that start at the leftmost point, go strictly rightward to the rightmost point, and then go strictly leftward back to the starting
139
 of a set of elements is the ﬁrst order statistic (i D 1), and the maximum is the nth order statistic (i D n). A median, informally, is the “halfway point” of the set. When n is odd, the median is unique, occurring at i D .n C 1/=2. When n is even,
140
 correct? 21.4-6 ? Consider the function ˛ 0 .n/ D min fk W Ak .1/ lg.n C 1/g. Show that ˛ 0 .n/ Ä 3 for all practical values of n and, using Exercise 21.4-2, show how to modify the potential-function argument to prove that we can perform a
141
 a polynomialtime algorithm. Most theoretical computer scientists believe that the NP-complete problems are intractable, since given the wide range of NP-complete problems that have been studied to date—without anyone having discovered a
142
 “streaks” of consecutive heads when we ﬂip coins. The ﬁnal example analyzes a variant of the hiring problem in which you have to make decisions without actually interviewing all the candidates. 5.4.1  The birthday paradox  Our ﬁrst example is the
143
 « 0 D fB Â S fxg W B [ fxg 2 « g ; and the weight function for M 0 is the weight function for M , restricted to S 0 . (We call M 0 the contraction of M by the element x.) Proof If A is any maximum-weight independent subset of M containing x, then A0 D
144
 we require the sets in the collection to be disjoint, conceptually we destroy sets Sx and Sy , removing them from the collection S . In practice, we often absorb the elements of one of the sets into the other set. F IND -S ET .x/ returns a pointer to
145
 rank column, 1223 full, 1223 of a matrix, 1223, 1226 ex. of a node in a disjoint-set forest, 569, 575, 581 ex. of a number in an ordered set, 300, 339 in order-statistic trees, 341–343, 344–345 ex. row, 1223 rate of growth, 28 ray, 1021 ex. RB-D ELETE
146
 Jo˜ao Setubal and Jo˜ao Meidanis. Introduction to Computational Molecular Biology. PWS Publishing Company, 1997. [311] Clifford A. Shaffer. A Practical Introduction to Data Structures and Algorithm Analysis. Prentice Hall, second edition, 2001. [312]
147
 pi 1 , which was pushed at the end of the previous iteration (or before the ﬁrst iteration, when i D 3). Let pj be the top point on S after executing the while loop of lines 8–9 but before line 10 pushes pi , and let pk be the point just below pj on S.
148
 : : ; rank.n/i. Given the rank list A1 D h1; 2; 3; 4; 5; 6; 7; 8; 9; 10i, a new ofﬁce assistant is always hired 10 times, since each successive candidate is better than the previous one, and lines 5–6 are executed in each iteration. Given the list of
149
 0 1 2 0 0  1 0 1 0 1 0 0 0 0 0 0 0 1 2  t  =  1  1  1  4  4  4  4  1 0 1 2 0 2 3 0 3  Figure 34.19 The reduction of 3-CNF-SAT to SUBSET-SUM. The formula in 3-CNF is D C1 ^C2 ^C3 ^C4 , where C1 D .x1 _:x2 _:x3 /, C2 D .:x1 _:x2 _:x3 /, C3 D .:x1 _:x2
150
 1 : k  0, (C.11)  kD0  C.2 Probability Probability is an essential tool for the design and analysis of probabilistic and randomized algorithms. This section reviews basic probability theory. We deﬁne probability in terms of a sample space S, which is a
151
 Bernhard Korte and L´aszl´o Lov´asz. Greedoids—A structural framework for the greedy algorithm. In W. Pulleybank, editor, Progress in Combinatorial Optimization, pages 221– 243. Academic Press, 1984. [219] Bernhard Korte and L´aszl´o Lov´asz. Greedoids
152
 and after the transformation. In this case, after the transformation, the new node x has color attribute c, but this node is really either red-and-black (if c D RED ) or doubly black (if c D BLACK ). You can verify the other cases similarly (see
153
 generally assume that all problem instances are binary strings encoded using the standard encoding, unless we explicitly specify the contrary. We shall also typically neglect the distinction between abstract and concrete problems. You should watch
154
 function ˛ 0 .n/ D min fk W Ak .1/ lg.n C 1/g. Show that ˛ 0 .n/ Ä 3 for all practical values of n and, using Exercise 21.4-2, show how to modify the potential-function argument to prove that we can perform a sequence of m M AKE S ET, U NION, and F IND
155
  Associative laws: A \ .B \ C / D .A \ B/ \ C ; A [ .B [ C / D .A [ B/ [ C : Distributive laws: A \ .B [ C / D .A \ B/ [ .A \ C / ; A [ .B \ C / D .A [ B/ \ .A [ C / :  (B.1)  Absorption laws: A \ .A [ B/ D A ; A [ .A \ B/ D A : DeMorgan’s laws:
156
 into a one-to-one correspondence with the natural numbers N is countably inﬁnite; otherwise, it is uncountable. For example, the integers Z are countable, but the reals R are uncountable. For any two ﬁnite sets A and B, we have the identity jA [ Bj D
157
 from equation (31.20).) By equation (31.41), we have g n 1 Á 1 .mod n/. Then the discrete logarithm theorem (Theorem 31.33, taking y D 0) implies that n 1 Á 0 .mod .n//, or .p  1/p e  1  j pe  1:  This is a contradiction for e > 1, since .p 1/p e 1 is
158
 shortest-path estimate of any vertex in V S. Then, lines 7–8 relax each edge .u; / leaving u, thus updating the estimate :d and the predecessor : if we can improve the shortest path to found so far by going through u. Observe that the algorithm
159
 RB-D ELETE -F IXUP. Darkened nodes have color attributes BLACK, heavily shaded nodes have color attributes RED, and lightly shaded nodes have color attributes represented by c and c 0 , which may be either RED or BLACK. The letters ˛; ˇ; : : :
160
 path from s to e. By traversing the negative-weight cycle he; f; ei arbitrarily many times, we can ﬁnd paths from s to e with arbitrarily large negative weights, and so ı.s; e/ D 1. Similarly, ı.s; f / D 1. Because g is reachable from f , we can
161
 contains n Ä m elements. Then n objects represent elements currently in the dynamic set, and the remaining m n objects are free; the free objects are available to represent elements inserted into the dynamic set in the future. We keep the free
162
 43 3.1 Asymptotic notation 43 3.2 Standard notations and common functions  4  ? 5  ?  53  Divide-and-Conquer 65 4.1 The maximum-subarray problem 68 4.2 Strassen’s algorithm for matrix multiplication 75 4.3 The substitution method for solving
163
 boolean functions are there? How many n-input, m-output boolean functions are there? C.1-3 In how many ways can n professors sit around a circular conference table? Consider two seatings to be the same if one can be rotated to form the other.
164
 conclude that B.T / D B.T 0 / C x:freq C y:freq or, equivalently, B.T 0 / D B.T /  x:freq  y:freq :  We now prove the lemma by contradiction. Suppose that T does not represent an optimal preﬁx code for C . Then there exists an optimal tree T 00 such
165
 a universal sink—a vertex with in-degree jV j 1 and out-degree 0—in time O.V /, given an adjacency matrix for G. 22.1-7 The incidence matrix of a directed graph G D .V; E/ with no self-loops is a jV j jEj matrix B D .bij / such that    bij D  1 if
166
 of the limited precision of computer arithmetic on noninteger values, larger errors accumulate in Strassen’s algorithm than in S QUARE -M ATRIX -M ULTIPLY. 4. The submatrices formed at the levels of recursion consume space. The latter two reasons
167
 Section 22.1 discusses the two most common computational representations of graphs: as adjacency lists and as adjacency matrices. Section 22.2 presents a simple graph-searching algorithm called breadth-ﬁrst search and shows how to create a
168
  Preface  You should ﬁnd it easy to organize your course around just the chapters you need. We have made chapters relatively self-contained, so that you need not worry about an unexpected and unnecessary dependence of one chapter on another. Each
169
 A binary number x that is stored in the counter has its lowest-order bit in AŒ0 and its highest-order bit in AŒk 1, so that Pk 1 x D i D0 AŒi 2i . Initially, x D 0, and thus AŒi D 0 for i D 0; 1; : : : ; k 1. To add 1 (modulo 2k ) to the value
170
 C 1), we claim that the call F IND -M AX -C ROSSING -S UBARRAY .A; low; mid; high/ takes ‚.n/ time. Since each iteration of each of the two for loops takes ‚.1/ time, we just need to count up how many iterations there are altogether. The for loop of
171
 996 ﬁnal strand, 779 F IND -D EPTH, 583 pr. F IND -M AX -C ROSSING -S UBARRAY, 71 F IND -M AXIMUM -S UBARRAY, 72 ﬁnd path, 569 F IND -S ET , 562 disjoint-set-forest implementation of, 571, 585 linked-list implementation of, 564 ﬁnished vertex,
172
 derive an overall bound on the total number of comparisons. To do so, we must understand when the algorithm compares two elements of the array and when it does not. For ease of analysis, we rename the elements of the array A as ´1 ; ´2 ; : : : ; ´n ,
173
 a substitution proof work. 4.3-8 Using the master method in Section 4.5, you can show that the solution to the recurrence T .n/ D 4T .n=2/ C n2 is T .n/ D ‚.n2 /. Show that a substitution proof with the assumption T .n/ Ä cn2 fails. Then show how to
174
 and Theorem 35.4.  In some applications, max fjSj W S 2 F g is a small constant, and so the solution returned by G REEDY-S ET-C OVER is at most a small constant times larger than optimal. One such application occurs when this heuristic ﬁnds an
175
 prove that any sequence of m RB-I NSERT and RB-D ELETE operations on an initially empty red-black tree causes O.m/ structural modiﬁcations in the worst case. Note that we count each color change as a structural modiﬁcation. b. Some of the cases
176
 linked list using the multiple-array representation. Do the same for the single-array representation. 10.3-2 Write the procedures A LLOCATE -O BJECT and F REE -O BJECT for a homogeneous collection of objects implemented by the single-array
177
 the hash function be h.k/ D k mod 9. 11.2-3 Professor Marley hypothesizes that he can obtain substantial performance gains by modifying the chaining scheme to keep each list in sorted order. How does the professor’s modiﬁcation affect the running
178
 X D x to be fs 2 S W X.s/ D xg; thus, X Pr fsg : Pr fX D xg D s2SWX.s/Dx  The function f .x/ D Pr fX D xg is the probability density function P of the random variable X . From the probability axioms, Pr fX D xg 0 and x Pr fX D xg D 1. As an
179
 that the graph be bisected into two nearly equal-sized subgraphs, which are induced by a partition of the vertices. This problem investigates bisections of trees formed by removing a small number of edges. We require that whenever two vertices end up
180
 and suppose that the attribute h is a height function. If a vertex u is overﬂowing and .u; / is an admissible edge, then P USH .u; / applies. The operation does not create any new admissible edges, but it may cause .u; / to become inadmissible.  750 
181
 BŒ1; : : : ; BŒn  1 together in order  Figure 8.4 shows the operation of bucket sort on an input array of 10 numbers. To see that this algorithm works, consider two elements AŒi and AŒj . Assume without loss of generality that AŒi Ä AŒj .
182
 applications. The underlying mathematics is substantially the same with either deﬁnition of !n .  908  Chapter 30 Polynomials and the FFT  Corollary 30.4 For any even integer n > 0, !nn=2 D !2 D Proof  1:  The proof is left as Exercise
183
 j  11.3-6 ? Let U be the set of n-tuples of values drawn from Zp , and let B D Zp , where p is prime. Deﬁne the hash function hb W U ! B for b 2 Zp on an input n-tuple ha0 ; a1 ; : : : ; an 1 i from U as ! n 1 X aj b j mod p ; hb .ha0 ; a1 ; : : : ;
184
 is the set of n integers f0; 1; : : : ; n 1g. We often denote a ﬁnite sequence by listing its values: hf .0/; f .1/; : : : ; f .n 1/i. An inﬁnite sequence is a function whose domain is the set N of natural numbers. For example, the Fibonacci
185
 have to delete that other element from its cluster. If the test in line 9 reveals that we are in this case, then line 10 sets ﬁrst-cluster to the number of the cluster that contains the lowest element other than min, and line 11 sets x to the value
186
 is not only a “legal” ﬂow, it is also a maximum ﬂow. The basic operations From the preceding discussion, we see that a push-relabel algorithm performs two basic operations: pushing ﬂow excess from a vertex to one of its neighbors and relabeling a
187
 has a running time of ‚.n100 /, an algorithm with a much better running time will likely soon be discovered.  1054  Chapter 34 NP-Completeness  Second, for many reasonable models of computation, a problem that can be solved in polynomial time in one
188
 given the wide range of NP-complete problems that have been studied to date—without anyone having discovered a polynomialtime solution to any of them—it would be truly astounding if all of them could be solved in polynomial time. Yet, given the
189
 subtract, and multiply as usual on the representatives, but we replace each result x by the representative of its class, that is, by x mod n. Using this deﬁnition of addition modulo n, we deﬁne the additive group modulo n as .Zn ; Cn /. The size of
190
 The usual cut-and-paste argument shows that the optimal solution Aij must also include optimal solutions to the two subproblems for Si k and Skj . If we could ﬁnd a set A0kj of mutually compatible activities in Skj where jA0kj j > jAkj j, then we
191
 polynomial in the size n of its input instance. The running time of a polynomial-time approximation scheme can increase very rapidly as decreases. For example, the running time of a polynomial-time approximation scheme might be O.n2= /. Ideally, if
192
 before proceeding to the statement after the sync. In the P-F IB procedure, a sync is required before the return statement in line 6 to avoid the anomaly that would occur if x and y were summed before x was computed. In addition to explicit
193
 input vector .0; 2; 3; 1; 4; 5; 7; 9/. 30.3-2 Show how to implement an FFT algorithm with the bit-reversal permutation occurring at the end, rather than at the beginning, of the computation. (Hint: Consider the inverse DFT.) 30.3-3 How many times does
194
 0.6 4 –2 4 2 3.4 –1 (a)  3 2 1 4  5 5 0.6 0 0.4 –2 –0.2 –1  4 2 1.6 –3.2 0.4 –0.2 4.2 –0.6 (d)  3 1 2 4  5 5 4 2 0.4 –2 0.4 –0.2 0.6 0 1.6 –3.2 –0.2 0.5 4 –0.5 (g)  3 1 4 2  1 0 0 0 P  0 0 1 0  ˘  2 3 5 1  0 2 0:6 3 4 2 5 4 2 2 3:4 1  5 3 2 –1  5 3 0
195
 Lawler [224], Papadimitriou and Steiglitz [271], and Tarjan [330] are good references for network ﬂow and related algorithms. Goldberg, Tardos, and Tarjan [139] also provide a nice survey of algorithms for network-ﬂow problems, and Schrijver [304]
196
 of the weighted matroid M 0 D .S 0 ; « 0 /, where S 0 D fy 2 S W fx; yg 2 « g ; « 0 D fB Â S fxg W B [ fxg 2 « g ; and the weight function for M 0 is the weight function for M , restricted to S 0 . (We call M 0 the contraction of M by the element
197
 over some alphabet that reads the same forward and backward. Examples of palindromes are all strings of length 1, civic, racecar, and aibohphobia (fear of palindromes). Give an efﬁcient algorithm to ﬁnd the longest palindrome that is a
198
 T .n/ of the algorithm S ELECT. Steps 1, 2, and 4 take O.n/ time. (Step 2 consists of O.n/ calls of insertion sort on sets of size O.1/.) Step 3 takes time T .dn=5e/, and step 5 takes time at most T .7n=10 C 6/, assuming that T is monotonically
199
 tree would be faster for all the other operations. Superimposing a tree of constant height What happens if we superimpose a tree with greater degree? Let p us assume that the size of the universe is u D 22k for some integer k, so that u is an
200
 k. Since Œan D fa C k n W k 2 Zg, the set Zn is well deﬁned. An example of such a group is Z15 D f1; 2; 4; 7; 8; 11; 13; 14g ;  942  Chapter 31 Number-Theoretic Algorithms  where the group operation is multiplication modulo 15. (Here we denote
201
 trees, 339–345 persistent, 331 pr., 482 potential of, 459 priority queues, 162–166 proto van Emde Boas structures, 538–545 queues, 232, 234–235 radix trees, 304 pr. red-black trees, 308–338 relaxed heaps, 530 rooted trees, 246–249 scapegoat trees, 338
202
 -W EIGHT-VC is a polynomial-time algorithm. Now we show that A PPROX -M IN -W EIGHT-VC is a 2-approximation algorithm. Let C be an optimal solution to the minimum-weight vertex-cover problem, and let ´ be the value of an optimal solution to the linear
203
 return a pointer to a node x in T such that x:int:low D i:low and x:int:high D i:high, or T:nil if T contains no such node. All operations, including I NTERVAL -S EARCH -E XACTLY, should run in O.lg n/ time on an n-node interval tree. 14.3-6 Show
204
 Prove Theorem 3.1. 3.1-6 Prove that the running time of an algorithm is ‚.g.n// if and only if its worst-case running time is O.g.n// and its best-case running time is .g.n//. 3.1-7 Prove that o.g.n// \ !.g.n// is the empty set. 3.1-8 We can extend
205
 u and begins a new pass. For the u:current pointer to advance past a vertex 2 u:N during a pass, the edge .u; / must be deemed inadmissible by the test in line 6. Thus, by the time the pass completes, every edge leaving u has been determined to
206
 the list of ranks A2 D h10; 9; 8; 7; 6; 5; 4; 3; 2; 1i, a new ofﬁce assistant is hired only once, in the ﬁrst iteration. Given a list of ranks A3 D h5; 2; 1; 8; 4; 7; 10; 9; 3; 6i, a new ofﬁce assistant is hired three times, upon interviewing the
207
 be produced by running BFS on G, no matter how the vertices are ordered in each adjacency list. 22.2-7 There are two types of professional wrestlers: “babyfaces” (“good guys”) and “heels” (“bad guys”). Between any pair of professional wrestlers,
208
 100, 1011. 12-3 Average node depth in a randomly built binary search tree In this problem, we prove that the average depth of a node in a randomly built binary search tree with n nodes is O.lg n/. Although this result is weaker than that of Theorem
209
 4 distinct elements fa; b; c; d g might make the sequence of requests hd; b; d; b; d; a; c; d; b; a; c; bi. Let k be the size of the cache. When the cache contains k elements and the program requests the .k C 1/st element, the system must decide, for
210
 opposite approach—reducing instances of 3-CNF-SAT with a special structure to general instances of CLIQUE—would not have sufﬁced, however. Why not? Perhaps the instances of 3-CNF-SAT that we chose to reduce from were “easy,” and so we would not have
211
 the variable is limited by the other constraints. In particular, we raise it until some basic variable becomes 0. We then rewrite the slack form, exchanging the roles of that basic variable and the chosen nonbasic variable. Although we have
212
 of 1 4x around x D 0. (If you wish, instead of using the Taylor expansion, you may use the generalization of the binomial expansion (C.4) to nonintegral exponents n, where for any real number n and for any integer k, we interpret kn to be n.n 1/
213
 next character scanned is instead b, so that the automaton should move to state ı.5; b/ D 4. The while loop in KMP-M ATCHER exits having executed line 7 once, and it arrives in state q 0 D Œ5 D 3. Since P Œq 0 C 1 D P Œ4 D b, the test in line 8
214
 of electrical current through a wire. Vertices are conduit junctions, and other than the source and sink, material ﬂows through the vertices without collecting in them. In other words, the rate at which material enters a vertex must equal the rate
215
 Scott A. Vanstone. Handbook of Applied Cryptography. CRC Press, 1997. [255] Gary L. Miller. Riemann’s hypothesis and tests for primality. Journal of Computer and System Sciences, 13(3):300–317, 1976. [256] John C. Mitchell. Foundations for Programming
216
 that the expected number of steps before the sep quence hxi0 i repeats is ‚. p/. If p is small compared to n, the sequence hxi0 i might repeat much more quickly than the sequence hxi i. Indeed, as parts (b) and (c) of Figure 31.7 show, the hxi0 i
217
 one step, an ideal parallel computer with P processors can do at most P units of work, and thus in TP time, it can perform at most P TP work. Since the total work to do is T1 , we have P TP T1 . Dividing by P yields the work law: TP  T1 =P :  (27.2)  A
218
 from disclosure. By composing the above protocols for encryption and for signatures, we can create messages that are both signed and encrypted. The signer ﬁrst appends his or her digital signature to the message and then encrypts the resulting
219
 up sticks Professor Charon has a set of n sticks, which are piled up in some conﬁguration. Each stick is speciﬁed by its endpoints, and each endpoint is an ordered triple giving its .x; y; ´/ coordinates. No stick is vertical. He wishes to pick
220
 always need to guess the exact value of a summation in order to use mathematical induction. Instead, you can use induction to proveP a bound on a summation. As an example, let us provePthat the geometric series nkD0 3k is O.3n /. n More speciﬁcally,
221
 shall prove a related bound in Section A.2.) Integrating and differentiating series By integrating or differentiating the formulas above, additional formulas arise. For example, by differentiating both sides of the inﬁnite geometric series (A.6) and
222
 each subproblem of size j , for j D 1; 2; : : : ; n, in order of increasing size. The approach used to solve a problem of a particular size j is the same as that used by C UT-ROD, except that line 6 now  15.1 Rod cutting  367  4 3 2 1 0  Figure 15.4
223
 0.20 0.10  (a) A binary search tree with expected search cost 2.80. (b) A binary search tree with expected search cost 2.75. This tree is optimal.  d0 ; d1 ; d2 ; : : : ; dn representing values not in K. In particular, d0 represents all values less
224
 Therefore, A0 is independent, completing our proof that .S; « / is a matroid. By Theorem 16.11, we can use a greedy algorithm to ﬁnd a maximum-weight independent set of tasks A. We can then create an optimal schedule having the tasks in A
225
 asks you to analyze the number of iterations in the algorithm (that is, the number of iterations in the repeat loop) and to describe an implementation of line 3. b. Given two matchings M and M in G, show that every vertex in the graph G 0 D .V;
226
 algorithm ﬁrst computes the  680  Chapter 24 Single-Source Shortest Paths  shortest-path weights ı1 .s; / for all 2 V , then computes ı2 .s; / for all 2 V , and so on, until it computes ık .s; / for all 2 V . We assume throughout that jEj jV j 1, and
227
  Chapter 23 Minimum Spanning Trees  Figure 23.5 shows how Prim’s algorithm works. Lines 1–5 set the key of each vertex to 1 (except for the root r, whose key is set to 0 so that it will be the ﬁrst vertex processed), set the parent of each vertex to
228
 section, we shall focus on property 1. The goal of the while loop in lines 1–22 is to move the extra black up the tree until 1. x points to a red-and-black node, in which case we color x (singly) black in line 23; 2. x points to the root, in which
229
  arbitrary locations in the two sequences (including at either end) so that the resulting sequences x 0 and y 0 have the same length but do not have a space in the same position (i.e., for no position j are both x 0 Œj  and y 0 Œj  a space). Then
230
 an integer expressed in suitable radix notation. Thus, we might interpret the identiﬁer pt as the pair of decimal integers .112; 116/, since p D 112 and t D 116 in the ASCII character set; then, expressed as a radix-128 integer, pt becomes .112 128/ C
231
 Signal Processing. Prentice Hall, second edition, 1998. [267] Alan V. Oppenheim and Alan S. Willsky, with S. Hamid Nawab. Signals and Systems. Prentice Hall, second edition, 1997. [268] James B. Orlin. A polynomial time primal network
232
 time O.m ˛.n//. Proof  Immediate from Lemmas 21.7, 21.11, 21.12, and 21.13.  Exercises 21.4-1 Prove Lemma 21.4. 21.4-2 Prove that every node has rank at most blg nc. 21.4-3 In light of Exercise 21.4-2, how many bits are necessary to store
233
 probing, but to make full use of the hash table, the values of c1 , c2 , and m are constrained. Problem 11-3 shows one way to select these parameters. Also, if two keys have the same initial probe position, then their probe sequences are the same,
234
 networks Intuitively, given a ﬂow network G and a ﬂow f , the residual network Gf consists of edges with capacities that represent how we can change the ﬂow on edges of G. An edge of the ﬂow network can admit an amount of additional ﬂow equal to
235
 node. F IB -H EAP -D ECREASE -K EY .H; x; k/ 1 if k > x:key 2 error “new key is greater than current key” 3 x:key D k 4 y D x:p 5 if y ¤ NIL and x:key < y:key 6 C UT.H; x; y/ 7 C ASCADING -C UT .H; y/ 8 if x:key < H:min:key 9 H:min D x C UT.H; x; y/
236
 the ﬂow on some edges may be necessary in order to enable an algorithm to send more ﬂow from the source to the sink. We repeatedly augment the ﬂow until the residual network has no more augmenting paths. The max-ﬂow min-cut theorem will show that
237
 is smaller than x’s key. After we link y to x, the degree of x has increased by 1, and so we continue this process, linking x and another root whose degree equals x’s new degree, until no other root  19.2 Mergeable-heap operations  517  that we have
238
 for each group. The representative of the ith group is at least as large as the largest element in the ith group, and it is smaller than every element of the .i C1/st group. (The representative of the last group can be the maximum possible element u
239
 is simply the element in the set with the ith smallest key. We saw how to determine any order statistic in O.n/ time from an unordered set. In this section, we shall see how to modify red-black trees so that we can determine any order statistic for
240
 2V  X  !  f .u; /  2V u2S  XX  f . ; s/ C  2V  u2S fsg  f .u; /  X  u2S fsg 2V  X  !  f . ; u/  u2S fsg  f . ; u/ :  2V u2S  Because V D S [ T and S \ T D ;, we can split each summation over V into summations over S and T to obtain XX XX XX XX f .u;
241
  31.4 Solving modular linear equations  949  M ODULAR -L INEAR -E QUATION -S OLVER .a; b; n/ 1 .d; x 0 ; y 0 / D E XTENDED -E UCLID .a; n/ 2 if d j b 3 x0 D x 0 .b=d / mod n 4 for i D 0 to d 1 5 print .x0 C i.n=d // mod n 6 else print “no
242
 to C++. We also thank the many readers of the ﬁrst and second editions who reported errors or submitted suggestions for how to improve this book. We corrected all the bona ﬁde errors that were reported, and we incorporated as many suggestions as we
243
 to lg n (at the top, when we are combining two .n=2/-element DFTs to produce the ﬁnal result). The algorithm therefore has the following structure: 1 for s D 1 to lg n 2 for k D 0 to n 1 by 2s 3 combine the two 2s 1 -element DFTs in AŒk : : k C 2s 1
244
 (d) After the next step, the matrix A is factored. (The element 3 in the new Schur complement becomes part of U when the recursion terminates.) (e) The factorization A D LU .  trix A. (We don’t need to divide by akk in line 12 because we already
245
 integer n, gcd.an; bn/ D n gcd.a; b/ : Proof If n D 0, the corollary is trivial. If n > 0, then gcd.an; bn/ is the smallest positive element of the set fanx C bny W x; y 2 Zg, which is n times the smallest positive element of the set fax C by
246
 dominate the constant hidden in O.c/. You can now see why we deﬁned the potential function to include a term that is twice the number of marked nodes. When a marked node y is cut by a cascading cut, its mark bit is cleared, which reduces the potential
247
 n=d multiples of d between 0 and n 1, inclusive. Corollary 31.21 The equation ax Á b .mod n/ is solvable for the unknown x if and only if d j b, where d D gcd.a; n/. Proof The equation ax Á b .mod n/ is solvable if and only if Œb 2 hai, which is
248
 sometimes coarsen the leaves of the recursion by executing several iterations in a single leaf, either automatically or under programmer control, thereby reducing the overhead of recursive spawning. This reduced overhead comes at the expense of also
249
 real numbers R. This section discusses how to solve a system of linear equations using a method called LUP decomposition. We start with a set of linear equations in n unknowns x1 ; x2 ; : : : ; xn :  814  Chapter 28 Matrix Operations  a11 x1 C a12
250
 deck. What is the probability that we select the three cards in sorted (increasing) order? C.2-4 Prove that  « ˚ Pr fA j Bg C Pr A j B D 1 : C.2-5 Prove that for any collection of events A1 ; A2 ; : : : ; An , Pr fA1 \ A2 \  \ An g D Pr fA1 g Pr fA2 j
251
 from an arbitrary list of n elements takes .n lg n/ time in the worst case.  12.2 Querying a binary search tree We often need to search for a key stored in a binary search tree. Besides the S EARCH operation, binary search trees can support such
252
 of insertion sort Figure 2.2 shows how this algorithm works for A D h5; 2; 4; 6; 1; 3i. The index j indicates the “current card” being inserted into the hand. At the beginning of each iteration of the for loop, which is indexed by j , the
253
 in the worst case because we must ﬁrst call L IST-S EARCH to ﬁnd the element. Sentinels The code for L IST-D ELETE would be simpler if we could ignore the boundary conditions at the head and tail of the list: L IST-D ELETE0 .L; x/ 1 x:pre :next D
254
 tightens an upper  bound. The use of the term is historical. The outcome of a relaxation step can be viewed as a relaxation of the constraint : d Ä u: d C w.u; /, which, by the triangle inequality (Lemma 24.10), must be satisﬁed if u: d D ı.s; u/
255
 h Á d m 1 .mod q/ is the value of the digit “1” in the high-order position of an m-digit text window. The solution of working modulo q is not perfect, however: ts Á p .mod q/ does not imply that ts D p. On the other hand, if ts 6Á p .mod q/, then we
256
 during insertion and deletion, let us examine the implementation of two order-statistic queries that use this additional information. We begin with an operation that retrieves an element with a given rank. The procedure OS-S ELECT .x; i/
257
 on n elements when n is odd, we end up with subproblems of size bn=2c and dn=2e. Neither size is actually n=2, because n=2 is not an integer when n is odd. Technically, the recurrence describing the worst-case running time of M ERGE -S ORT is really
258
 the problem into several subproblems that are similar to the original problem but smaller in size, solve the subproblems recursively, and then combine these solutions to create a solution to the original problem. The divide-and-conquer paradigm
259
 How does your answer to Exercise 33.2-2 change if we allow vertical segments?  33.3 Finding the convex hull The convex hull of a set Q of points, denoted by CH.Q/, is the smallest convex polygon P for which each point in Q is either on the
260
 We formally specify the selection problem as follows: Input: A set A of n (distinct) numbers and an integer i, with 1 Ä i Ä n. Output: The element x 2 A that is larger than exactly i  1 other elements of A.  We can solve the selection problem in O.n
261
 Aho, Hopcroft, and Ullman [5] used aggregate analysis to determine the running time of operations on a disjoint-set forest; we shall analyze this data structure using the potential method in Chapter 21. Tarjan [331] surveys the accounting and
262
 parameters: n, the number of M AKE -S ET operations, and m, the total number of M AKE -S ET, U NION, and F IND -S ET operations. Since the sets are disjoint, each U NION operation reduces the number of sets by one. After n 1 U NION operations,
263
 of a dynamic set, each element is represented by an object whose attributes can be examined and manipulated if we have a pointer to the object. (Section 10.3 discusses the implementation of objects and pointers in programming environments that do
264
 of length b.lg n/=2c is at most p n=b.lg n/=2c 1 p bn=b.lg n/=2cc Ä 1 1= n 1 1= n p 2n= lg n 1 Ä 1 1= n Ä e .2n= lg n 1/= D O.e lg n / D O.1=n/ :  p n  x For this argument, we used inequality (3.12), p 1 C x Ä e , and the fact, which you might want
265
 –1  3 2 1 4  3 1 2 4  0 1 0 0  0 0 0 1  0 3 5 –2  2 0.6 4 –2 4 2 3.4 –1 (a)  3 2 1 4  5 5 0.6 0 0.4 –2 –0.2 –1  4 2 1.6 –3.2 0.4 –0.2 4.2 –0.6 (d)  3 1 2 4  5 5 4 2 0.4 –2 0.4 –0.2 0.6 0 1.6 –3.2 –0.2 0.5 4 –0.5 (g)  3 1 4 2  1 0 0 0 P  0 0 1 0  ˘  2
266
 equivalence, 54, 1165 ex. modular exponentiation, 956 M ODULAR -E XPONENTIATION, 957 modular linear equations, 946–950 M ODULAR -L INEAR -E QUATION -S OLVER, 949 modulo, 54, 928 Monge array, 110 pr. monotone sequence, 168 monotonically decreasing, 53
267
 each test in line 6 of R ELABEL -T O -F RONT, list L is a topological sort of the vertices in the admissible network Gf;h D .V; Ef;h /, and no vertex before u in the list has excess ﬂow. Initialization: Immediately after I NITIALIZE -P REFLOW has
268
 Si are disjoint, we have Pith n that Pr fSg D i D1 Pr fSi g. Noting that we never succeed when the best-qualiﬁed applicant is one of the ﬁrst k, we have that Pr fSi g D 0 for i D 1; 2; : : : ; k. Thus, we obtain Pr fSg D  n X  Pr fSi g :  (5.12)  i
269
 the order-statistic tree of Figure 14.1 to ﬁnd the rank of the node with key 38, we get the following sequence of values of y:key and r at the top of the while loop: iteration 1 2 3 4  y:key 38 30 41 26  r 2 4 4 17  14.1 Dynamic order statistics 
270
 ingredient that an optimization problem must have for dynamic programming to apply is that the space of subproblems must be “small” in the sense that a recursive algorithm for the problem solves the same subproblems over and over, rather than always
271
 equivalently, that cn=4 c=2 an 0. If we add c=2 to both sides and factor out n, we get n.c=4 a/ c=2. As long as we choose the constant c so that c=4 a > 0, i.e., c > 4a, we can divide both sides by c=4 a, giving D  n  2c c=2 D : c=4 a c 4a  Thus, if
272
 trees pointed to by V:clusterŒ0 : : " u 1. Note that when a vEB tree contains two or more elements, we treat min and max differently: the element  20.3 The van Emde Boas tree  547  stored in min does not appear in any of the clusters, but the element
273
 support U NION in O.1/ time using a suitable list data structure. 10.2-7 Give a ‚.n/-time nonrecursive procedure that reverses a singly linked list of n elements. The procedure should use no more than constant storage beyond that needed for the list
274
 x-coordinate, we break the tie by putting all the covertical left endpoints before the covertical right endpoints. Within a set of covertical left endpoints, we put those with lower y-coordinates ﬁrst, and we do the same within a set of covertical
275
 (lower right). (d)–(f) The second step. (g)–(i) The third step. No further changes occur on the fourth (ﬁnal) step. (j) The LUP decomposition PA D LU .  28.2 Inverting matrices  827  28.1-3 Solve the equation 1 5 4 2 0 3 5 8 2  x1 x2 x3  D  12
276
 Pugh. Skip lists: A probabilistic alternative to balanced trees. Communications of the ACM, 33(6):668–676, 1990. [287] Paul W. Purdom, Jr. and Cynthia A. Brown. The Analysis of Algorithms. Holt, Rinehart, and Winston, 1985. [288] Michael O. Rabin.
277
 , for k D 0; 1; : : : ; n 1, by yk D A.!nk / n 1 X aj !nkj : D  (30.8)  j D0  The vector y D .y0 ; y1 ; : : : ; yn 1 / is the discrete Fourier transform (DFT) of the coefﬁcient vector a D .a0 ; a1 ; : : : ; an 1 /. We also write y D DFTn .a/. The FFT
278
 plugged into objective function (29.58), has objective value .3 9/ C .1 0/ C .2 0/ D 27. Continuing the example, we wish to ﬁnd a new variable whose value we wish to increase. We do not want to increase x6 , since as its value increases, the
279
 string one at a time. If the automaton is in state q and reads input character a, it moves (“makes a transition”) from state q to state ı.q; a/. Whenever its current state q is a member of A, the machine M has accepted the string read so far. An
280
 the relative order of ai and aj . We therefore assume that all comparisons have the form ai Ä aj . The decision-tree model We can view comparison sorts abstractly in terms of decision trees. A decision tree is a full binary tree that represents the
281
 than a shortest path from i to j . The actual shortest-path weights are therefore given by ı.i; j / D lij.n  1/  D lij.n/ D lij.nC1/ D  :  (25.3)  688  Chapter 25 All-Pairs Shortest Paths  Computing the shortest-path weights bottom up Taking as
282
 1147 digital signature, 960 digraph, see directed graph D IJKSTRA, 658 Dijkstra’s algorithm, 658–664, 682 for all-pairs shortest paths, 684, 704 implemented with a Fibonacci heap, 662 implemented with a min-heap, 662 with integer edge weights, 664 ex.
283
 at 0 as the probability that a “random walk” beginning at 0 will follow the speciﬁed path, where we randomly choose which edge to take leaving a vertex u according to the probabilities of the available edges leaving u. b. Extend your answer to
284
 rank 17. Since each iteration of the while loop takes O.1/ time, and y goes up one level in the tree with each iteration, the running time of OS-R ANK is at worst proportional to the height of the tree: O.lg n/ on an n-node order-statistic tree.
285
 and modern implementations use significant reﬁnements of the basic techniques presented here. In addition, many new techniques have been developed for proving cryptosystems to be secure. For example, Goldwasser and Micali [142] show that
286
 b is d.a; b/ D ja bj. e. Find the best solution for the 2-dimensional post-ofﬁce location problem, in which the points are .x; y/ coordinate pairs and the distance between points a D .x1 ; y1 / and b D .x2 ; y2 / is the Manhattan distance given by
287
 of a stack, 188 pr. depth-determination problem, 583 pr. depth-ﬁrst forest, 603 depth-ﬁrst search, 603–612, 623  in ﬁnding articulation points, bridges, and biconnected components, 621 pr. in ﬁnding strongly connected components, 615–621, 623 in
288
 are problems, such as Turing’s famous “Halting Problem,” that cannot be solved by any computer, no matter how much time we allow. There are also problems that can be solved, but not in time O.nk / for any constant k. Generally, we think of
289
 Ã Â 1 1 1 .45/ D 45 1 3 5 Â ÃÂ Ã 4 2 D 45 3 5 D 24 : If p is prime, then Zp D f1; 2; : : : ; p Ã Â 1 .p/ D p 1 p D p 1: If n is composite, then .n/ < n n .n/ > e ln ln n C ln ln3 n  1g, and  (31.21)  1, although it can be shown that (31.22)  for n 3,
290
 or equal to i by keeping a running sum of the array C .  196  Chapter 8 Sorting in Linear Time  Finally, the for loop of lines 10–12 places each element AŒj  into its correct sorted position in the output array B. If all n elements are distinct,
291
 analysis. The cost of the ith operation is ( i if i 1 is an exact power of 2 ; ci D 1 otherwise : The total cost of n TABLE -I NSERT operations is therefore n X i D1  X  blg nc  ci  Ä nC  2j  j D0  < n C 2n D 3n ; because at most n operations
292
 idea of balancing a search tree is due to Adel’son-Vel’ski˘ı and Landis [2], who introduced a class of balanced search trees called “AVL trees” in 1962, described in Problem 13-3. Another class of search trees, called “2-3 trees,” was introduced by
293
 space be closed under the operations of taking the complement of an event, forming the union of a ﬁnite or countable number of events, and taking the intersection of a ﬁnite or countable number of events. Most of the probability distributions we shall
294
 tree is the value stored at that node. The number above a node is the corresponding index in the array. Above and below the array are lines showing parent-child relationships; parents are always to the left of their children. The tree has height three;
295
 executing line 5 takes only ‚.1/ time (although we shall see that it makes no difference asymptotically to the overall running time whether we copy or partition in place). Now, we derive a recurrence to characterize the running time of S
296
 the other as a result of the link operation, and so lines 9–10 exchange the pointers to x and y if necessary. Next, we link y to x by the call F IB -H EAP -L INK .H; y; x/ in line 11. This call increments x:degree but leaves y:degree as d . Node y is
297
 optimal solution to the problem from optimal solutions to subproblems. In the matrix-chain multiplication problem, we can perform this step as follows. For convenience, let us adopt the notation Ai ::j , where i Ä j , for the matrix that results from
298
 842 Toeplitz, 921 pr. transpose of, 797 ex., 1217 transpose of, multithreaded, 792 ex. tridiagonal, 1219 unit lower-triangular, 1219 unit upper-triangular, 1219 upper-triangular, 1219, 1225 ex. Vandermonde, 902, 1226 pr. matrix-chain
299
 does not start at zero. The counter starts with b0 1s, and after n I NCREMENT  462  Chapter 17 Amortized Analysis  operations it has bn 1s, where 0 Ä b0 ; bn Ä k. (Recall that k is the number of bits in the counter.) We can rewrite equation (17.3) as
300
 mechanical disk drives, they cost more per gigabyte and have lower capacities than mechanical disk drives.  Chapter 18  B-Trees  487  nonetheless use the number of pages read or written as a ﬁrst-order approximation of the total time spent
301
 and parallelism of this computation. 27.2-2 Repeat Exercise 27.2-1 for P-M ATRIX -M ULTIPLY-R ECURSIVE. 27.2-3 Give pseudocode for a multithreaded algorithm that multiplies two n with work ‚.n3 / but span only ‚.lg n/. Analyze your algorithm.  n
302
 of the Web. Think of the Web as a directed graph, where pages are the nodes, and there is an arc from page p1 to page p2 if there are one or more links from p1 to p2 . Figure 5.1 is an example of a tiny version of the Web, where there are only four
303
 responding to searches for products, recording sales, and so on, processes that involve relatively little calculation and that change the database.2 On the other hand, Amazon might use MapReduce to perform certain analytic queries on large amounts of
304
 “On lines and planes of closest fit to systems of points in space,” Philosophical Magazine 2:11 (1901), pp. 559–572.  11.6. REFERENCES FOR CHAPTER 11  435  7. J. Sun, Y. Xie, H. Zhang, and C. Faloutsos, “Less is more: compact matrix decomposition
305
 as would be the case for a reputable newspaper that allowed readers to post comments. To implement TrustRank, we need to develop a suitable teleport set of trustworthy pages. Two approaches that have been tried are: 1. Let humans examine a set of
306
 even if we want only a count of the nodes in each neighborhood, we need to remember the nodes found so far as we explore the graph, or else we shall not know whether a new node found is one we have seen already. On the other hand, it is not so hard
307
 reducer gets q inputs, it cannot cover more than q2 , or approximately q 2 /2 outputs. For step (2), we know there are a total of p2 , or approximately p2 /2 outputs that each must be covered. The inequality constructed at step (3) is thus k i=1  qi2
308
 and cluster each chunk in parallel, using a Map task. The clusters from each Map task can be further clustered in a single Reduce task.  278  7.8  CHAPTER 7. CLUSTERING  References for Chapter 7  The ancestral study of clustering for large-scale
309
 LEARNING FROM NEAREST NEIGHBORS  12.4.6  477  Dealing with Non-Euclidean Distances  To this point, we have assumed that the distance measure is Euclidean. However, most of the techniques can be adapted naturally to an arbitrary distance function d.
310
 in working storage. However, for even the largest sites, that data is not more than a few terabytes, and so surely can be stored on disk. 2  4.1.4  Issues in Stream Processing  Before proceeding to discuss algorithms, let us consider the constraints
311
 This relation has tuples that are pairs (a, b) such that b is a friend of a. The site might want to develop statistics about the number of friends members have. Their first step would be to compute a count of the number of friends of each user.
312
 information anyway, and a second is that the entity resolution problem of matching movie names as given in NetFlix and IMDB data is not that easy to solve exactly. • Time of rating turned out to be useful. It appears there are movies that are more
313
 The same set of integers, but with each integer appearing only once. (d) The count of the number of distinct integers in the input. Exercise 2.3.2 : Our formulation of matrix-vector multiplication assumed that the matrix M was square. Generalize the
314
 do not apply to other examples that must be classified in the future, the classifier will not perform well on new data. Another problem is illustrated in Fig. 12.12. Usually, if classes can be separated by one hyperplane, then there are many
315
 in the index bucket for that symbol, and we compare s with all the strings appearing in that bucket. If we want to solve the many-many problem, start with an empty database of strings and indexes. For each set S, we treat S as a new set for the
316
 1 0 1 0 0 0  the 0 1 1 0 1 1  of 1 1 0 1 0 1  nigeria 1 0 0 0 1 0  y +1 −1 +1 −1 +1 −1  Figure 12.6: Training data for spam emails In this example, we shall use learning rate η = 1/2, and we shall visit each training example once, in the order
317
 the total number of occurrences of w among all those documents. 2  2.2.4  Combiners  Sometimes, a Reduce function is associative and commutative. That is, the values to be combined can be combined in any order, with the same result. The addition
318
 given by h and g. How close are these estimates?  10.9  Summary of Chapter 10  ✦ Social-Network Graphs: Graphs that represent the connections in a social network are not only large, but they exhibit a form of locality, where small subsets of
319
 be considered, that is, ⌊(1 − J)Ls ⌋ + 1. For each symbol appearing in one of the prefix positions of s, we look in the index bucket for that symbol, and we compare s with all the strings appearing in that bucket. If we want to solve the many-many
320
 network is the “friends” relation found on sites like Facebook. However, as we shall see there are many other sources of data that connect people or other entities. In this chapter, we shall study techniques for analyzing such networks. An
321
 place (just) item profiles in buckets. In that way, given a user to whom we want to recommend some items, we can apply the same two techniques – random hyperplanes and LSH – to determine in which buckets we must look for items that might have a small
322
 s, then the fraction of good pairs with score s is (h1 − h)/(h1 − h0 ).  3.8.4  Matching Fingerprints  When fingerprints are matched by computer, the usual representation is not an image, but a set of locations in which minutiae are located. A
323
 of columns of N . Similarly, for each element njk of N , produce all the key-value pairs (i, k), (N, j, njk ) for i = 1, 2, . . ., up to the number of rows of M . As before, M and N are really bits to tell which of the two relations a value comes
324
 eigenvector of M by starting with the initial vector v0 and multiplying by M some number of times, until the vector we get shows little change at each round. In practice, for the Web itself, 50–75 iterations are sufficient to converge to within the
325
 is the minimum of this expression n under the constraint that i=1 x2i = 1. Intuitively, we minimize it by making xi and xj close whenever there is an edge between √ nodes i and j in the graph. We might imagine that we could choose xi = 1/ n
326
 then join R with the result, we get another algorithm whose communication cost is O(r + s + t + pst). A third way to take this join is to use a single MapReduce job that joins the three relations at once. Suppose that we plan to use k reducers for
327
 . . . . . . . . . . . . . 4.6.7 Extensions to the Counting of Ones . . . 4.6.8 Exercises for Section 4.6 . . . . . . . . . . Decaying Windows . . . . . . . . . . . . . . . . . 4.7.1 The Problem of Most-Common Elements 4.7.2 Definition of the
328
 causes the clustroid to change. The assumption is made that the new clustroid would be one of these k points near the old clustroid. 5. The k points of the cluster that are furthest from the clustroid and their rowsums. These points are part of
329
 technique) to distinguish strongly between pairs at a low distance from pairs at a high distance. The steepness of the S-curve in Fig. 3.7 reflects how effectively we can avoid false positives and false negatives among the candidate pairs. Now, we
330
 . . . . . . 8.1.1 Advertising Opportunities . . . . 8.1.2 Direct Placement of Ads . . . . . 8.1.3 Issues for Display Ads . . . . . . 8.2 On-Line Algorithms . . . . . . . . . . . 8.2.1 On-Line and Off-Line Algorithms 8.2.2 Greedy Algorithms . . . . .
331
 these observations make intuitive sense, given that A and C disagree on the two movies they rated in common, while A and B give similar scores to the one movie they rated in common. 2  9.3.2  The Duality of Similarity  The utility matrix can be
332
 magnitude (a factor of 105 ) slower than the time taken to read a word from main memory, so if all we want to do is access a few bytes, there is an overwhelming benefit to having data in main memory. In fact, if we want to do something simple to every
333
 of each input tuple into a key-value pair, we expect that the computation cost will be small compared with the communication cost, regardless of whether the input is local to the task or must be transported to its compute node. The sum of
334
 Many Bidders  When there are many advertisers, the competitive ratio for the Balance Algorithm can be under 3/4, but not too far below that fraction. The worst case for Balance is as follows. 1. There are N advertisers, A1 , A2 , . . . , AN . 2.
335
 spaces. For any constant r, we can define the Lr -norm to be the distance measure d defined by: n  d([x1 , x2 , . . . , xn ], [y1 , y2 , . . . , yn ]) = ( i=1  |xi − yi |r )1/r  The case r = 2 is the usual L2 -norm just mentioned. Another
336
 the matrix M into square blocks, rather than stripes.  2.3.3  Relational-Algebra Operations  There are a number of operations on large-scale data that are used in database queries. Many traditional database applications involve retrieval of small
337
 of the Reduce task.  7.6.7  Exercises for Section 7.6  Exercise 7.6.1 : Execute the BDMO Algorithm with p = 3 on the following 1-dimensional, Euclidean data: 1, 45, 80, 24, 56, 71, 17, 40, 66, 32, 48, 96, 9, 41, 75, 11, 58, 93, 28, 39, 77 The
338
 size of x ∪ y, so d(x, y) is strictly positive. 3. d(x, y) = d(y, x) because both union and intersection are symmetric; i.e., x ∪ y = y ∪ x and x ∩ y = y ∩ x. 4. For the triangle inequality, recall from Section 3.3.3 that SIM(x, y) is the probability
339
 know the bucket to which Z hashes. Thus, we must send E(u, v) to all Reducer tasks that correspond to a sequence of three bucket numbers h(u), h(v), z for any of the b possible buckets z. But the same tuple E(u, v) must also be treated as a tuple
340
 that we must look in the buckets for (a, 1), (a, 2), and (c, 1), but in no other bucket. In comparison, using the buckets of Section 3.9.4, we would look into the buckets for a and c, which is equivalent to looking to all buckets (a, j) and (c, j)
341
 is that we store only a short vector for each user, rather than an enormous vector for each user. Example 5.9 : One useful topic set is the 16 top-level categories (sports, medicine, etc.) of the Open Directory (DMOZ).6 We could create 16
342
 wrong side of the hyperplane, but minimize the error due to such misplaced points. ✦ Solving the SVM Equations: We can set up a function of the vector that is normal to the hyperplane, the length of the vector (which determines the margin), and the
343
 calculate the edit distance d(x, y) is to compute a longest common subsequence (LCS) of x and y. An LCS of x and y is a string that is constructed by deleting positions from x and y, and that is as long as any string that can be constructed that way.
344
 a request to use the MMDS materials.  Acknowledgements Cover art is by Scott Ullman. We would like to thank Foto Afrati, Arun Marathe, and Rok Sosic for critical readings of a draft of this manuscript. Errors were also reported by Apoorv Agarwal,
345
 . For step (2), we know the number of outputs is n2 . In step (3) we observe that if there are k reducers, with the ith reducer receiving qi ≤ q inputs, then k i=1  qi2 /4n2 ≥ n2  or k i=1  qi2 ≥ 4n4  From this inequality, you can derive r ≥ 2n2 /q
346
 there is too much change between z and y, then use binary search in the range between z and y instead.  7.3.4  The Algorithm of Bradley, Fayyad, and Reina  This algorithm, which we shall refer to as BFR after its authors, is a variant of k-means that
347
 Figure 3.12 suggests two possible hyperplanes, one whose intersection is the dashed line and the other’s intersection is the dotted line. To pick a random hyperplane, we actually pick the normal vector to the hyperplane, say v. The hyperplane is
348
 Longest common subsequence Isard, M., 69 Leaf, 350 Isolated component, 168 Learning-rate parameter, 446  488 Leiser, N, 69 Length, 144, 385 Length indexing, 117 Leskovec, J., 400–402 Leung, S.-T., 69 Likelihood, 367 Lin, S., 127 Linden, G., 339 Linear
349
 of thousands of independent components, any of which could fail at any time. In this section, we discuss both the characteristics of these computing installations and the specialized file systems that have been developed to take advantage of them. 
350
 training  456  CHAPTER 12. LARGE-SCALE MACHINE LEARNING  ?  Figure 12.12: Generally, more that one hyperplane can separate the classes if they can be separated at all a perceptron stop as soon as there are no misclassified points. As a result, the
351
 4, 1], +1) ([1, 1, 1], −1)  ([2, 2, 1], +1) ([2, 1, 1], −1)  ([3, 4, 1], +1) ([3, 1, 1], −1)  467  12.3. SUPPORT-VECTOR MACHINES  In Fig. 12.19 we tabulate the if-then conditions and the resulting contributions to the summations over i in Equation
352
 closest to p. We adjust the representation of this cluster to account for the new node p. In particular, we: 1. Add 1 to N . 2. Add the square of the distance between p and each of the nodes q mentioned in the representation to ROWSUM(q). These points
353
 vector and loop infinitely. Unfortunately, it is often hard to tell, as the algorithm is running, which of these two cases applies. When the data is large, it is not feasible to remember all previous weight vectors to see whether we are repeating a
354
 hard, when that set is too large to store in main memory. In this section, we shall discuss the technique known as “Bloom filtering” as a way to eliminate most of the tuples that do not meet the criterion.  4.3.1  A Motivating Example  Again let
355
 parameters that characterize families of MapReduce algorithms. The first is the reducer size, which we denote by q. This parameter is the upper bound on the number of values that are allowed to appear in the list associated with a single key. Reducer
356
 bid. This policy is known as a first-price auction. In reality, search engines use a more complicated system known as a second-price auction, where each advertiser pays approximately the bid of the advertiser who placed immediately behind them in
357
 of N , SUM, and SUMSQ, while if we used the centroid and standard deviations as a representation, the calculation would be far more complex.  1. First, all points that are sufficiently close to the centroid of a cluster are added to that cluster. As
358
 we could merge until it is impossible to find a pair of clusters whose merger is sufficiently compact, e.g., the merged cluster has a radius or diameter below some threshold. Another approach involves merging as long as the resulting
359
 of news articles. We should understand that the aspect of similarity we are looking at here is character-level similarity, not “similar meaning,” which requires us to examine the words in the documents and their uses. That problem is also
360
 any community causes it to exist. More formally, puv , the probability of an edge between nodes u and v can be calculated as puv = 1 −  C  1 − pC (u, v)  If we substitute the formula for pC (u, v) that is assumed in the model, we get puv = 1 − e−  P 
361
 the nodes of the graph. The important property of the bit string we get when we apply hash function h to node v is the “tail length” – the number of 0’s at the end of the string. For any set of nodes, an estimate of the size of the set is 2R , where
362
 a sample of user-query pairs by making both those components form the key. To take a sample of size a/b, we hash the key value for each tuple to b buckets, and accept the tuple for the sample if the hash value is less than a. If the key consists of
363
 of the Triangle-Finding Algorithm  It turns out that the algorithm described in Section 10.7.2 is, to within an order of magnitude the best possible. To see why, consider a complete graph on n nodes. This graph has m = n2 edges and the number of
364
  457  Figure 12.13: Perceptrons converge as soon as the separating hyperplane reaches the region between classes dot product with the label y, which is +1 or −1, associated with x. If the signs agree, no key-value pairs are produced for this
365
 estimate for each page, where n is the total number of pages. ✦ Taxation and Random Surfers: The calculation of PageRank using taxation parameter β can be thought of as giving each random surfer a probability 1 − β of leaving the Web, and introducing
366
 PageRank for a large graph representing the Web, we have to perform a matrix–vector multiplication on the order of 50 times, until the vector is close to unchanged at one iteration. To a first approximation, the MapReduce method given in Section
367
 was first observed in [6]. 1. A. Broder, R. Kumar, F. Maghoul, P. Raghavan, S. Rajagopalan, R. Stata, A. Tomkins, and J. Weiner, “Graph structure in the web,” Computer Networks 33:1–6, pp. 309–320, 2000. 2. M.M. Gaber, Scientific Data Mining and
368
 we move to the row numbered 1 in Fig. 3.4. This row has 1 only in S3 , and its hash values are h1 (1) = 2 and h2 (1) = 4. Thus, we set SIG(1, 3) to 2 and SIG(2, 3) to 4. All other signature entries remain as they are because their columns have 0
369
 This plan is not usually the best. One problem is that there is overhead associated with each task we create, so we might want to keep the number of Reduce tasks lower than the number of different keys. Moreover, often there are far more keys than
370
 border frequent in the whole? !! Exercise 6.4.3 : Suppose item i appears exactly s times in a file of n baskets, where s is the support threshold. If we take a sample of n/100 baskets, and lower the support threshold for the sample to s/100, what
371
 in the utility matrix. It is often useful to normalize the utility matrix by subtracting the average value (either by row, by column, or both) before measuring the cosine distance. ✦ Clustering Users and Items: Since the utility matrix tends to be
372
 Many Web applications involve advising users on what they might like. The Netflix challenge is one example, where it is desired to predict what movies a user would like, or Amazon’s problem of pitching a product to a customer based on information
373
 . . . . . . . . . . . . . . . . . . . . . .  . . . . . . .  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  . . . . . . . . . . . . . . . . . . . . . .
374
 Reduce tasks (measured by counting key-value pairs) per input.  2.6. COMPLEXITY THEORY FOR MAPREDUCE  53  Example 2.11 : Let us consider the one-pass matrix-multiplication algorithm of Section 2.3.10. Suppose that all the matrices involved are n × n
375
 once. ✦ Perceptrons: This machine-learning method assumes the training set has only two class labels, positive and negative. Perceptrons work when there is a hyperplane that separates the feature vectors of the positive examples from those of the
376
 (v, i) after some round of MapReduce. To construct N (v, i + 1) we need to join Reach with the Arc relation, then project onto the second component and perform a union of the result with the old value of Reach. In SQL terms, we perform SELECT DISTINCT
377
 which require more than a day to visit. These are the circles and squares, respectively. Evidently, there is no straight line that separates day trips from excursions. However, if we replace the Cartesian coordinates by polar coordinates, then
378
 hash nodes to b buckets. Order nodes by their name, considering only the first component (i.e., the bucket to which the node hashes), and only using the second component to break ties among nodes that are in the same bucket. If we use this ordering of
379
 vector a, we are happy because the training example is positive, and so is the dot product. However, for the second training example, we compute w.b = 1. Since the example is negative and the dot product is positive, we must adjust the weights.
380
 cosine distance measure by identifying each function with a list of randomly chosen vectors. We apply a function to a given vector v by taking the dot product of v with each vector on the list. The result is a sketch consisting of the signs (+1 or
381
 compute when analysis of very large amounts of data is involved. A pervasive issue in later chapters will be the exploitation of the MapReduce methodology to implement the algorithms we cover. Chapter 3 is about finding similar items. Our starting
382
 BPC BellKor.pdf 2009. 5. G. Linden, B. Smith, and J. York, “Amazon.com recommendations: itemto-item collaborative filtering,” Internet Computing 7:1, pp. 76–80, 2003. 6. M. Piotte and M. Chabbert, ”The Pragmatic Theory
383
 + b = −1  Figure 12.15: Normalizing the weight vector for an SVM  x1 = x2 + 2γ  w w  (12.1)  Since x1 is on the hyperplane defined by w.x + b = +1, we know that w.x1 + b = 1. If we substitute for x1 using Equation 12.1, we get w. x2 + 2γ  w w  +b=1 
384
 our analysis of the first MapReduce job that √ g =√n 2/q, we can write the communication for the second job as n2 g = 2n3 / q. This amount is exactly half the communication√for the first job, so the total communication for the √ two-pass algorithm is
385
 a surfer is to be at a page, the more important the page is. We can compute the principal eigenvector of M by starting with the initial vector v0 and multiplying by M some number of times, until the vector we get shows little change at each round. In
386
 graph does not tell us a detail that could be important: who placed which tag on which page? To represent such ternary information would require a more complex representation, such as a database relation with three columns corresponding to users,
387
 through the baskets and counting all and only the itemsets of size k that are in Ck . Those itemsets that have count at least s are in Lk .  6.2.7  Exercises for Section 6.2  Exercise 6.2.1 : If we use a triangular matrix to count pairs, and n, the
388
 to a user are those preferred by similar users. This sort of recommendation system can use the groundwork laid in Chapter 3 on similarity search and Chapter 7 on clustering. However, these technologies by themselves are not sufficient, and
389
 Thus, even if we cannot calculate p1 and p2 easily, we know that there is a (d1 , d2 , p1 , p2 )-sensitive family of hash functions for any d1 < d2 and any given number of dimensions. Using the amplification techniques of Section 3.6.3, we can
390
 Map task, 23, 25 Map worker, 26, 27 Mapping schema, 56  INDEX MapReduce, 15, 19, 22, 28, 175, 177, 227, 273, 381, 388, 456 Margin, 459 Market basket, 4, 16, 199, 200, 207 Markov process, 165, 168, 375 Martin, G.N., 160 Master controller, 23, 24, 26
391
 2  10.4.4  Eigenvalues of the Laplacian Matrix  We can get a good idea of the best way to partition a graph from the eigenvalues and eigenvectors of its Laplacian matrix. In Section 5.1.2 we observed how the principal eigenvector (eigenvector
392
 then throw away all pairs that do not have v as their first component. But we cannot throw away all those pairs until we are done. During the computation of the transitive closure, we could wind up computing many facts P ath(x, y), where neither x nor
393
 set is available at any time and can be used in repeated passes. On-line learning uses a stream of training examples, each of which can be used only once. ✦ Perceptrons: This machine-learning method assumes the training set has only two class
394
 measuring the density of a cluster, based on the radius or diameter. Both these notions make sense in the non-Euclidean environment. The diameter is still the maximum distance between any two points in the cluster. The radius can be defined using the
395
 for Fig. 10.12 Example 10.17 : The degree matrix for the graph of Fig. 10.12 is shown in Fig. 10.14. We use the same order of the nodes as in Example 10.16. For instance, the entry in row 4 and column 4 is 4 because node D has edges to four other
396
 or “chesterfield,” then there is no harm, and potentially a benefit, in giving the query to A. It will still be possible for B to spend its entire budget, while we are increasing the amount of A’s budget that will be spent. Note that this argument
397
 for Euclidean Distance  Now, let us turn to the Euclidean distance (Section 3.5.2), and see if we can develop a locality-sensitive family of hash functions for this distance. We shall start with a 2-dimensional Euclidean space. Each hash function f
398
 so far discussed in this chapter. We assume the computation is described by an acyclic workflow, as discussed in Section 2.4.1. For many applications, the bottleneck is moving data among tasks, such as transporting the outputs of Map tasks to their
399
 rated in common will have a relatively small angle between them. Example 9.9 : Figure 9.6 shows the matrix of Fig. 9.4 with all ratings normalized. An interesting effect is that D’s ratings have effectively disappeared, because a 0 is the same as a
400
 preprocessing of the training set enables the computation of f (x) to proceed efficiently. We shall consider an important kind of instance-based learning, k-nearest-neighbor, in Section 12.4. For example, 1-nearestneighbor classifies data by
401
 reviews.  12.1.5  Exercises for Section 12.1  Exercise 12.1.1 : Redo Example 12.2 for the following different forms of f (x). (a) Require f (x) = ax; i.e., a straight line through the origin. Is the line 14 x that we discussed in the example
402
 is described in [4], and the idea of spam mass is taken from [3]. The HITS (hubs and authorities) idea was described in [7]. 1. S. Brin and L. Page, “Anatomy of a large-scale hypertextual web search engine,” Proc. 7th Intl. World-Wide-Web
403
 set.  446  CHAPTER 12. LARGE-SCALE MACHINE LEARNING  w  w.x = θ  Figure 12.4: A perceptron divides a space by a hyperplane into two half-spaces We begin by assuming the threshold is 0; the simple augmentation needed to handle an unknown threshold is
404
 X row, then surely h(S1 ) = h(S2 ). On the other hand, if the first row other than a type Z row that we meet is a type Y row, then the set with a 1 gets that row as its minhash value. However the set with a 0 in that row surely gets some row further
405
 threshold. The pair would be output if so. Alas, this algorithm will fail completely. The reducer size is small, since no list has more than two values, or a total of 2MB of input. Although we don’t know exactly how the similarity function s
406
 link only to A, and page D has links to B and C only.  A  B  C  D  Figure 5.1: A hypothetical example of the Web Suppose a random surfer starts at page A in Fig. 5.1. There are links to B, C, and D, so this surfer will next be at each of those pages
407
 for each movie, “liked” and “hated.” If a customer rated a movie highly, put the “liked” for that movie in the customer’s set. If they gave a low rating to a movie, put “hated” for that movie in their set. Then, we can look for high Jaccard
408
 clear. We shall study here another form of locality-sensitive hashing that works well for data of the type we are discussing. Suppose for an example that the probability of finding a minutia in a random grid square of a random fingerprint is 20%.
409
 To implement gradient descent, we compute the derivative of the equation with respect to b and each component wj of the vector w. Since we want to minimize f (w, b), we move b and the components wj in the direction opposite to the direction of the
410
 average value in its component. What would be the values of α and β, and what would be the angles between the vectors? Exercise 9.2.2 : An alternative way of scaling components of a vector is to begin by normalizing the vectors. That is, compute the
411
 are similar if they contain large, identical sequences of characters. For recommendation systems, the notion of similarity is different. We are interested only in the occurrences of many important words in both documents, even if there is little
412
 row of U is 0, because Joe doesn’t rate romance movies at all. The matrix V relates movies to concepts. The 0.58 in each of the first three columns of the first row of V T indicates that the first three movies – Matrix, Alien, and Star Wars – each are
413
 even in very high-dimensional spaces. However, the argument about random data suggests that it will be hard to find these clusters among so many pairs that are all at approximately the same distance. Angles Between Vectors Suppose again that we have
414
 000000, 110011, 010101, and 011100, which of the six functions makes them candidates? Exercise 3.7.2 : Let us compute sketches using the following four “random” vectors: v1 = [+1, +1, +1, −1] v3 = [+1, −1, +1, +1]  v2 = [+1, +1, −1, +1] v4 = [−1,
415
 Reduction  An entirely different approach to estimating the blank entries in the utility matrix is to conjecture that the utility matrix is actually the product of two long, thin matrices. This view makes sense if there are a relatively small set
416
 8 we find d, and so set X2 .element = d and X2 .value = 1. Positions 9 and 10 hold a and b, so they do not affect X1 or X2 . Position 11 holds d so we set X2 .value = 2, and position 12 holds c so we set X1 .value = 3. At position 13, we find
417
 the training points. If no such hyperplane exists, then the perceptron will not converge to any one hyperplane. In the next section, we discuss supportvector machines, which do not have this limitation; they will converge to some separator that,
418
 frequent pairs by making two passes over the baskets. On the first pass, we count the items themselves, and then determine which items are frequent. On the second pass, we count only the pairs of items both of which are found frequent on the first
419
 with y = +1 (the positive examples) are on the positive side of the hyperplane and all those with y = −1 (the negative examples) are on the negative side. It may or may not be possible to do so, since there is no guarantee that any hyperplane separates
420
 of a path relation (pairs of nodes v and u such that u is known to be reachable from v) and the arc relation of the graph. Such an approach requires a number of MapReduce rounds equal to the diameter of the graph. ✦ Transitive Closure by Recursive
421
 of frequent items in that basket. 3. For each such pair, add one to its count in the data structure used to store counts. Finally, at the end of the second pass, examine the structure of counts to determine which pairs are frequent.  6.2.6  A-Priori
422
 a general theorem based on these two parameters of a set of points? ! Exercise 7.3.3 : Give an example of a dataset and a selection of k initial centroids such that when the points are reassigned to their nearest centroid at the end, at least one of
423
 example, the arc could mean that individual u is following individual v on Twitter. In yet another graph, the arc could mean that research paper u references paper v. Moreover, all undirected graphs can be represented by directed graphs. Instead
424
 Worker processes by the Master. It is reasonable to create one Map task for every chunk of the input file(s), but we may wish to create fewer Reduce tasks. The reason for limiting the number of Reduce tasks is that it is necessary for each Map task to
425
 ν is neither 0 or 1, the equations for c and e tell us immediately that c = e = 0. Finally, if we recognize that a is the largest component of h and set a = 1, we get b = 0.3583 and d = 0.7165. Along with c = e = 0, these values give us the limiting
426
 is a noticeable difference between text that appears in prose and text that appears in ads or headlines. Prose has a much greater frequency of stop words, the very frequent words such as “the” or “and.” The total number of words that are considered
427
 the number of distinct elements by hashing the elements of the universal set to a bit-string that is sufficiently long. The length of the bit-string must be sufficient that there are more possible results of the hash function than there are
428
 example where the dual of G′ is not isomorphic to G.  10.2. CLUSTERING OF SOCIAL-NETWORK GRAPHS  10.2  347  Clustering of Social-Network Graphs  An important aspect of social networks is that they contain communities of entities that are connected
429
 memory. The conclusion is that we cannot count anything that doesn’t fit in main memory. Thus, each algorithm has a limit on how many items it can deal with. Example 6.5 : Suppose a certain algorithm has to count all pairs of items, and there are n
430
 and the needed counts of itemsets in main memory. The support threshold must be scaled down in proportion. We can then find the frequent itemsets for the sample, and hope that it is a good representation of the data as whole. While this method uses
431
 of size 2j . Then j cannot exceed log2 N , or else there are more 1’s in this bucket than there are 1’s in the entire window. Thus, there are at most two buckets of all sizes from log2 N down to 1, and no buckets of larger sizes. We conclude that
432
 304 IMDB, see Internet Movie Database Kamm, D., 336 Imielinski, T., 236 Kang, U., 401 Immediate subset, 228 Kannan, R., 434 Immorlica, N., 127 Karlin, A., 284 Important page, 162 Kaushik, R., 127 Impression, 280 Kautz, W.H., 160 In-component, 167
433
 components by computing πU1,U3 (L1 ⊲⊳ L2). 2 Example 2.5 : Imagine that a social-networking site has a relation Friends(User, Friend) This relation has tuples that are pairs (a, b) such that b is a friend of a. The site might want to develop
434
 where the given matrix is sparse, the matrices constructed by SVD are dense. The CUR decomposition seeks to decompose a sparse matrix into sparse, smaller matrices whose product approximates the original matrix. ✦ CUR Decomposition: This method
435
 and more sample clustroids at the parent node. Again, there may be extra space, but if not, then this node too must be split, and we do so to minimize the squares of the distances between the sample clustroids assigned to different nodes. As in a
436
 equation for y, yielding y=  x m +c 1 − β2 n  where c = β(1 − β)/(1 − β 2 ) = β/(1 + β). Example 5.11 : If we choose β = 0.85, then 1/(1 − β 2 ) = 3.6, and c = β/(1 + β) = 0.46. That is, the structure has amplified the external PageRank
437
 and double the last component, yielding w = [ 21 , 2, 1, 14 , 1, 2]. Now, all positive examples have a positive dot product with the weight vector, and all negative examples have a negative dot product, so there are no further changes to the weights.
438
 blend of interests. We could also use the same procedure on the pages that the user currently has bookmarked, or combine the bookmarked pages with the recently viewed pages.  5.3.5  Exercises for Section 5.3  Exercise 5.3.1 : Compute the
439
 tail, together with a well designed recommendation system can influence events is the story told by Chris Anderson about a book called Touching the Void. This mountain-climbing book was not a big seller in its day, but many years after it was
440
 : Let us reconsider Fig. 7.2. It has three natural clusters. We computed the diameter of the largest – the five points at the right – in Example 7.4; it is 4.24. The diameter of the 3-node cluster at the lower left is 3, the distance between (2,2)
441
 by the consonants in reverse alphabetic order. Represent the following sets as strings. a {q, w, e, r, t, y}.  3.10. SUMMARY OF CHAPTER 3  107  (b) {a, s, d, f, g, h, j, u, i}. Exercise 3.9.2 : Suppose we filter candidate pairs based only on
442
 false negatives completely, but we can reduce their number if the amount of main memory allows it. We have assumed that if s is the support threshold, and the sample is fraction p of the entire dataset, then we use ps as the support threshold for the
443
 to produce enough free work to satisfy the needs for tagged data.  there are enough tags that occasional erroneous ones will not bias the system too much.  9.2.4  Representing Item Profiles  Our ultimate goal for content-based recommendation is
444
 Implementation . . . . . . . . . . . . . . . . . . 8.5.1 Matching Bids and Search Queries . . . . . . . . . 8.5.2 More Complex Matching Problems . . . . . . . . . 8.5.3 A Matching Algorithm for Documents and Bids . . Summary of Chapter 8 . . . .
445
 consolidate the list in a single place. 1. Product Recommendations: Perhaps the most important use of recommendation systems is at on-line retailers. We have noted how Amazon  290  CHAPTER 9. RECOMMENDATION SYSTEMS  The Long Tail  Figure 9.2: The
446
 well. 2 The obvious way to solve the problem is to keep in main memory a list of all the elements seen so far in the stream. Keep them in an efficient search structure such as a hash table or search tree, so one can quickly add new elements and check
447
 advertising. We begin by surveying the types of ads found on the Web.  8.1.1  Advertising Opportunities  The Web offers many ways for an advertiser to show their ads to potential customers. Here are the principal venues. 261  262  CHAPTER 8.
448
 family F for Hamming distance is only d. The first point is of no consequence; it only requires that we divide by d at appropriate times. The second point is more serious. If d is relatively small, then we are limited in the number of functions that
449
 triple, each pair of elements in the set must be a frequent doubleton. For example, {dog, a, and} cannot be a frequent itemset, because if it were, then surely {a, and} would be frequent, but it is not. The triple {dog, cat, and} might be frequent,
450
 c is the decay constant for the decaying window, and the minimum score we wish to accept for a frequent itemset in the decaying window is s. Then the support threshold for the initial run of the frequent-itemset algorithm is bcs. If an itemset I
451
 of dead ends will remove parts of the out-component, tendrils, and tubes, but leave the SCC and the in-component, as well as parts of any small isolated components.4 2. We can modify the process by which random surfers are assumed to move about the
452
 infrequent and ordered lexicographically. Then, the words of any document can be ordered. If a word does not appear on the list of n frequent words, place it at the front of the order, lexicographically. Those  282  CHAPTER 8. ADVERTISING ON THE
453
 . . . . . . . . . . . . 3.4 Locality-Sensitive Hashing for Documents . . . . . . . 3.4.1 LSH for Minhash Signatures . . . . . . . . . . 3.4.2 Analysis of the Banding Technique . . . . . . . 3.4.3 Combining the Techniques . . . . . . . . . . . . 3.4.4
454
 involves dividing by the length of each vector. That is, user vectors will tend to be much shorter than movie vectors, but only the direction of vectors matters.  299  9.2. CONTENT-BASED RECOMMENDATIONS  negative examples in that group.
455
 fact that function a’s output is input to function b. A suggestion of what a workflow might look like is in Fig. 2.6. There, five functions, f through j, pass  39  2.4. EXTENSIONS TO MAP-REDUCE  data from left to right in specific ways, so the flow of
456
 Thus, PCY can handle some data sets without thrashing during the second pass, while A-Priori would run out of main memory and thrash. There is another subtlety regarding the second pass of PCY that affects the amount of space needed. While we
457
 – will be covered in Chapter 7. Here, data is viewed as points in a multidimensional space. Points that are “close” in this space are assigned to the same cluster. The clusters themselves are summarized, perhaps by giving the centroid of the
458
 i and column j of M , U , and V , respectively. Also, let P = U V , and use pij for the element in row i and column j of the product matrix P . Suppose we want to vary urs and find the value of this element that minimizes the RMSE between M and U V .
459
 “Pnuts: Yahoo!’s hosted data serving platform,” PVLDB 1:2, pp. 1277–1288, 2008.  54  CHAPTER 2. LARGE-SCALE FILE SYSTEMS AND MAP-REDUCE 8. J. Dean and S. Ghemawat, “Mapreduce: simplified data processing on large clusters,” Comm. ACM 51:1, pp.
460
 data before our algorithm must make some decisions. Chapter 4 covered stream mining, where we could store only a limited amount of the stream, and had to answer queries about the entire stream when called upon to do so. There is an extreme form of
461
 words not among the n most frequent can be assumed equally infrequent and ordered lexicographically. Then, the words of any document can be ordered. If a word does not appear on the list of n frequent words, place it at the front of the order,
462
 work on a received input element in the time it takes to deliver that element. • Even if a task executes at a compute node that has a copy of the chunk(s) on which the task operates, that chunk normally will be stored on disk, and the time taken to
463
 × 1011 k √ is less than 5.94 × 1012 . That is so, provided 1.8 × 1011 k < 5.58 × 1012 , or √ k < 31. That is, the 3-way join will be preferable provided we use no more than 312 = 961 Reduce tasks. 2  2.5.4  Exercises for Section 2.5  Exercise 2.5.1
464
 child of the root. However, the articles that satisfy the predicate includes a number of articles that user U doesn’t like; these are the articles that mention the Yankees. Thus, at the left child of the root, we build another predicate. We might
465
 Reduce tasks. As an example, we explore the computation of multiway joins as single map-reduce jobs, and we see that in some situations, this approach is more efficient than the straightforward cascade of 2-way joins.  2.5.1  The Communication-Cost
466
 currently consist of the elements a1 , a2 , . . . , at , where a1 is the first element to arrive and at is the current element. Let c be a small constant, such as 10−6 or 10−9 . Define the exponentially decaying window for this stream to be the sum
467
 to buckets of the second hash table. A pair is hashed only if it meets the two criteria for being counted in the second pass of PCY; that is, we hash {i, j} if and only if i and j are both frequent, and the pair hashed to a frequent bucket on the
468
 A.M., 110 Gaber, M.M., 18 Ganti, V., 110, 260 Garcia-Molina, H., 18, 182, 220, 260 Garofalakis, M., 144 Gaussian elimination, 150 Gehrke, J., 144, 260 Genre, 292, 304, 317 GFS, see Google file system Ghemawat, S., 53, 54 Gibbons, P.B., 144 Gionis,
469
 collection that have survived the possibility of having been deleted for becoming infrequent. (b) Add some random itemsets to the current collection, and count their fraction of occurrences for a while, until one has a good idea of whether or
470
 family of hash functions for this distance. We shall start with a 2-dimensional Euclidean space. Each hash function f in our family F will be associated with a randomly chosen line in this space. Pick a constant a and divide the line into segments of
471
 item 2, a third contain item 3, and so on. Assume the number of baskets is sufficiently large that the baskets collectively behave as one would expect statistically. Let the support threshold be 1% of the baskets. Find the frequent itemsets.
472
 A sudden increase in the click rate for a link could  116  CHAPTER 4. MINING DATA STREAMS  indicate some news connected to that page, or it could mean that the link is broken and needs to be repaired.  4.1.3  Stream Queries  There are two ways
473
 the number of points in the merged cluster is surely the sum of the numbers of points in the two clusters. The centroid of the merged cluster is the weighted average of the centroids of the two clusters, where the weighting is by the numbers of points
474
 By hashing the key of any arriving stream element, we can use the hash value to decide consistently whether all or none of the elements with that key will become part of the sample. ✦ Bloom Filters: This technique allows us to filter streams so
475
 an edit distance of 0. To see that edit distance is symmetric, note that a sequence of insertions and deletions can be reversed, with each insertion becoming a deletion, and vice-versa. The triangle inequality is also straightforward. One way to
476
 set of trustworthy pages. Two approaches that have been tried are: 1. Let humans examine a set of pages and decide which of them are trustworthy. For example, we might pick the pages of highest PageRank to examine, on the theory that, while link
477
 the number of Map tasks to k. For instance, in Fig. 5.12, M11 , M12 , M13 , and M14 would be assigned to a single Map task. If we represent the blocks as in Fig. 5.14, we can read the blocks in a row of blocks one-at-a-time, so the matrix does not
478
 of Netflix users. To develop an algorithm, contestants were given a training set of data, also taken from actual Netflix data.  9.1. A MODEL FOR RECOMMENDATION SYSTEMS  291  Into Thin Air and Touching the Void An extreme example of how the long tail,
479
 and x agree, but let them differ on the kth bit from the right end. Example 4.10 : If w = 0101 and x = 1010, then k = 1, since scanning from the right, they first disagree at position 1. If w = 1001 and x = 0101, then k = 3, because they first disagree
480
 each subscriber has, or perhaps just the person with the largest number of friends of friends of friends.8 The cost of the 3-way join√of R √ with itself is 4r + 2r k; 3r represents the cost of the Map tasks, and r + 2 kr2 10 is the cost of the
481
 . . . .  . . . . . . . . . . . . . . . .  . . . . . . . . . . . . . . . .  . . . . . . . . . . . . . . . .  . . . . . . . . . . . . . . . .  261 261 261 262 263 264 264 265 266 266 267 267 268 269 270 270 271  xii  CONTENTS 8.4.2 Definition of the
482
 seen. Another approach to summarizing a stream is to look at only a fixed-length “window” consisting of the last n elements for some (typically large) n. We then query the window as if it were a relation in a database. If there are many streams
483
 = 2 and g(S.C) = 1 3  0 1 h(B) = 2 h(R.B) = 2 3  Figure 2.8: Sixteen Reduce tasks together perform a 3-way join Example 2.9 : Suppose that b = c = 4, so k = 16. The sixteen Reduce tasks  48  CHAPTER 2. LARGE-SCALE FILE SYSTEMS AND MAP-REDUCE 
484
 itemsets completely at random, one might focus on sets with items that appear in many itemsets already known to be frequent. For example, a good choice is to pick new itemsets from the negative border (Section 6.4.5) of the current set of frequent
485
 and ecdab. Their distances are found in the following table: abcd aecdb abecb  ecdab 5 2 4  abecb 3 2  aecdb 3  If we apply the three criteria for being the centroid to each of the four points of the cluster, we find: Point abcd aecdb abecb ecdab  Sum
486
 the entire dataset, then we use ps as the support threshold for the sample. However, we can use something smaller than that as the threshold for the sample, such a 0.9ps. Having a lower threshold means that more itemsets of each size will have to be
487
 of the squares of the distances between the points and the centroid. In some algorithms, we shall find these variant definitions of “radius” referred to as “the radius.” 4. The diameter of a cluster is the maximum distance between any two points of the
488
 for each of the possible average ratings, and doing so would cause us to lose the structure implicit in numbers. That is, two ratings that are close but not identical should be considered more similar than widely differing ratings. Likewise,
489
 gets all or most of the negative examples (the items this user does not like). Once we have selected a predicate for a node N , we divide the items into the two groups: those that satisfy the predicate and those that do not. For each group, we again
490
 − 1)(2j − 1). The overestimate is 2j−1 − 1. Thus, the fractional error is 2j−1 − 1 1 + (r − 1)(2j − 1)  138  CHAPTER 4. MINING DATA STREAMS  Bucket Sizes and Ripple-Carry Adders There is a pattern to the distribution of bucket sizes as we execute
491
 needed in the merging process.  7.6.4  Merging Buckets  Following the strategy from Section 4.6, whenever we create a new bucket, we need to review the sequence of buckets. First, if some bucket has a timestamp that is more than N time units prior to
492
 2, 2, 1. We square and sum these to get 18. In the second row, we do the same to get 1, −1, 0, 2, −1, square and sum to get 7. In the third row, the second column is blank, so that entry is ignored when computing the RMSE. The differences are 0, 1,
493
 the same but the surrounding material is different, then we would expect that a large fraction of the shingles of the two pages would be the same. They might have a Jaccard similarity of 75%. However, if the surrounding material is the same but the
494
 will make the argument easier to follow. Let e(i) be the stream element that appears at position i in the stream, and let c(i) be the number of times element e(i) appears in the stream among positions i, i + 1, . . . , n. Example 4.9 : Consider the
495
 F′ is constructed from b members of F, say f1 , f2 , . . . , fb . We define f (x) = f (y) if and only if fi (x) = fi (y) for one or more values of i. The OR-construction mirrors the effect of combining several bands: x and y become a candidate pair
496
 because there are no sets of items that are correlated. Suppose the items are numbered 1 to 10, and each basket is constructed by including item i with probability 1/i, each decision being made independently of all other decisions. That is, all the
497
 Speed Disk Size Main-Memory Size  A 3.06 500 6  B 2.68 320 4  C 2.92 640 6  We may imagine these values as defining a vector for each computer; for instance, A’s vector is [3.06, 500, 6]. We can compute the cosine distance between any two of the
498
  Suppose stream elements are chosen from some universal set. We would like to know how many different elements have appeared in the stream, counting either from the beginning of the stream or from some known time in the past. Example 4.5 : As a
499
 distance from the clustroid) for the cluster that is the five points in the lower right of Fig. 7.8. Note that (11,4) is the clustroid.  7.6  Clustering for Streams and Parallelism  In this section, we shall consider briefly how one might cluster a
500
 0, we add the user with the value “out.” That method works as long as we can afford to keep the list of all users and their in/out decision in main memory, because there isn’t time to go to disk for every search that arrives. By using a hash
501
 Section 7.6.4 as representative of the various strategies we might use to produce the final clustering, which is the output of the Reduce task.  7.6.7  Exercises for Section 7.6  Exercise 7.6.1 : Execute the BDMO Algorithm with p = 3 on the following
502
 5 3 4 5  Sum-Sq 43 17 29 45  We can see from these measurements that whichever of the three criteria we choose, aecdb will be selected as the clustroid. In general, different criteria could yield different clustroids. 2 The options for measuring the
503
 edge (ℓ, r), where ℓ is in L. At that time, neither end of this edge is matched, because we have supposed that neither ℓ nor r is ever matched by the greedy algorithm. That observation contradicts the definition of how the greedy algorithm works;
504
 they might like.  9.1.3  Applications of Recommendation Systems  We have mentioned several important applications of recommendation systems, but here we shall consolidate the list in a single place. 1. Product Recommendations: Perhaps the most
505
 examine book sales at Amazon.com, and let x represent the rank of books by sales. Then y is the number of sales of the xth best-selling book over some period. The implication of the graph of Fig. 1.3 would be that the best-selling book sold
506
 of the rule to be reasonably high, perhaps 50%, or else the rule has little practical effect. As a result, the set I ∪ {j} will also have fairly high support. Suppose we have found all itemsets that meet a threshold of support, and that we have the
507
 can be based. Features of documents are typically important or unusual words. Products have attributes such as screen size for a television. Media such as movies have a genre and details such as actor or performer. Tags can also be used as
508
 algorithm. ✦ Bipartite Matching: This problem involves two sets of nodes and a set of edges between members of the two sets. The goal is to find a maximal matching – as large a set of edges as possible that includes no node more than once. ✦
509
 both the PageRank and topic-sensitive PageRank that were computed for the graph of Fig. 5.1 in Examples 5.2 and 5.10, respectively. In the latter case, the teleport set was nodes B and D, so let us assume those are the trusted pages. Figure 5.17
510
 pp. 502–511, 1999. 4. H. Garcia-Molina, J.D. Ullman, and J. Widom, Database Systems: The Complete Book Second Edition, Prentice-Hall, Upper Saddle River, NJ, 2009. 5. S. Guha, R. Rastogi, and K. Shim, “CURE: An efficient clustering
511
  8.6. SUMMARY OF CHAPTER 8  (d) Look up bids with hash−key w  Word w  (a) Look up bids with hash−key w  Hash−table index of bids  (e) Copy to output if w is the only word  (f) Copy with status 1 if more than one word Hash on second word Partially
512
 that a is the largest component of h and set a = 1, we get b = 0.3583 and d = 0.7165. Along with c = e = 0, these values give us the limiting value of h. The value of a can be computed from h by multiplying by AT and scaling. 2  5.5.3  Exercises
513
 itself.  5.1.7  Exercises for Section 5.1  Exercise 5.1.1 : Compute the PageRank of each page in Fig. 5.7, assuming no taxation.  158  CHAPTER 5. LINK ANALYSIS  a  b  c  Figure 5.7: An example graph for exercises Exercise 5.1.2 : Compute the
514
 as much PageRank as possible. There are a large number m of supporting pages, that accumulate the portion of the PageRank that is distributed equally to all pages (the fraction 1 − β of the PageRank that represents surfers going to a random page).
515
 the values in certain other attributes. The normally permitted aggregations are SUM, COUNT, AVG, MIN, and MAX, with the obvious meanings. Note that MIN and MAX require that the aggregrated attributes have a type that can be compared, e.g., numbers or
516
  Figure 3.14: Strings s and t begin with i − 1 and j − 1 unique symbols, respectively, and then agree beyond that To compute the upper bound on j, suppose t is a string none of whose first j − 1 symbols matched anything in s, but the ith symbol of s is
517
 we still have to consider the possibility that all hash-keys have B as a factor. Of course there are many other types of hash functions not based on modular arithmetic. We shall not try to summarize the options here, but some sources of information
518
 “tweets” of a given person. However,  8.5. ADWORDS IMPLEMENTATION  281  it is feasible to allow users to specify a set of words, such as ipod free music and see all the tweets where all these words appear, not necessarily in order, and not necessarily
519
 an innovative direction to try, it is questionable whether sufficient public interest can be generated to produce enough free work to satisfy the needs for tagged data.  there are enough tags that occasional erroneous ones will not bias the system
520
 is a (typically small) set of words. A document is a larger set of words, such as an email, tweet, or news article. We assume there may be hundreds of documents per second arriving, although if there are that many, the document stream may be split
521
 of buckets must be sufficiently large that most buckets are not frequent. In addition, on the second pass, there must be enough room to count all the candidate pairs. As a function of S, what is the largest value of P for which we can successfully run
522
 − J) − i + 1 + J /J. Example 3.27 : Consider the string s = acdefghijk with J = 0.9 discussed at the beginning of this section. Suppose s is now a probe string. We already established that we need to consider the first two positions; that is, i can
523
 we shall talk about the Jaccard similarity of strings, when strictly speaking we mean the similarity of the sets that the strings represent. Also, we shall talk of the length of a string, as a surrogate for the number of elements in the set that the
524
 can show a competitive ratio of 1/2 for the greedy matching algorithm of Section 8.3.2. First, the ratio cannot be more than 1/2. We already saw that for the graph of Fig. 8.1, there is a perfect matching of size 4. However, if the edges are
525
  82  CHAPTER 3. FINDING SIMILAR ITEMS  p1 Probabilty of being declared a candidate  p2  d1  d2  Distance  Figure 3.9: Behavior of a (d1 , d2 , p1 , p2 )-sensitive function between the items is strictly between d1 and d2 , but we can make d1 and d2
526
 of a cluster can be, and we consider merging pairs of clusters. It is normally sufficient to consider clusters that are “nearby,” in the sense that their representatives are at the same leaf or at leaves with a common parent. However, in principle, we
527
 USING MAP-REDUCE  37  The Map Function: For each element mij of M , produce a key-value pair (i, k), (M, j, mij ) for k = 1, 2, . . ., up to the number of columns of N . Also, for each element njk of N , produce a key-value pair (i, k), (N, j,
528
 scored a touchdown”. However, if we retain the blanks, then the first has shingles touch dow and ouch down, while the second has touchdown. If we eliminated the blanks, then both would have touchdown. 2  3.2.2  Choosing the Shingle Size  We can
529
 the presence of spider traps cause all the PageRank to be captured within that set of nodes. ✦ Taxation Schemes: To counter the effect of spider traps (and of dead ends, if we do not eliminate them), PageRank is normally computed in a way that
530
 attention on the core article in an on-line newspaper’s Web page, ignoring all the extraneous material such as ads and newspaper-specific material.  3.8.1  Entity Resolution  It is common to have several data sets available, and to know that they refer
531
 resumes.  1.1.3  Computational Approaches to Modeling  More recently, computer scientists have looked at data mining as an algorithmic problem. In this case, the model of the data is simply the answer to a complex query about it. For instance,
532
 methods, and many others like these, raise enormous privacy issues. It is not the purpose of this book to try to resolve those issues, which in practice probably have no solution that will satisfy all concerns. On the one hand, people like the free
533
 * resource=&quot;tasks.properties&quot; /&gt; * <p/> * &lt;execute-fitnesse-tests * suitepage=&quot;FitNesse.SuiteAcceptanceTests&quot; * fitnesseport=&quot;8082&quot; * resultsdir=&quot;${results.dir}&quot; *
534
 you made a mess in a module in the morning, it is easy to clean it up in the afternoon. Better yet, if you made a mess ﬁve minutes ago, it’s very easy to clean it up right now. So the solution is to continuously keep your code as clean and simple as it
535
  No Preemption One thread cannot take resources away from another thread. Once a thread holds a resource, the only way for another thread to get it is for the holding thread to release it.  Circular Wait This is also referred to as the deadly embrace.
536
 } private String unexpectedArgumentMessage() { StringBuffer message = new StringBuffer("Argument(s) -"); for (char c : unexpectedArguments) { message.append(c); } message.append(" unexpected."); return message.toString(); } public boolean
537
 that might have been in the path of that cosmic disruption. Supermassive black holes swallow whole stars for lunch, converting a sizeable fraction of their mass to energy. E = MC2 is leverage enough, but when M is a stellar mass: Look out!
538
 static int[] generatePrimes(int maxValue) { if (maxValue >= 2) // the only valid case { // declarations int s = maxValue + 1; // size of array boolean[] f = new boolean[s]; int i;  72  Chapter 4: Comments  Listing 4-7 (continued)
539
 one thing. After all, the reason we write functions is to decompose a larger concept (in other words, the name of the function) into a set of steps at the next level of abstraction. It should be very clear that Listing 3-1 contains steps at many
540
 "The First " + NUMBER_OF_PRIMES + " Prime Numbers"); tablePrinter.print(primes); } }  Listing 10-7 RowColumnPagePrinter.java package literatePrimes; import java.io.PrintStream; public class RowColumnPagePrinter { private int rowsPerPage;
541
 in these conﬁguration ﬁles is simpler than the complicated proxy and aspect logic that is hidden from view and created automatically. This type of architecture is so compelling that frameworks like Spring led to a complete overhaul of the EJB
542
 that can be turned into enums (lines 162–205). The ﬁrst of the three selects a week within a month. I changed it into an enum named WeekInMonth. public enum WeekInMonth { FIRST(1), SECOND(2), THIRD(3), FOURTH(4), LAST(0); public final int index;
543
 the specified day-of-the-week and is * CLOSEST to the base date. * * @param targetDOW a code for the target day-of-the-week. * @param base the base date. * * @return the date that falls on the specified day-of-the-week and is * CLOSEST to the base
544
 objects hiding, 97 intersection, of domains, 160 intuition, not relying on, 289 inventor of C++, 7 Inversion of Control (IoC), 157 InvocationHandler object, 162 I/O bound, 318 isolating, from change, 149–150 isxxxArg methods, 221–222 iterative process,
545
 { return (this.serial < other.toSerial()); } /** * Returns true if this SerialDate represents the same date as the * specified SerialDate. * * @param other the date being compared to. * * @return <code>true</code> if this SerialDate represents the same
546
 its true purpose. It held the number of extra dashes. public String render() throws Exception { HtmlTag hr = new HtmlTag("hr"); if (extraDashes > 0) hr.addAttribute("size", hrSize(extraDashes)); return hr.html(); } private String hrSize(int height) {
547
 used in Microsoft * Excel for Windows and Lotus 1-2-3). * * @return The serial number of this date. */ public int toSerial() { return this.serial; } /** * Returns a <code>java.util.Date</code> equivalent to this date. * * @return The date. */ public
548
 because this is probably harder than you think.  Testing Threaded Code Proving that code is correct is impractical. Testing does not guarantee correctness. However, good testing can minimize risk. This is all true in a single-threaded solution. As
549
 { totalPay += e.getPay(); } }  Right now, getEmployees can return null, but does it have to? If we change getEmployee so that it returns an empty list, we can clean up the code: List<Employee> employees = getEmployees(); for(Employee e : employees)
550
 return false; } } /** * Converts the supplied string to a day of the week. * * @param s a string representing the day of the week. * * @return <code>-1</code> if the string is not convertable, the day of * the week otherwise. */ public static int
551
 logger.log("Device response exception", e); } catch (ATM1212UnlockedException e) { reportPortError(e); logger.log("Unlock exception", e); } catch (GMXError e) { reportPortError(e); logger.log("Device response exception"); } finally { … }  That
552
 differences in style. Figure 5-1 shows some of those differences. Seven different projects are depicted. Junit, FitNesse, testNG, Time and Money, JDepend, Ant, and Tomcat. The lines through the boxes show the minimum and maximum ﬁle lengths in each
553
 on the language, not all necessary information can be expressed clearly in code alone.  Big Dave shares Grady’s desire for readability, but with an important twist. Dave asserts that clean code makes it easy for other people to enhance it. This may
554
 is meant to support many users on the public net? If too many users connect at the same time, the system might grind to a halt. But set the behavioral problem aside for the moment. The solution shown has problems of cleanliness and structure. How
555
 Dependency Magnet Returning error codes usually implies that there is some class or enum in which all the error codes are deﬁned. public enum Error { OK, INVALID, NO_SUCH, LOCKED, OUT_OF_RESOURCES, WAITING_FOR_EVENT; }  Classes like this are a
556
 = e.getTenthsWorked() % 10; page.add(item); } public class LineItem { public String name; public int hours; public int tenths; } }  This code has a logical dependency that has not been physicalized. Can you spot it? It is the constant PAGE_SIZE.
557
 the implementation. Calling it ShapeFactoryImp, or even the hideous CShapeFactory, is preferable to encoding the interface.  Method Names  25  Avoid Mental Mapping Readers shouldn’t have to mentally translate your names into other names they already
558
 br = new BufferedReader(new FileReader(javaFile)); String line; while ((line = br.readLine()) != null) measureLine(line); } private void measureLine(String line) { lineCount++; int lineSize = line.length(); totalChars += lineSize;
559
 you want to extract one small part of that function into a separate function. However, the code you want to extract uses four of the variables declared in the function. Must you pass all four of those variables into the new function as arguments? Not
560
 an indentation style. To quote my own book of 17 years ago, such style distinguishes excellence from mere competence. The Japanese worldview understands the crucial value of the everyday worker and, more so, of the systems of development that owe to
561
 static void crossOutMultiplesOf(int i) { for (int multiple = 2*i; multiple < crossedOut.length; multiple += i) crossedOut[multiple] = true; }  73  74  Chapter 4: Comments  Listing 4-8 (continued) PrimeGenerator.java (refactored) private static
562
 MISSING_INTEGER, INVALID_INTEGER, MISSING_DOUBLE, INVALID_DOUBLE} }  Listing 14-16 Args.java public class Args { private String schema; private Map<Character, ArgumentMarshaler> marshalers = new HashMap<Character, ArgumentMarshaler>(); private
563
 skills and a shared cultural background. This is a teaching issue rather than a technical, business, or management issue. As a result many people in this ﬁeld don’t learn to do it very well. People are also afraid of renaming things for fear that some
564
 vanishingly small. From a test standpoint, it becomes an easier task to prove all bits of logic in this solution, as the classes are all isolated from one another. Equally important, when it’s time to add the update statements, none of the existing
565
 that process other kinds of requests. Simple consistency like this, when reliably applied, can make code much easier to read and modify.  General  293  G12: Clutter Of what use is a default constructor with no implementation? All it serves to do
566
 page 35.)  G31: Hidden Temporal Couplings Temporal couplings are often necessary, but you should not hide the coupling. Structure the arguments of your functions such that the order in which they should be called is obvious. Consider the following: 
567
 16-290, 17-309 G21 .................................................................................. 16-291, 17-310 G22 .................................................................................. 16-294,
568
 == leastRelevantMultiple; } private static boolean isNotMultipleOfAnyPreviousPrimeFactor(int candidate) { for (int n = 1; n < multiplesOfPrimeFactors.size(); n++) { if (isMultipleOfNthPrimeFactor(candidate, n)) return false; }  146  Chapter
569
 the festering pile. The unit tests were written in Java and administered by JUnit. The acceptance tests were written as wiki pages in FitNesse. I could run these tests any time I wanted, and if they passed, I was conﬁdent that the system was
570
 read. Unfortunately, splitting the tests as shown results in a lot of duplicate code. We can eliminate the duplication by using the TEMPLATE METHOD6 pattern and putting the given/when parts in the base class, and the then parts in different
571
 mental reﬂection on the project, and experience with our implementation choices if we decide too soon. The agility provided by a POJO system with modularized concerns allows us to make optimal, just-in-time decisions, based on the most recent
572
 is. Let’s clean it up now. private void findCommonPrefixAndSuffix() { findCommonPrefix(); int suffixLength = 1;  The JUnit Framework  261  for (; !suffixOverlapsPrefix(suffixLength); suffixLength++) { if (charFromEnd(expected,
573
 != actual.charAt(actualSuffix)) break; } return expected.length() - expectedSuffix; }  We should also change the names of the member variables to be a little more accurate [N1]; after all, they are both indices. Careful inspection
574
 with something annoying like rollCount. On the other hand, variables and functions with short names lose their meaning over long distances. So the longer the scope of the name, the longer and more precise the name should be.  N6: Avoid
575
 easily grep for MAX_CLASSES_PER_STUDENT, but the number 7 could be more troublesome. Searches may turn up the digit as part of ﬁle names, other constant deﬁnitions, and in various expressions where the value is used with different intent. It is
576
 When you ﬁnd dead code, do the right thing. Give it a decent burial. Delete it from the system.  G10: Vertical Separation Variables and function should be deﬁned close to where they are used. Local variables should be declared just above their
577
 functions in the 100 to 300 line range. And I’ve written functions that were 20 to 30 lines long. What this experience has taught me, through long trial and error, is that functions should be very small. In the eighties we used to say that a function
578
 Conclusion..........................................................................................133 Bibliography.......................................................................................133 
579
 code began to rot. In the end they were left with no tests, tangled and bug-riddled production code, frustrated customers, and the feeling that their testing effort had failed them.  124  Chapter 9: Unit Tests  In a way they were right. Their
580
  Listing B-2 (continued) SerialDateTest.java 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298
581
 Proxies are used internally in several Java frameworks, for example, Spring AOP and JBoss AOP, to implement aspects in pure Java.12 In Spring, you write your business logic as Plain-Old Java Objects. POJOs are purely focused on their domain. They
582
 owning, 4–12 method invocations, 324 method names, 25 methods affecting the order of execution, 188 calling a twin with a flag, 278 changing from static to instance, 280 of classes, 140 dependencies between, 329–333 eliminating duplication between,
583
 odor becomes. This is because dead code is not completely updated when designs change. It still compiles, but it does not follow newer conventions or rules. It was written at a time when the system was different. When you ﬁnd dead code, do the right
584
 is easy to read and code that is easy to change. Dave ties cleanliness to tests! Ten years ago this would have raised a lot of eyebrows. But the discipline of Test Driven Development has made a profound impact upon our industry and has become one of
585
 194 integrating, 224–225 integer argument functionality, moving into ArgumentMarshaler, 215–216  422  Index  integer argument type, adding to Args, 212 integers, pattern of changes for, 220 IntelliJ, 26 intent explaining in code, 55 explanation of,
586
 going to get rid of it and its ilk. The comments at line 97 and line 100 talk about serial numbers, which I discussed earlier [C1]. The variables they describe are the earliest and latest possible dates that DayDate can describe. This can be made a
587
 they aren’t really needed. A good API should largely disappear from view most of the time, so the team expends the majority of its creative efforts focused on the user stories being implemented. If not, then the architectural constraints will inhibit
588
 And we programmers need to learn how to do it too. One more thing about David Gilbert: David is more than just a good programmer. David had the courage and good will to offer his code to the community at large for free. He placed it out in the open for
589
 we need to understand some basic deﬁnitions. Bound Resources  Resources of a ﬁxed size or number used in a concurrent environment. Examples include database connections and ﬁxed-size read/ write buffers.  Mutual Exclusion  Only one thread can
590
  Chapter 14: Successive Reﬁnement  I hope your initial reaction to this mass of code is “I’m certainly glad he didn’t leave it like that!” If you feel like this, then remember that’s how other people are going to feel about code that you leave in
591
 can call on a given object. But note that the list doesn’t usually give you the comments you wrote around your function names and parameter lists. You are lucky if it gives the parameter names from function declarations. The function names have to
592
 Month(int index) { this.index = index; }  272  Chapter 16: Refactoring SerialDate  public static Month make(int monthIndex) { for (Month m : Month.values()) { if (m.index == monthIndex) return m; } throw new
593
 errorArgumentId); } return ""; } private String unexpectedArgumentMessage() { StringBuffer message = new StringBuffer("Argument(s) -"); for (char c : unexpectedArguments) { message.append(c); } message.append(" unexpected."); return
594
 to make the point. If you look about halfway down the listing, you will see two instance variables declared there. It would be hard to hide them in a better place. Someone reading this code would have to stumble across the declarations by accident
595
 INVALID_INTEGER, UNEXPECTED_ARGUMENT, MISSING_DOUBLE, INVALID_DOUBLE}  And we need a getDouble function. public double getDouble(char arg) { Args.ArgumentMarshaler am = marshalers.get(arg); try { return am == null ? 0 : (Double) am.get(); } catch
596
 d1, DayDate d2) { return isInRange(d1, d2, DateInterval.CLOSED); } public boolean isInRange(DayDate d1, DayDate d2, DateInterval interval) { int left = Math.min(d1.getOrdinalDay(), d2.getOrdinalDay()); int right = Math.max(d1.getOrdinalDay(),
597
 its responsibilities. You can also express yourself by keeping your functions and classes small. Small classes and functions are usually easy to name, easy to write, and easy to understand. You can also express yourself by using standard
598
 151 152 153 154 155 156 157 158 159 160 161 162 163 164  /** The lowest year value supported by this date format. */ public static final int MINIMUM_YEAR_SUPPORTED = 1900; /** The highest year value supported by this date format. */ public static
599
 an unparseable string is fed to a ## argument. public void testInvalidDouble() throws Exception { Args args = new Args("x##", new String[] {"-x","Forty two"}); assertFalse(args.isValid()); assertEquals(0, args.cardinality());
600
 a whole new level. HN was considered to be pretty important back in the Windows C API, when everything was an integer handle or a long pointer or a void pointer, or one of several implementations of “string” (with different uses and attributes). The
601
 behavior is not implemented, readers and users of the code can no longer depend on their intuition about function names. They lose their trust in the original author and must fall back on reading the details of the code.  G3: Incorrect Behavior at
602
 e); } catch (ATM1212UnlockedException e) { reportPortError(e); logger.log("Unlock exception", e); } catch (GMXError e) { reportPortError(e); logger.log("Device response exception"); } finally { … }  That statement contains a lot of duplication,
603
 Month.DECEMBER, 1952); date.addDays(7); // bump date by one week.  Someone reading this code would very likely just accept that addDays is changing the date object. So we need a name that breaks this ambiguity [N4]. So I changed the names to
604
  String Arguments  Listing 14-15 (continued) ArgsException.java case MISSING_DOUBLE: return String.format("Could not find double parameter for -%c.", errorArgumentId); } return ""; } public enum ErrorCode { OK, INVALID_FORMAT,
605
 to changes in that format.  G15: Selector Arguments There is hardly anything more abominable than a dangling false argument at the end of a function call. What does it mean? What would it change if it were true? Not only is the purpose of a selector
606
 this solution, as the classes are all isolated from one another. Equally important, when it’s time to add the update statements, none of the existing classes need change! We code the logic to build update statements in a new subclass of Sql named
607
 to continue that never comes. For example, imagine a system with a parent thread that spawns several child threads and then waits for them all to ﬁnish before it releases its resources and shuts down. What if one of the spawned threads is
608
 Notice how the program has been split into three main responsibilities. The main program is contained in the PrimePrinter class all by itself. Its responsibility is to handle the execution environment. It will change if the method of invocation
609
 Street, Fifth Floor, Boston, MA 02110-1301, * USA. * * [Java is a trademark or registered trademark of Sun Microsystems, Inc. * in the United States and other countries.] * * -------------------* SerialDateTests.java * -------------------* (C)
610
 { marshalers.put(elementId, new IntegerArgumentMarshaler()); } else { throw new ParseException(String.format( "Argument: %c has invalid format: %s.", elementId, elementTail), 0); } } private void
611
 day-of-the-week (preceding, nearest * or following). */ public RelativeDayOfWeekRule(final AnnualDateRule subrule, final int dayOfWeek, final int relative) { this.subrule = subrule; this.dayOfWeek = dayOfWeek; this.relative = relative; } /** *
612
 15-263, 17-333 T1 .......................................................................16-273, 16-274, 17-334 T2 .................................................................................... 16-273, 17-334
613
 Listing 14-10 Args.java (Boolean and String) package com.objectmentor.utilities.getopts; import java.text.ParseException; import java.util.*; public class Args { private String schema; private String[] args; private boolean valid = true; private
614
 of details into your comments. The comment below was extracted from a module designed to test that a function could encode and decode base64. Other than the RFC number, someone reading this code has no need for the arcane information contained in
615
 it is likely that some of those arguments ought to be wrapped into a class of their own. Consider, for example, the difference between the two following declarations: Circle makeCircle(double x, double y, double radius); Circle makeCircle(Point
616
 Legal Comments...............................................................................55 Informative Comments.....................................................................56 Explanation of
617
 the derivatives. So let’s implement the new method in each. private class BooleanArgumentMarshaler extends ArgumentMarshaler { private boolean booleanValue = false; public void set(Iterator<String> currentArgument) throws ArgsException { booleanValue
618
 defaults to a SpreadsheetDateFactory but can be changed at any time to use a different factory. The static methods that delegate to abstract methods use a combination of the SINGLETON,4 DECORATOR,5 and ABSTRACT FACTORY patterns that I have found to
619
 BooleanArgumentMarshaler()); else if (elementTail.equals("*")) marshalers.put(elementId, new StringArgumentMarshaler()); else if (elementTail.equals("#")) marshalers.put(elementId, new IntegerArgumentMarshaler()); else if (elementTail.equals("##"))
620
 delete. So commented-out code gathers like dregs at the bottom of a bad bottle of wine. Consider this from apache commons: this.bytePos = writeBytes(pngIdBytes, 0); //hdrPos = bytePos; writeHeader(); writeResolution(); //dataPos = bytePos; if
621
 There Will Be Code ...............................................................................2 Bad
622
 parameters. The operand stack is where those parameters are put. The stack is a standard last-in, ﬁrst-out (LIFO) data structure. Here is the byte-code generated for resetId(): Mnemonic  Description  Operand Stack After  ALOAD 0  Load the 0th variable
623
 and Micah Martin Agile Software Development: Principles, Patterns, and Practices Robert C. Martin Clean Code: A Handbook of Agile Software Craftsmanship Robert C. Martin UML For Java™ Programmers Robert C. Martin Fit for Developing Software:
624
 run needs to execute in less than 24 hours. However, as more and more Web sites are added, the time grows until it takes more than 24 hours to gather all the data. The single-thread involves a lot of waiting at Web sockets for I/O to complete. We could
625
 case MISSING_DOUBLE: return String.format("Could not find double parameter for -%c.", errorArgumentId); case INVALID_ARGUMENT_NAME: return String.format("'%c' is not a valid argument name.", errorArgumentId);  200  Chapter 14: Successive
626
 functions that they truly need. Anyone who reads these tests should be able to work out what they do very quickly, without being misled or overwhelmed by details.  Domain-Speciﬁc Testing Language The tests in Listing 9-2 demonstrate the technique of
627
 design mentions this rule. Dave Thomas and Andy Hunt called it the DRY3 principle (Don’t Repeat Yourself). Kent Beck made it one of the core principles of Extreme Programming and called it: “Once, and only once.” Ron Jeffries ranks this rule
628
 can be quite so damaging as an old crufty comment that propagates lies and misinformation. Comments are not like Schindler’s List. They are not “pure good.” Indeed, comments are, at best, a necessary evil. If our programming languages were
629
 }  I’m not really happy with this. The passing of the prefixIndex argument is a bit arbitrary [G32]. It works to establish the ordering but does nothing to explain the need for that ordering. Another programmer might undo what we have
630
 { List<int[]> list1 = new ArrayList<int[]>(); for (int[] x : theList) if (x[0] == 4) list1.add(x); return list1; }  Why is it hard to tell what this code is doing? There are no complex expressions. Spacing and indentation are reasonable. There are
631
 ArgsException { ArgumentMarshaler m = marshalers.get(argChar); if (m == null) return false; try { m.set(currentArgument); return true; } catch (ArgsException e) { e.setErrorArgumentId(argChar); throw e; } }  String Arguments  Listing 14-16
632
 We strongly recommend you carry comprehensive travel insurance throughout your travels Guests who miss their connecting flights on Scoot or any other carrier due to incoming flight delay or late arrival are responsible to book a new onward flight at
633
 the wrong bag from the baggage carousel, it is your responsibility to immediately return the bag at your own cost to our staff or our Authorised Agent at the airport where you claimed the bag. You will be responsible for any costs associated with
634
 the Baggage Identification Tag without complaint at the time of delivery is prima facie evidence that the baggage has been delivered in good condition and in accordance with the contract of carriage between us.  Last Updated: 9th Jan2014  We shall
635
 suffer as a consequence of the item being damaged, delayed or lost if you have ignored our requirements and included the items as Checked Baggage, with or without our knowledge. Such items should be carried as Cabin Baggage, but you must still
636
 US$20 (about SGD$25) per kilo. b) General • Scoot will be liable only for major Damage occurring during carriage booked on our Airline Designator Code. If we check Baggage on the flight of another carrier, we only do so as agent for that
637
 cancelled flight, at no additional cost. If we are unable to provide you with a flight within 48 hours of the cancellation of your flight, or if you postpone your travel, we will offer you a travel voucher equivalent to your itinerary value, excluding
638
 obeyed the instructions of our ground staff or a member of the crew of the aircraft relating to safety or security; • Because you have not complied with our medical requirements (see 3.4); • Because you require special assistance and you have not
639
 Component Object Model [COM], a technology for building applications from binary software components. convenience A convenience method is an operation on an object that could be accomplished by a program consisting of more basic operations on
640
 String. The Node object has the following methods: insertBefore(newChild, refChild) This method returns a Node object. The newChild parameter is a Node object. The refChild parameter is a Node object. This method can raise a DOMException object.
641
 Nodes [p.34] , such as the children of a Node [p.34] , or the elements [p.98] returned by the getElementsByTagName method of the Element [p.52] interface, and also a NamedNodeMap [p.44] interface to handle unordered sets of nodes referenced by their
642
 Copyright Notice and License [p.5] . The bindings within this document are published under the W3C Software Copyright Notice and License [p.6] . The software license requires "Notice of any changes or modifications to the W3C files, including
643
 If none exist, then a notice of the following form: "Copyright © [$date-of-software] World Wide Web Consortium, (Massachusetts Institute of Technology, Institut National de Recherche en Informatique et en Automatique, Keio University). All Rights
644
 This constant is of type Number and its value is 7. DOMException.NOT_FOUND_ERR This constant is of type Number and its value is 8. DOMException.NOT_SUPPORTED_ERR This constant is of type Number and its value is 9.
645
 OR THE PERFORMANCE OR IMPLEMENTATION OF THE CONTENTS THEREOF. The name and trademarks of copyright holders may NOT be used in advertising or publicity pertaining to this document or its contents without specific, written prior permission. Title
646
 among these interfaces and objects The structure of SGML documents has traditionally been represented by an abstract data model [p.97] , not by an object model. In an abstract data model [p.97] , the model is centered around the data. In
647
 such node, this returns null. localName of type DOMString [p.17] , readonly, introduced in DOM Level 2 Returns the local part of the qualified name [p.99] of this node. For nodes of any type other than ELEMENT_NODE and ATTRIBUTE_NODE and nodes
648
 the UTF-16 offset is into the middle of a surrogate pair, then the UTF-32 offset of the end of the pair is returned; that is, the index of the char after the end of the pair. You can always round-trip from a UTF-32 offset to a UTF-16 offset and back.
649
 through data and the substringData method below. This may have the value zero, i.e., CharacterData nodes may be empty. Methods appendData Append the string to the end of the character data of the node. Upon success, data provides access to the
650
 within an HTML or XML document. COM COM is Microsoft’s Component Object Model [COM], a technology for building applications from binary software components. convenience A convenience method is an operation on an object that could be accomplished by
651
 particular internal data structures. The Document Object Model does not define what information in a document is relevant or how information in a document is structured. For XML, this is specified by the W3C XML Information Set [Infoset]. The DOM is
652
 of the following form: "Copyright © [$date-of-software] World Wide Web Consortium, (Massachusetts Institute of Technology, Institut National de Recherche en Informatique et en Automatique, Keio University). All Rights Reserved.
653
 structure of the document. DocumentFragment nodes do not need to be well-formed XML documents [p.99] (although they do need to follow the rules imposed upon  24  1.2. Fundamental Interfaces  well-formed XML parsed entities, which can have multiple
654
 Reserved. http://www.w3.org/Consortium/Legal/" (Hypertext is preferred, but a textual representation is permitted.) 3. If it exists, the STATUS of the W3C document. When space permits, inclusion of the full text of this NOTICE should be provided.
655
 that the implementation is in charge of this attribute, not the user. If the user changes the value of the attribute (even if it ends up having the same value as the default value) then the specified flag is automatically flipped to true. To
656
 with this document. For HTML documents as well as XML documents without a document type declaration this returns null. The DOM Level 2 does not support editing the Document Type Declaration. docType cannot be altered in any way, including through
657
 Element object. Object Element Element has the all the properties and methods of the Node object as well as the properties and methods defined below. The Element object has the following properties: tagName This read-only property is of type String. 
658
 not are expected to return null. Parameters elementId of type DOMString [p.17] The unique id value for an element. Return Value Element [p.52]  The matching element.  No Exceptions getElementsByTagName Returns a NodeList [p.43] of all the Elements
659
 Reserved. http://www.w3.org/Consortium/Legal/ This W3C work (including software, documents, or other related items) is being provided by the copyright holders under the following license. By obtaining, using and/or copying this work, you (the licensee)
660
 , Shaohuan Li #2 Qi Liu #2 , Weiran Liu #2 , Zijian Tang #2 ∗  #  SeSaMe Centre, National University of Singapore, Singapore School of Computing, National University of Singapore, Singapore  {xiaoli, atung}@comp.nus.edu.sg {zhi.huang.0718, shaohuan.li,
661
 They attempt to provide a better search feature for users to easily ﬁnd related contents. Although such systems have certain successful features, they still made limited progress for reading data management and retrieval. Firstly, reading objects
662
 or document discovery by analyzing reading data from users; 3) powerful information retrieval anywhere by highlighting a text or selecting an image across various platforms such as web site, phone application, and web browser plugin. 
663
 reading data from users; 3) powerful information retrieval anywhere by highlighting a text or selecting an image across various platforms such as web site, phone application, and web browser plugin.  Personal data  Social data  Highlighting texts
664
 id  D4  F id  D5  F id  11  1  12  1  13  1  14  1  15  1  21  2  22  2  23  2  24  2  25  2  41  4  42  4  43  4  44  4  45  4  51  5  52  5  53  5  54  5  55  5  71  7  72  7  73  7  74  7  75  7  91  9  92  9  93  9  94  9  95  9  131  3  132  3 
665
  SF10  106  SF9  162  SF3  141  SF7  0  0  SF1  112  SF13  108  SF7  165  SF2  160  SF8  0  0  SF5  113  SF2  165  SF6  167  SF7  175  SF9  0  0  SF8  118  SF11  165  SF4  182  SF8  185  SF10  0  0  SF13  125  SF3  173  SF10  190  SF5  207  SF11  0  0 
666
 Account billed: socialatwork (akhtung@gmail.com) Transaction ID: kg6jy5  Date  Plan  Amount  11/24/13 09:46PM -0800  Bronze (upgraded from Free)  USD $25.00*  GitHub, Inc. 88 Colin P. Kelly Jr. Street San Francisco, CA 94107 Web:
667
 socialatwork (akhtung@gmail.com) Transaction ID: kg6jy5  Date  Plan  Amount  11/24/13 09:46PM -0800  Bronze (upgraded from Free)  USD $25.00*  GitHub, Inc. 88 Colin P. Kelly Jr. Street San Francisco, CA 94107 Web: https://github.com/contact Email:
668
 no payment is due. If you have any questions, please contact us any time at support@github.com. Thank you for your business! Account billed: socialatwork (akhtung@gmail.com) Transaction ID: kg6jy5  Date  Plan  Amount  11/24/13 09:46PM -0800 
669
 This is only a receipt, no payment is due. If you have any questions, please contact us any time at support@github.com. Thank you for your business! Account billed: socialatwork (akhtung@gmail.com) Transaction ID: kg6jy5  Date  Plan  Amount 
670
 billed: socialatwork (akhtung@gmail.com) Transaction ID: kg6jy5  Date  Plan  Amount  11/24/13 09:46PM -0800  Bronze (upgraded from Free)  USD $25.00*  GitHub, Inc. 88 Colin P. Kelly Jr. Street San Francisco, CA 94107 Web:
671
 is due. If you have any questions, please contact us any time at support@github.com. Thank you for your business! Account billed: socialatwork (akhtung@gmail.com) Transaction ID: kg6jy5  Date  Plan  Amount  11/24/13 09:46PM -0800  Bronze (upgraded
672
 Transaction ID: kg6jy5  Date  Plan  Amount  11/24/13 09:46PM -0800  Bronze (upgraded from Free)  USD $25.00*  GitHub, Inc. 88 Colin P. Kelly Jr. Street San Francisco, CA 94107 Web: https://github.com/contact Email: support@github.com  * EU
673
 This is a receipt for your GitHub subscription. This is only a receipt, no payment is due. If you have any questions, please contact us any time at support@github.com. Thank you for your business! Account billed: socialatwork (akhtung@gmail.com)
674
 96960906  HELP  BILL TO: Zhao Pengjie Umeng PTE.LTD. Taixing Building #407,11 Huayuan Road East, Haidian District, Beijing,10083 Phone:(+86)18610345157 DESCRIPTION  AMOUNT  [ReadPeer Website Design First Iteration] [Labor: 40 hours at $12.5/hr] 
675
 Please include the invoice number on your check  SUBTOTAL  $1,500.00  TAX RATE TAX OTHER TOTAL  0.000% $0.00 $0.00 $1,500.00  Make all checks payable to Zhao Pengjie  If you have any questions about this invoice, please contact [Shaohuan Li,
676
  HELP  BILL TO: Zhao Pengjie Umeng PTE.LTD. Taixing Building #407,11 Huayuan Road East, Haidian District, Beijing,10083 Phone:(+86)18610345157 DESCRIPTION  AMOUNT  [ReadPeer Website Design First Iteration] [Labor: 40 hours at $12.5/hr]  1,000.00
677
  AMOUNT  [ReadPeer Website Design First Iteration] [Labor: 40 hours at $12.5/hr]  1,000.00 500.00  [42] OTHER COMMENTS 1. Total payment due in 30 days 2. Please include the invoice number on your check  SUBTOTAL  $1,500.00  TAX RATE TAX OTHER TOTAL 
678
 96960906  HELP  BILL TO: Zhao Pengjie Umeng PTE.LTD. Taixing Building #407,11 Huayuan Road East, Haidian District, Beijing,10083 Phone:(+86)18610345157 DESCRIPTION  AMOUNT  [ReadPeer Website Design First Iteration] [Labor: 40 hours at $12.5/hr] 
679
 Beijing,10083 Phone:(+86)18610345157 DESCRIPTION  AMOUNT  [ReadPeer Website Design First Iteration] [Labor: 40 hours at $12.5/hr]  1,000.00 500.00  [42] OTHER COMMENTS 1. Total payment due in 30 days 2. Please include the invoice number on your
680
 Taixing Building #407,11 Huayuan Road East, Haidian District, Beijing,10083 Phone:(+86)18610345157 DESCRIPTION  AMOUNT  [ReadPeer Website Design First Iteration] [Labor: 40 hours at $12.5/hr]  1,000.00 500.00  [42] OTHER COMMENTS 1. Total payment
681
 due in 30 days 2. Please include the invoice number on your check  SUBTOTAL  $1,500.00  TAX RATE TAX OTHER TOTAL  0.000% $0.00 $0.00 $1,500.00  Make all checks payable to Zhao Pengjie  If you have any questions about this invoice, please contact
682
 Phone: (+65) 96960906  HELP  BILL TO: Zhao Pengjie Umeng PTE.LTD. Taixing Building #407,11 Huayuan Road East, Haidian District, Beijing,10083 Phone:(+86)18610345157 DESCRIPTION  AMOUNT  [ReadPeer Website Design First Iteration] [Labor: 40
683
 Road East, Haidian District, Beijing,10083 Phone:(+86)18610345157 DESCRIPTION  AMOUNT  [ReadPeer Website Design First Iteration] [Labor: 40 hours at $12.5/hr]  1,000.00 500.00  [42] OTHER COMMENTS 1. Total payment due in 30 days 2. Please include
684
 [123]  Singapore,129193 Phone: (+65) 96960906  HELP  BILL TO: Zhao Pengjie Umeng PTE.LTD. Taixing Building #407,11 Huayuan Road East, Haidian District, Beijing,10083 Phone:(+86)18610345157 DESCRIPTION  AMOUNT  [ReadPeer Website Design First
685
 Phone: (+65) 96960906  HELP  BILL TO: Zhao Pengjie Umeng PTE.LTD. Taixing Building #407,11 Huayuan Road East, Haidian District, Beijing,10083 Phone:(+86)18610345157 DESCRIPTION  AMOUNT  [ReadPeer Website Design First Iteration] [Labor: 40
686
 is common at the entry to the service, but there should also be admission control at all major components boundaries. Work load characteristic changes will eventually lead to sub-component overload even though the overall service is operating within
687
 their components, but should also be testing the full service with their component changes. Achieving this goal efficiently requires single-server deployment (section 2.4), and the preceding best practice, a quick service health check. • Zero
688
 are generally achieved only with a constrained service model. This is a repeating theme throughout: simplicity is the key to efficient operations. Rational constraints on hardware selection, service design, and deployment models are a big
689
 team should conduct a ‘‘fire drill’’ using these tools. If the service-availability risk of a drill is excessively high, then insufficient investment has been made in the design, development, and testing of the tools. Keep things simple and robust.
690
 Research), and David Treadwell (Windows Live Platform Services) for background information, points from their experience, and comments on early drafts of this paper. We particularly appreciated the input from Bill Hoffman of the Windows  244  21st
691
 it’s clear what was changed, when and by whom, and which servers were effected (see section 2.7). Frequently scan all servers to ensure their current state matches the intended state. This helps catch install and configuration failures, detects server
692
 poor service to all users. Partition the service. Partitions should be infinitely-adjustable and fine-grained, and not be bounded by any real world entity (person, collection ...). If the partition is by company, then a big company will exceed the
693
 vs. Error, 244 See also inheritance subtype relation, 128, 135 subtyping rules, for generics, 112 summary description, 205 super type tokens, 145  supertype relation, 136 SuppressWarnings annotation, 116–118 example, 117, 126–127 switch
694
 objects referred to by fields and modifying these objects directly. While it is technically permissible for immutable classes to have public final fields containing primitive values or references to immutable objects, it is not recommended because it
695
 method and then restores transient fields to acceptable values (Item 76). Alternatively, these fields can be lazily initialized the first time they are used (Item 71). Whether or not you use the default serialized form, you must impose any
696
 159–160 BitSet, 77 blocking operation, 274 BlockingQueue, 274 bogus byte stream attack, 303, 313 Boolean, 5–6, 20 boolean, 5 vs. enum types, 190 Boolean.valueOf, 6 bounded type parameter, 115, 128, 145 bounded type token, 145, 162, 167, 172 bounded
697
 by convention, static factory methods for an interface named Type are put in a noninstantiable class (Item 4) named Types. For example, the Java Collections Framework has thirty-two convenience implementations of its collection interfaces, providing
698
 resource. If many files are left open because the JVM is tardy in executing finalizers, a program may fail because it can no longer open files. The promptness with which finalizers are executed is primarily a function of the garbage collection
699
 signum function, which is defined to return -1, 0, or 1, according to whether the value of expression is negative, zero, or positive. • The implementor must ensure sgn(x.compareTo(y)) == -sgn(y.compareTo(x)) for all x and y. (This implies that
700
 the last worker thread is ready to run the action, the timer thread “fires the starting gun,” allowing the worker threads to perform the action. As soon as the last worker thread finishes performing the action, the timer thread stops the clock.
701
 the following readResolve method suffices to guarantee the singleton property: // readResolve for instance control - you can do better! private Object readResolve() { // Return the one true Elvis and let the garbage collector // take care of
702
 affecting the correctness of other modules. Information hiding increases software reuse because modules that aren’t tightly coupled often prove useful in other contexts besides the ones for which they were developed. 67  68  CHAPTER 4  CLASSES AND
703
 0x00, 0x78, 0x73, 0x71, 0x00, 0x7e, 0x00, 0x03, 0x77, 0x08, 0x00, 0x00, 0x00, (byte)0xd5, 0x17, 0x69, 0x22, 0x00, 0x78 }; public static void main(String[] args) { Period p = (Period) deserialize(serializedForm); System.out.println(p); } // Returns the
704
 the elements array are equally valid. Only the programmer knows that the inactive portion of the array is unimportant. The programmer effectively communicates this fact to the garbage collector by manually nulling out array elements as soon as they
705
 . . . . . . . . . . . . . . . . . . 124 Item 27: Favor generic methods . . . . . . . . . . . . . . . . . . . . . . . . . . . 129 Item 28: Use bounded wildcards to increase API flexibility . . . . . 134 Item 29: Consider typesafe heterogeneous
706
 to Arrays.asList. Exercise care when using the varargs facility in performance-critical situations. Every invocation of a varargs method causes an array allocation and initialization. If you have determined empirically that you can’t afford
707
 that switches on its own value - questionable public enum Operation { PLUS, MINUS, TIMES, DIVIDE; // Do the arithmetic op represented by this constant double apply(double x, double y) { switch(this) { case PLUS: return x + y; case MINUS: return x - y;
708
 5–10 for serialization proxies, 312 signature of, 6 example in singletons, 17 SuppressWarnings annotation and, 117 consumer threads, 274 convenience methods, 189 conversion constructors and factories, 61 cooperative thread termination, 261 copy
709
 consisting of primitives, such as int, double, and boolean, and reference types, such as String and List. Every primitive type has a corresponding reference type, called a boxed primitive. The boxed primitives corresponding to int, double, and
710
 default serialized form defaultWriteObject and, 299 documenting, 296 of inner classes, 294 of singletons, 308 serialver utility, 301 service access API, 8 service provider frameworks, 7–9 reflection and, 232 Set, 85 compareTo and, 64 defensive
711
 69: PREFER CONCURRENCY UTILITIES TO WAIT AND NOTIFY  Item 69: Prefer concurrency utilities to wait and notify The first edition of this book devoted an item to the correct use of wait and notify (Bloch01, Item 50). Its advice is still valid and is
712
 It is a form of the Builder pattern [Gamma95, p. 97]. Instead of making the desired object directly, the client calls a constructor (or static factory) with all of the required parameters and gets a builder object. Then the client calls setter-like
713
  Item 2:  Consider a builder when faced with many constructor parameters  Static factories and constructors share a limitation: they do not scale well to large numbers of optional parameters. Consider the case of a class representing the Nutrition
714
 often, which is a good thing, as explicit type parameters aren’t very pretty. With the addition of this explicit type parameter, the program compiles cleanly: Set<Number> numbers = Union.<Number>union(integers, doubles);  Next let’s turn our attention
715
 union method from Item 27. Here is the declaration: public static <E> Set<E> union(Set<E> s1, Set<E> s2)  Both parameters, s1 and s2, are E producers, so the PECS mnemonic tells us that the declaration should be: public static <E> Set<E> union(Set<?
716
 failure for subsequent analysis. To capture the failure, the detail message of an exception should contain the values of all parameters and fields that “contributed to the exception.” For example, the detail message of an IndexOutOfBoundsException
717
 depends on the tag value. In the Figure class, there is only one such method, which is area. This abstract class is the root of the class hierarchy. If there are any methods whose behavior does not depend on the value of the tag, put them in this
718
 pattern, 307, 312 non-blocking concurrency control, 270 nonhierarchical type frameworks, 93 noninstantiable classes, 7, 19 non-nullity in equals contract, 41 nonreifiable types, 120, 125, 127 nonserializable class, with serializable subclass, 292
719
 try something odd: let’s write an observer that attempts to unsubscribe, but instead of calling removeObserver directly, it engages the services of another thread to do the deed. This observer uses an executor service (Item 68): // Observer that uses
720
 - the preferred approach public enum Elvis { INSTANCE; private String[] favoriteSongs = { "Hound Dog", "Heartbreak Hotel" }; public void printFavorites() { System.out.println(Arrays.toString(favoriteSongs)); } }  The use of readResolve for instance
721
 does not refine the contracts of any of the interface’s methods as such. Such a marker interface might describe some invariant of the entire object or indicate that instances are eligible for processing by a method of some other class (in the way that
722
 For example, if the multiplication were omitted from a String hash function, all anagrams would have identical hash codes. The value 31 was chosen because it is an odd prime. If it were even and the multiplication overflowed, information would be
723
 you choose for randomLongValue. You can generate the value by running the serialver utility on the class, but it’s also fine to pick a number out of thin air. If you modify an existing class that lacks a serial version UID, and you want the new
724
 the expression enclosingInstance.new MemberClass(args). As you would expect, the association takes up space in the nonstatic member class instance and adds time to its construction.  ITEM 22: FAVOR STATIC MEMBER CLASSES OVER NONSTATIC  One common use
725
 naming conventions for, 237–238 @param tag, 203–204 parameter lists of builders, 15 of constructors, 6  INDEX  long, 189–190 varargs and, 197–200 parameterized types, 109, 115 instanceof operator and, 114 reifiable, 120 parameterless
726
 vs. interfaces, 93–97 noninstantiability and, 19 for skeletal implementations, 91, 94 from tagged class, 101 Abstract Factory pattern, 15 AbstractList, 34, 88, 94 AbstractMap, 34, 94 AbstractSequentialList, 250 AbstractSet, 34, 94 access level, 67–70
727
 values or references to immutable objects (Item 15). A final field containing a reference to a mutable object has all the disadvantages of a nonfinal field. While the reference cannot be modified, the referenced object can be modified—with disastrous
728
 any exceptions thrown by the parameterless constructor, even though newInstance lacks the corresponding throws clauses. In other words, Class.newInstance breaks compile-time exception checking. The Builder interface, shown above, corrects these
729
 return type. This allows the overriding method to provide more information about the returned object and eliminates the need for casting in the client. Because Object.clone returns Object, PhoneNumber.clone must cast the result of super.clone()
730
 in the way of convenience. The compiler won’t complain if you pass an apple to a method that expects an orange, compare apples to oranges with the == operator, or worse: // Tasty citrus flavored applesauce! int i = (APPLE_FUJI - ORANGE_TEMPLE) /
731
 part of its exported API. Once you distribute a class widely, you are generally required to support the serialized form forever, just as you are required to support all other parts of the exported API. If you do not make the effort to design a custom
732
 an exception should contain the values of all parameters and fields that “contributed to the exception.” For example, the detail message of an IndexOutOfBoundsException should contain the lower bound, the upper bound, and the index value that failed to
733
 constructor, 61 Cloneable, 54–61, 90, 195, 246 alternatives to, 61 behavior of, 54 designing for inheritance and, 90 example, 57–58  extralinguistic mechanisms, 54, 61 implementing, 60 purpose of, 54 CloneNotSupportedException, 54, 60, 246 @code
734
 exceptions that each method throws, but if the latter class is revised to throw additional unchecked exceptions, it is quite likely that the former class (which has not undergone revision) will propagate the new unchecked exceptions even
735
 Language, Fourth Edition. Addison-Wesley, Boston, 2005. ISBN: 0321349806.  [Asserts]  Programming with Assertions. Sun Microsystems. 2002. <http://java.sun.com/javase/6/docs/technotes/guides/language/ assert.html>  [Beck99]  Beck, Kent. Extreme
736
 declared along with other members, it is simultaneously declared and instantiated at the point of use. Anonymous classes are permitted at any point in the code where an expression is legal. Anonymous classes have enclosing instances if and only if
737
 that may be thrown in the same context. While the language does not require programmers to declare the unchecked exceptions that a method is capable of throwing, it is wise to document them as carefully as the checked exceptions. Unchecked exceptions
738
 ArrayIndexOutOfBoundsException. Luckily, there is a much better way to achieve the same effect. The array is effectively serving as a map from the enum to a value, so you might as well use a Map. More specifically, there is a very fast Map
739
 Let the client synchronize externally where it is appropriate. In the early days of the Java platform, many classes violated these guidelines. For example, StringBuffer instances are almost always used by a single thread, yet they perform
740
 is a powerful facility that is required for certain sophisticated system programming tasks, but it has many disadvantages. If you are writing a program that has to work with classes unknown at compile time, you should, if at all possible, use
741
 This means you also give up the ability to enforce invariants involving the field. Also, you give up the ability to take any action when the field is modified, so classes with public mutable fields are not thread-safe. Even if a field is final and
742
 and runtime exceptions for programming errors. Of course, the situation is not always black and white. For example, consider the case of resource exhaustion, which can be caused by a programming error such as allocating an unreasonably large
743
 Flyweight pattern, 6 footprint See space consumption for loops vs. for-each loops, 212–214 vs. while loops, 210 for-each loops, 212–214 formal type parameters, 109, 115 forward compatibility, 299 See also compatibility forwarding, 83–85, 95
744
 SuppressWarnings annotation and, 117 return types, wildcard types and, 137 return values, interface types for, 228 rogue object reference attack, 304, 307 RoundingMode, 151  RPCs, reflection and, 230 rules accessibility, 68–69, 106 choosing
745
 words, confine mutable data to a single thread. If you adopt this policy, it is important to document it, so that it is maintained as your program evolves. It is also important to have a deep understanding of the frameworks and libraries you’re
746
 method is required, the best way to fix the program is to replace all three overloadings of classify with a single method that does an explicit instanceof test: public static String classify(Collection<?> c) { return c instanceof Set ? "Set" : c
747
 if a check fails. The checks should follow any defensive copying. • If an entire object graph must be validated after it is deserialized, use the ObjectInputValidation interface [JavaSE6, Serialization]. • Do not invoke any overridable methods in
748
 hoursWorked, double payRate) { double basePay = hoursWorked * payRate; return basePay + overtimePay(hoursWorked, payRate); } } }  If switch statements on enums are not a good choice for implementing constant-specific behavior on enums, what are
749
 if (m.isAnnotationPresent(ExceptionTest.class)) { tests++; try { m.invoke(null); System.out.printf("Test %s failed: no exception%n", m); } catch (Throwable wrappedExc) { Throwable exc = wrappedExc.getCause(); Class<? extends Exception>[]
750
 { if (init.get() != State.INITIALIZED) throw new IllegalStateException("Uninitialized"); } ... // Remainder omitted }  All public and protected instance methods in AbstractFoo must invoke checkInit before doing anything else. This ensures that
751
 and from these two attributes you can compute its surface gravity. This in turn lets you compute the weight of an object on the planet’s surface, given the mass of the object. Here’s how this enum looks. The numbers in parentheses after each enum
752
 to rectangle. Also include in each subclass the appropriate implementation of each abstract method in the root class. Here is the class hierarchy corresponding to the original Figure class: // Class hierarchy replacement for a tagged class abstract
753
 a finalizer for a class whose objects encapsulate resources that require termination, such as files or threads? Just provide an explicit termination method, and require clients of the class to invoke this method on each instance when it is no longer
754
  [Gamma95]  Gamma, Erich, Richard Helm, Ralph Johnson, and John Vlissides. Design Patterns: Elements of Reusable Object-Oriented Software. Addison-Wesley, Reading, MA, 1995. ISBN: 0201633612.  [Goetz06]  Goetz, Brian, with
755
 In both of the previous examples (the exception and the deadlock) we were lucky. The resource that was guarded by the synchronized region (observers) was in a consistent state when the alien method (added) was invoked. Suppose you were to invoke
756
 the type hierarchy where it subclasses an ancestor of both classes. Unfortunately, this causes great collateral damage to the type hierarchy, forcing all descendants of the common ancestor to extend the new abstract class whether or not it is
757
 and add a value component. For example, java.sql.Timestamp extends java.util.Date and adds a nanoseconds field. The equals implementation for Timestamp does violate symmetry and can cause erratic behavior if Timestamp and Date objects are used in the
758
 it contains no casts and compiles without errors or warnings: // Sample program to exercise generic singleton public static void main(String[] args) { String[] strings = { "jute", "hemp", "nylon" }; UnaryFunction<String> sameString =
759
 of runnable threads down is to have each thread do some useful work and then wait for more. Threads should not run if they aren’t doing useful work. In terms of the Executor Framework (Item 68), this means sizing your thread pools appropriately
760
 it prints “Fri Jan 01 12:00:00 PST 1999 - Sun Jan 01 12:00:00 PST 1984.” Simply declaring Period serializable enabled us to create an object that violates its class invariants. To fix this problem, provide a readObject method for Period that calls
761
 doc comments, although this is rare. Also notice the use of the Javadoc {@code} tag around the code fragment in the @throws clause. This serves two purposes: it causes the code fragment to be rendered in code font, and it suppresses processing of
762
 Principle [Naftalin07, 2.4]. With this mnemonic in mind, let’s take a look at some method declarations from previous items. The reduce method in Item 25 has this declaration: static <E> E reduce(List<E> list, Function<E> f, E initVal)  Although lists
763
 value (so long as there are no more than 232 invocations). The method’s state consists of a single atomically accessible field, nextSerialNumber, and all possible values of this field are legal. Therefore, no synchronization is necessary to protect
764
 threads or static initializers. By convention, a method that invokes overridable methods contains a description of these invocations at the end of its documentation comment. The description begins with the phrase “This implementation.” This phrase
765
 hashCode and, 49 JavaBeans and, 13 object reuse and, 20 readObject and, 302–306 rules for, 73 serialization and, 79, 302–307 static factory methods and, 77 thread safety and, 278 Immutable annotation, 279  INDEX  immutable, level of thread safety,
766
 Sun Microsystems. 2008. <http://java.sun.com/javase/6/webnotes/features.html>  REFERENCES  [JavaBeans]  JavaBeans™ Spec. Sun Microsystems. March 2001. <http://java.sun.com/products/javabeans/docs/spec.html>  [Javadoc-5.0]  What’s New in
767
 257 parameter restrictions, 181 postconditions, 203 preconditions, 203, 252 required locks, 279–280 return value of toString, 52 self-use of overridable methods, 87, 92 serialized fields, 296 side effects, 203 static factories, 10 SuppressWarnings
768
 superclasses provide a well-behaved clone implementation, whether public or protected. Suppose you want to implement Cloneable in a class whose superclasses provide well-behaved clone methods. The object you get from super.clone() may or may not be
769
 more secure. To make a class immutable, follow these five rules: 1. Don’t provide any methods that modify the object’s state (known as mutators). 2. Ensure that the class can’t be extended. This prevents careless or malicious subclasses from
770
 of that object terminates [JLS, 12.6]. Uncaught exceptions can leave objects in a corrupt state. If another thread attempts to use such a corrupted object, arbitrary nondeterministic behavior may result. Normally, an uncaught exception will
771
 The object reference returned by this method is then returned in place of the newly created object. In most uses of this feature, no reference to the newly created object is retained, so it immediately becomes eligible for garbage collection. If the
772
 fields of the class represented by the Class instance. These objects provide programmatic access to the class’s member names, field types, method signatures, and so on. Moreover, Constructor, Method, and Field instances let you manipulate their
773
 ill-structured system that is difficult to maintain and evolve. Therefore you must think about performance during the design process. Strive to avoid design decisions that limit performance. The components of a design that are most difficult to change
774
 often final and rarely have corresponding interfaces. It is perfectly appropriate to use such a value class as a parameter, variable, field, or return type. More generally, if a concrete class has no associated interface, then you have no choice but
775
 with a private constructor  4  5, Avoid creating unnecessary objects  5  6, Eliminate obsolete object references  6  7, Avoid finalizers  7  8, Obey the general contract when overriding equals  8  9, Always override hashCode when you
776
 on Integer, which you get without a comparator, but it makes for an interesting example: // Broken comparator - can you spot the flaw? Comparator<Integer> naturalOrder = new Comparator<Integer>() { public int compare(Integer first, Integer second)
777
 direct equivalent in Design Patterns. A class can provide its clients with static factory methods instead of, or in addition to, constructors. Providing a static factory method instead of a public constructor has both advantages and disadvantages. One
778
 take the form of an ArrayIndexOutOfBoundsException, a NullPointerException, or (worse) silent erroneous behavior. And the size of the table is quadratic in the number of phases, even if the number of non-null entries is smaller. Again, you can do much
779
 method and then restores transient fields to acceptable values (Item 76). Alternatively, these fields can be lazily initialized the first time they are used (Item 71). Whether or not you use the default serialized form, you must impose
780
 }  } } } } } } } } } } } } } } } }  ITEM 16: FAVOR COMPOSITION OVER INHERITANCE  The design of the InstrumentedSet class is enabled by the existence of the Set interface, which captures the functionality of the HashSet class. Besides being
781
 at just the core Spring Framework, we’d miss out on a wealth of potential afforded by the larger Spring portfolio. The whole Spring portfolio includes several frameworks and libraries that build upon the core Spring Framework and upon each other.
782
 access to TransactionManager is required.  PROPAGATION_SUPPORTS  Indicates that the current method doesn’t require a transactional context, but may run within a transaction if one is already in progress.  For example, if a method is declared to
783
 all treated as a single action, guaranteeing that either they’ll all fully succeed or all be rolled back as if these steps never happened. Figure 6.1 illustrates how this transaction plays out.  Download from Wow! eBook <www.wowebook.com>  148 
784
 Wow! eBook <www.wowebook.com>  Integrating Hibernate with Spring  135  save, update, delete, and load objects from the database. Through the Hibernate Session, an application’s DAO will perform all of its persistence needs. The standard way to get
785
  Externalizing configuration  Wiring JNDI resources in Spring  Sending email messages  Scheduling tasks  Asynchronous methods  I don’t know about your house, but many houses (including mine) have a so-called junk drawer. Despite its name, the
786
 By default the View object that InternalResourceViewResolver creates is an instance of InternalResourceView, which simply dispatches the request to the JSP for rendering. But since home.jsp uses some JSTL tags, we may choose to
787
 give Kenny a saxophone to play, you must declare it as a bean in the Spring container. The following XML should do: <bean id="saxophone" class="com.springinaction.springidol.Saxophone" />  Note that the Saxophone class has no properties that need to
788
  Here, we create a LinkedMultiValueMap and add an Accept header set to application /json. Then we construct an HttpEntity (with a generic type of Object), passing the MultiValueMap as a constructor argument. If this were a PUT or a POST request, we
789
 URI postForLocation(URI url, Object request) throws RestClientException;  To demonstrate postForLocation(), let’s try POSTing a Spitter again. This time, we want the resource’s URL in return: public String postSpitter(Spitter spitter) {
790
 types of requests. But here @RequestMapping is saying that all of those requests will have paths that start with /spitters. Within SpitterController we currently have a single method: listSpittlesForSpitter(). Like any good handler method, this
791
 in it. We can eliminate the explicit <bean> declarations from the XML configuration by using <context:component-scan> and annotating the Instrumentalist and Guitar classes with @Component. First, let’s annotate the Guitar class with @Component:
792
 Service 314, 316 destinations 312 message brokers 312 message listeners 326–327 message-driven POJOs 325, 327 point-to-point 313 publish-subscribe 313–314 synchronous 311 with Java Message Service 311, 332 MetadataMBeanInfoAssembler 340
793
 AOP introductions can help us out here without compromising design choices or requiring invasive changes to the existing implementations. To pull it off, you must use the <aop:declare-parents> element: <aop:aspect> <aop:declare-parents
794
 to have the knight embark on the quest that it was given. Note that this class knows nothing about which type of Quest our hero has. For that matter, it’s blissfully unaware of the fact that it’s dealing with BraveKnight. Only the knights.xml file
795
 System.out.println("While reciting..."); poem.recite(); } }  This new type of juggler does everything a regular juggler does, but it also has a reference to a poem to be recited. Speaking of the poem, here’s an interface that generically defines
796
  Inject SpitterService  Handle requests for home page  public String showHomePage(Map<String, Object> model) { model.put("spittles", spitterService.getRecentSpittles( DEFAULT_SPITTLES_PER_PAGE)); return "home";  Place spittles into model  Return view
797
 Once you’ve downloaded ActiveMQ, unzip it to your local hard drive. In the lib directory of the unzipped distribution, you’ll find activemqcore-5.4.2.jar. This is the JAR file you’ll need to add to the application’s classpath to be able to use
798
  Download from Wow! eBook <www.wowebook.com>  Automatically wiring bean properties  65  When used together, autowiring and autodiscovery can dramatically reduce the amount of XML Spring configuration. Often you’ll need only a handful of lines of XML,
799
  Reads and writes XML from/to javax.xml.transform.Source objects. Registered by default.  StringHttpMessageConverter  Reads all media types (*/*) into a String. Writes Strings to text/plain. Registered by default. 
800
 as follows:  Download from Wow! eBook <www.wowebook.com>  Wiring with annotations  73  <bean class="com.springinaction.springidol.Guitar"> <qualifier value="stringed" /> </bean>  Here the <qualifier> element qualifies the guitar bean as a stringed
801
 as de facto standards in the Java community. Leading the charge for lightweight POJO-based development is the Spring Framework, which we’ll explore throughout this book. In this chapter, we’ll explore the Spring Framework at a high level, giving
802
 point your web browser to www.manning.com/ SpringinActionThirdEdition. This page provides information on how to get on the forum once you are registered, what kind of help is available, and the rules of conduct on the forum. Manning’s commitment to
803
 20 coding to 44 ContextLoaderListener 179–180 DataSource 151 defining MBean operations and attributes with 339–340 DisposableBean 20, 40 EntityManagerFactory 139, 142, 152 FactoryBean 135 Filter 228 Future 373 hiding persistence layer 115
804
 talk about. That’s because the term property is highly overloaded. It’s important to keep the following straight:  <property> is the element used to inject a value or bean reference into a prop-  erty of a bean class.  <props> is the element used to
805
 that AlertServiceImpl is a simple POJO and has nothing that indicates that it’ll be used to handle JMS messages. It does implement the simple AlertService interface, as shown here: package com.habuma.spitter.alerts; import
806
 to the connectionFactory that’s to be used by each of the child <jms:listener>s as they listen for messages. In this case, the connectionFactory attribute could’ve been left off because it defaults to connectionFactory. Regarding the <jms:listener>
807
 RECEIVING RESOURCE STATE IN THE REQUEST BODY  On the other side of a RESTful conversation, a client may send us an object in the form of JSON, XML, or some other content type. It’d be inconvenient for our controller’s handler methods to receive
808
 />  Despite its unassuming appearance, what’s remarkable about Audience is that it has all the makings of an aspect. It just needs a little of Spring’s special AOP magic.  Download from Wow! eBook
809
 need to add the namespace declaration to the context definition XML file: <?xml version="1.0" encoding="UTF-8"?> <beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
810
 you’re using @AspectJ’s annotations, you’re still limited to proxying method invocations. If you want to be able to exploit the full power of AspectJ, you’ll have to use the AspectJ runtime and not rely on Spring to create proxy-based aspects.
811
 defaults have reduced Spring configuration from page upon page of XML down to only a handful of elements. But make no mistake: though there are fewer pages, I’ve still managed to pack a lot of new Spring goodness into them. Along with the dependency
812
  58  CHAPTER 2  Wiring beans  LOGICAL EXPRESSIONS  It’s great that we can evaluate comparisons in SpEL, but what if you need to evaluate based on two comparisons? Or what if you want to negate some Boolean value? That’s where the logical operators
813
 placed into the model to the various fields in the form. The <sf:input>, <sf:password>, and <sf:checkbox> tags each have a path attribute that references the property of the Spitter object that the form is bound to. When the form is
814
 bet that you’re already dreaming up interesting security constraints based on SpEL. But for now, let’s look at another one of <intercept-url>’s tricks: enforcing channel security. FORCING REQUESTS TO HTTPS  Submitting data across HTTP can be a risky
815
 state in response to some exception being thrown. For example, if a customer record can’t be found, you may want the flow to transition to a view state that presents a registration form. The following snippet shows that kind of transition:
816
 database operations without all of the ceremony required by traditional JDBC. For example, using Spring’s SimpleJdbcTemplate (a specialization of JdbcTemplate that takes advantage of Java 5 features), the getEmployeeById() method can be rewritten so
817
 a pure JPA-based DAO. So, let’s take one more stab at developing a SpitterDao implementation, this time using JPA.  5.5  Spring and the Java Persistence API From its beginning, the EJB specification has included the concept of entity beans. In EJB,
818
 that they’re truly junk and have no value—it’s that they don’t have a place otherwise. We’ve covered a lot of ground so far in this book and have explored several corners of working with Spring. Each topic has had a chapter of its own. But there are
819
 implements NotificationPublisherAware. This isn’t a demanding interface. It requires only that a single method be implemented: setNotificationPublisher. SpittleNotifierImpl also implements a single method from the SpittleNotifier interface,1
820
 MVC controller (more on that in a moment) that receives Hessian requests and translates them into method calls on the exported POJO.  Request  Dispatcher servlet  dispatches to  HessianService Exporter  SpitterServiceImpl  Figure 10.6
821
 name. When adding a List of Spittles, it tacks List to the end the member type of the List, naming the attribute spittleList. We’re almost ready to call listSpittlesForSpitter() done. We’ve written the SpitterController and a handler method. All
822
 Security’s filter-based web security support  At the least, you’ll want to include the Core and Configuration modules in your application’s classpath. Spring Security is often used to secure web applications. That’s certainly the case with the Spitter
823
 so, they also had to implement a few EJB lifecycle callback methods. Put simply, EJB 2 MDBs were very un-POJO. With the EJB 3 specification, MDBs were cleaned up to have a slightly more POJO feel to them. No longer must you implement the
824
 And, if the subflow ends with an <end-state> whose ID is orderCreated, then the flow will transition to the state whose ID is payment. But I’m getting ahead of myself. We haven’t talked about the <end-state> element or transitions yet. But we’ll
825
 objects as remote services. You’ll also learn how to seamlessly access remote services as though they were any other object in your application. Remoting technologies explored will include RMI, Hessian/Burlap, SOAP-based web services, and
826
 SpittleNotifierImpl implements NotificationPublisherAware. This isn’t a demanding interface. It requires only that a single method be implemented: setNotificationPublisher. SpittleNotifierImpl also implements a single method from the SpittleNotifier
827
 obscure branch of your application’s code. In that situation, it may not be desirable to load the object until it’s actually needed. By default, <jee:jndi-lookup> fetches objects from JNDI when the application context is started. Nevertheless, you can
828
 import javax.jws.WebMethod; import javax.jws.WebService; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Component; import com.habuma.spitter.domain.Spitter; import
829
 autowiring to choose from. Maybe it’s an abundance of (or at least two) beans, each of which is equally qualified to be wired into a property or parameter. For example, suppose you have two beans that implement Instrument. In that event, there’s no
830
 method, using RestTemplate to dramatically simplify it and eliminate the boilerplate. But first, let’s take a high-level survey of all of the REST operations that RestTemplate offers.  11.4.1 Exploring RestTemplate’s operations You’ll recall from
831
 to search for users and groups. By default, the base queries for both users and groups are empty, indicating that the search will be done from the root of the LDAP hierarchy. But we can change that by specifying a query base: <ldap-user-service
832
 Spring Web Flow 200, 203 InstanceAlreadyExistsException 342 instrumentalist example 41, 47, 66–67, 69, 71–73, 78 <intercept-url> element 237 access attribute 233 pattern attribute 229, 232 requires-channel attribute 234
833
 controller. To register a multipart resolver in Spring, we need to declare a bean that implements the MultipartResolver interface. Our choice of multipart resolvers is made easy by the fact that Spring only comes with one: CommonsMultipartResolver.
834
 blend in with. The most practical way to communicate your status and still catch your plane is to send a quick email to your boss and your colleagues, detailing your progress and promising to send a postcard. You don’t know where they are or when
835
 Security expression  What it evaluates to  authentication  The user’s authentication object  denyAll  Always evaluates to false  hasAnyRole(list of roles)  true if the user has been granted any of the roles specified  hasRole(role)  true if the user
836
 SimpleJdbcTemplate (a specialization of JdbcTemplate that takes advantage of Java 5 features), the getEmployeeById() method can be rewritten so that its focus is on the task of retrieving employee data and not catering to the demands of the JDBC
837
 sent with JMS are data-centric. This means that the client isn’t fixed to a specific method signature. Any queue or topic subscriber that can process the data sent by the client can process the message. The client doesn’t need to be aware of any
838
 LinkedMultiValueMap class 305 <list> element 47 inside another <list> 49 values 48 <listener> element 180 listeners, for notifications 348–349 load-time weaving. See classload-time weaving LocalContainerEntityManagerFactoryBean 139–140
839
 aspects with dependencies just as if they were another bean.  Listing 4.9  An AspectJ implementation of a talent competition judge  package com.springinaction.springidol; public aspect JudgeAspect { public JudgeAspect() {} pointcut performance() :
840
 beans at runtime by wrapping them with a proxy class. As illustrated in figure 4.3, the proxy class poses as the target bean, intercepting advised method calls and forwarding those calls to the target bean. Between the time when the proxy
841
 as well as application/json. The leaves a lot of room for the server to decide which format to send the resource back as. Suppose that we want to demand that the server send the response back as JSON. In that case, we need to specify application /json
842
 code to look up the JNDI name from the properties file. Upon closer inspection we find that most of the code is boilerplate JNDI lookup that looks much the same for all JNDI lookups. Only one line is directly responsible for retrieving the data
843
 receive() method, as shown. Listing 12.4  Receiving a message using JmsTemplate  public Spittle getAlert() { try { ObjectMessage receivedMessage = (ObjectMessage) jmsTemplate.receive(); return (Spittle) receivedMessage.getObject(); } catch
844
 Fortunately, you don’t need to deal with those details when using Spring to access EJB 2 session beans. Instead of using <jee:jndi-lookup>, Spring offers two other elements in the jee namespace that are expressly for accessing EJBs: 
845
 of Spring configuration, the method name approach doesn’t scale well when exporting multiple MBeans. Let’s see if using interfaces to expose MBean operations and attributes would be any better.  13.1.2 Using interfaces to define MBean operations and
846
  As you can see, SpEL’s ternary operator works the same as Java’s ternary operator. In this case, the instrument property will be wired with a reference to the piano bean if the song selected is “Jingle Bells.” Otherwise,
847
 </value> </property> </bean>  An alternative to Hessian’s binary protocol is Burlap’s XML-based protocol. Let’s see how to export a service as a Burlap service. EXPORTING A BURLAP SERVICE  BurlapServiceExorter is
848
 READ-ONLY  The third characteristic of a declared transaction is whether it’s a read-only transaction. If a transaction performs only read operations against the underlying data store, the data store may be able to apply certain optimizations
849
 RestTemplate and how each of the variant forms work, you’ll be well on your way to writing resource-consuming REST clients. Let’s survey RestTemplate’s operations by looking at those that support the four primary HTTP methods: GET, PUT, DELETE, and
850
 provide a different implementation of SpitterService from some other source. Ideally, you should be able to inject a SpitterService object into any bean that needs one instead of having the bean look up the service itself. Using DI, any client of
851
 DispatcherServlet’s Spring application context won’t know where to find a SpitterService bean. Fortunately, it’s an easy fix.  7.2.5  Rounding out the Spring application context As I mentioned earlier, DispatcherServlet loads its Spring application
852
 We’ve seen how to retrieve objects from JNDI using Spring’s <jee:jndi-lookup> element. So let’s use that to reference a mail session from JNDI: <jee:jndi-lookup id="mailSession" jndi-name="mail/Session" resource-ref="true" />  With the mail sender in
853
 appoint bean methods as managed operations and attributes. I could show you how to use that assembler, but I won’t. That’s because wiring it up manually is burdensome and not worth the trouble just to be able to use annotations. Instead, I’m going to
854
 find it particularly useful. While I will guide you along gently through code examples that build in complexity throughout each chapter, the true power of Spring lies in its ability to make enterprise applications easier to develop. Therefore,
855
 goes over all kinds of intricate gadgets, from rolling down a curvy ramp to springing off a teeter-totter to spinning on a miniature Ferris wheel to being kicked out of a bucket by a rubber boot. It goes through all of this to spring a trap on a poor,
856
 to say the same thing while we were standing on Jupiter, you’d be justified in asking which of the planet’s 63 natural satellites I had in mind. But on Earth, there’s no ambiguity.1 Similarly, when it comes to wiring bean properties, it’s sometimes
857
 before and after advice 95 Declaring around advice 97 Passing parameters to advice 98 Introducing new functionality with aspects 100 ■  ■  4.4  ■  Annotating aspects 102 Annotating around advice 104 Passing arguments to annotated advice 105
858
 to an Instrument that the instrumentalist will play. An Instrument is defined by the following interface: package com.springinaction.springidol; public interface Instrument { public void play(); }  Because the Instrumentalist class has a default
859
 property: <bean id="kenny" class="com.springinaction.springidol.Instrumentalist" autowire="byName"> <property name="song" value="Jingle Bells" /> </bean>  byName autowiring establishes a convention where a property will automatically be wired
860
 transaction is whether it’s a read-only transaction. If a transaction performs only read operations against the underlying data store, the data store may be able to apply certain optimizations that take advantage of the read-only nature of the
861
 data-source-ref 240 defaultImpl 107 default-impl 102 default-init-method 41 default-ref 361 defining with interfaces 339–340 delegate-ref 102 destroy-method 40 else 205 expression 79, 204 factory-method 37, 109 fixedDelay 371 fixedRate 371
862
 lifecycle by implementing several lifecycle callback methods (those methods that start with ejb). Or I should rephrase that to say that the SessionBean interface would force you to hook into the EJB’s lifecycle, even if you didn’t need to. The bulk
863
 a <form> tag whose method attribute is set to PUT or DELETE, accounting for older browsers will require sneaking the request to the server as a POST. Within an HTML form, the key to masquerading a PUT or DELETE request as a POST is to create a form
864
 The four HTTP methods described in table 11.1 are often mapped to CRUD (create/read/update/delete) operations. Certainly the GET method performs a read operation and the DELETE method performs a delete operation. And, even though PUT and POST can
865
 in on the status of the result by calling isDone() and isCancelled().  14.5 Summary In this chapter, we’ve covered a mixed bag of topics—Spring features that, by themselves, didn’t have a home in any other chapter. We started by looking at how to
866
 beans. To use the <aop:aspectj-autoproxy> configuration element, you’ll need to remember to include the aop namespace in your Spring configuration file: <beans xmlns="http://www.springframework.org/schema/beans"
867
 container, an EntityManagerFactory can be produced using information provided by the container—Spring, in our case. Instead of configuring data source details in persistence.xml, you can configure this information in the Spring application context.
868
 Spring provides for building enterprise applications. Most applications ultimately persist business information in a relational database. Chapter 5, “Hitting the database,” will guide you in using Spring’s support for data persistence. You’ll be
869
 web services.  10.5 Publishing and consuming web services One of the most hyped TLAs (three-letter acronyms) in recent years is SOA (which stands for service-oriented architecture). SOA means many things to different people. But at the center of
870
 with ROLE_ADMIN authority. You can use as many <intercept-url> entries as you like to secure various paths in your web application. But it’s important to know that the <intercept-url> rules are  Download from Wow! eBook <www.wowebook.com>  233 
871
 Java developers will find it particularly useful. While I will guide you along gently through code examples that build in complexity throughout each chapter, the true power of Spring lies in its ability to make enterprise applications easier to
872
 duplicate copies of the same message. But each service could process that message differently. For example, let’s say you have a set of services which together process a message that details the new hire of an employee. One service might add
873
 queries.  NamedParameterJdbcTemplate—This JDBC template class enables you to per-  form queries where values are bound to named parameters in SQL, rather than indexed parameters.  SimpleJdbcTemplate—This version of the JDBC template
874
 beans as RMI services over JRMP, HessianExporter and BurlapExporter for Hessian and Burlap services over HTTP, and HttpInvokerServiceExporter to create HTTP invoker services over HTTP. But Spring has one more service exporter that we didn’t talk
875
 value="${spittle.text}" /><br/> <c:out value="${spittle.when}" /> </td> </tr> </c:forEach> </table> </div>  Aesthetics aside, this JSP does what we need. Near the top, it displays a header indicating who the list of Spittles belongs to. This header
876
 an application. Pointcuts help narrow down the join points advised by an aspect. If advice defines the what and when of aspects, then pointcuts define the where. A pointcut definition matches one or more join points at which advice should be woven.
877
 PROPERTIES COLLECTIONS  When declaring a Map of values for OneManBand’s instrument property, it was necessary to specify the value of each entry using value-ref. That’s because each entry is ultimately another bean in the Spring context. But if
878
 to be used by other tile definitions. Listing 7.4  Tiles defined  <!DOCTYPE tiles-definitions PUBLIC "-//Apache Software Foundation//DTD Tiles Configuration 2.1//EN" "http://tiles.apache.org/dtds/tiles-config_2_1.dtd">  Define
879
 and private keyword 71 and setter methods 71 annotating properties with 71 custom qualifiers 73–74 @Inject 74 optional autowiring with 71 @Qualifier annotation 72 required attribute 72 autowiring ambiguous dependencies 72–73 autodetect 65, 68
880
 Spring’s JmsTemplate can do the same thing for JMS boilerplate code.  12.3.2 Working with JMS templates JmsTemplate is Spring’s answer to verbose and repetitive JMS code. JmsTemplate takes care of creating a connection, obtaining a session, and
881
  InvalidDestinationException  InvalidSelectorException  InvalidSelectorException  JmsSecurityException  JmsSecurityException  ListenerExecutionFailedException  Spring-specific—thrown when execution of a listener method fails 
882
 APIs, boilerplate code 15 Java Community Process, JSR-330 74 Java Data Objects 22, 138, 150 Java Management Extensions 334, 349 and remoting 343, 346 JMX Messaging Protocol 343 JSR-160 343 notifications 346, 349 Java Message Service 23, 311, 332 and
883
  CHAPTER 8  Working with Spring Web Flow  should be fired. When the form is submitted by clicking that button, a phoneEntered event will be fired, triggering a transition to lookupCustomer. LOOKING UP THE CUSTOMER  After the welcome form has been
884
 XML should do the trick: <bean id="jmsTemplate" class="org.springframework.jms.core.JmsTemplate"> <property name="connectionFactory" ref="connectionFactory" /> </bean>  Because JmsTemplate needs to know how to get connections to the message
885
 request, returning the Allow header for the specified URL.  postForEntity()  POSTs data, returning a ResponseEntity that contains an object mapped from the response body.  postForLocation()  POSTs data, returning the URL of the new resource. 
886
 implements the service. Here, that’s a reference to the spitterService bean. The serviceInterface is set to indicate that SpitterService is the interface that the service implements. Unlike RmiServiceExporter, we don’t need to get a serviceName
887
 bean or any of the filters it chains together. Spring Security will automatically create those beans for us when we configure the <http> element, which we’ll do next.  9.2.2  Configuring minimal web security Early versions of Spring Security
888
 String values. The value attribute can also specify numeric (int, float, java.lang.Double, and so on) values as well as boolean values. For example, let’s pretend that the Instrumentalist class has an age property of type int to indicate the age of the
889
 a default spitter_avatar.png for all users. But real Spitter users will want more identity than some generic icon. To grant them more individuality, we’ll let them upload their profile photos as part of registration. To enable file uploads in the
890
 to create template-based abstractions around unnecessarily complex operations such as JDBC queries or JMS messaging. Spring LDAP brings Spring-style template-based access to LDAP, eliminating the boilerplate code that’s commonly involved in LDAP
891
 terms, a template method delegates the implementation-specific portions of the process to an interface. Different implementations of this interface define specific implementations of this portion of the process. This is the same pattern that
892
 JSR-250’s @RolesAllowed The @RolesAllowed annotation is equivalent to @Secured in almost every way. The only substantial difference is that @RolesAllowed is one of Java’s standard annotations as defined in JSR-250.5 This difference carries more
893
 SingleConnectionDataSource and DriverManagerDataSource are great for small applications and running in development, you should seriously consider the implications of using either in a production application. Because SingleConnectionDataSource has
894
 specify such a list as follows: <property name="packagesToScan"> <list> <value>com.habuma.spitter.domain</value> </list> </property>  But since I’m only asking it to scan a single package, I’m taking advantage of a built-in property editor that
895
 the basics of the Spring Framework. You’ve seen how to configure the Spring container and how to apply aspects to Spring-managed objects. As you’ve seen, these core techniques offer great opportunity to create applications composed of loosely coupled
896
 use in Word 2007 or 2010. If you’re using earlier versions of Word, choose File > Save As > Microsoft Word > Word 97-2003 Document to save a DOC file.  Tip: If you want to save only part of a PDF file as a Word document, select the part you want to
897
 97-2003 Document to save a DOC file.  Tip: If you want to save only part of a PDF file as a Word document, select the part you want to save and then right-click (Windows) or Control-click (Mac OS), choose Export Selection As, and then choose Word
898
 to save a DOC file.  Tip: If you want to save only part of a PDF file as a Word document, select the part you want to save and then right-click (Windows) or Control-click (Mac OS), choose Export Selection As, and then choose Word Document from the
899
 In most cases, Acrobat saves PDF files as Word documents with impressive integrity. However, depending on the way the document was created and originally encoded, you may need to adjust spacing or make minor corrections.  Next Steps:  Create
900
 to Word may take longer.  4. Evaluate the document in Word. Open the saved document in Microsoft Word, and scroll through it to confirm that text and images have been converted appropriately. In most cases, Acrobat saves PDF files as Word
901
 You can select options to include comments, images, run OCR (optical character recognition), and specify the language setting for OCR. Click OK to close the dialog box, and then click Save to save the file. Acrobat displays the status of the
902
 the status of the conversion process as it works. When you save complex PDF documents, the conversion to Word may take longer.  4. Evaluate the document in Word. Open the saved document in Microsoft Word, and scroll through it to confirm that text and
903
 Word > Word Document. The Word Document command saves the file in DOCX format, for use in Word 2007 or 2010. If you’re using earlier versions of Word, choose File > Save As > Microsoft Word > Word 97-2003 Document to save a DOC file.  Tip: If you
904
 the status of the conversion process as it works. When you save complex PDF documents, the conversion to Word may take longer.  4. Evaluate the document in Word. Open the saved document in Microsoft Word, and scroll through it to confirm that
905
 was originally created in a different application. 1. Open the PDF file in Acrobat. Open the PDF file you want to save.  2. Choose File > Save As > Microsoft Word > Word Document. The Word Document command saves the file in DOCX format, for use in
906
 displays the status of the conversion process as it works. When you save complex PDF documents, the conversion to Word may take longer.  4. Evaluate the document in Word. Open the saved document in Microsoft Word, and scroll through it to confirm that
907
 Open the saved document in Microsoft Word, and scroll through it to confirm that text and images have been converted appropriately. In most cases, Acrobat saves PDF files as Word documents with impressive integrity. However, depending on the way
908
 for use in Word 2007 or 2010. If you’re using earlier versions of Word, choose File > Save As > Microsoft Word > Word 97-2003 Document to save a DOC file.  Tip: If you want to save only part of a PDF file as a Word document, select the part you want to
909
 Control-click (Mac OS), choose Export Selection As, and then choose Word Document from the Save As Type or Format menu.  3. Specify settings, and then save the file. In the Save As dialog box, click Settings. Select Retain Flowing Text or Retain Page
910
 on your priority. You can select options to include comments, images, run OCR (optical character recognition), and specify the language setting for OCR. Click OK to close the dialog box, and then click Save to save the file. Acrobat displays the
911
 click Settings. Select Retain Flowing Text or Retain Page Layout, depending on your priority. You can select options to include comments, images, run OCR (optical character recognition), and specify the language setting for OCR. Click OK to close the
912
 DOC file.  Tip: If you want to save only part of a PDF file as a Word document, select the part you want to save and then right-click (Windows) or Control-click (Mac OS), choose Export Selection As, and then choose Word Document from the Save As Type
913
 on your priority. You can select options to include comments, images, run OCR (optical character recognition), and specify the language setting for OCR. Click OK to close the dialog box, and then click Save to save the file. Acrobat displays the
914
 As > Microsoft Word > Word 97-2003 Document to save a DOC file.  Tip: If you want to save only part of a PDF file as a Word document, select the part you want to save and then right-click (Windows) or Control-click (Mac OS), choose Export Selection
915
 may take longer.  4. Evaluate the document in Word. Open the saved document in Microsoft Word, and scroll through it to confirm that text and images have been converted appropriately. In most cases, Acrobat saves PDF files as Word documents with
916
 the language setting for OCR. Click OK to close the dialog box, and then click Save to save the file. Acrobat displays the status of the conversion process as it works. When you save complex PDF documents, the conversion to Word may take longer. 
917
 process as it works. When you save complex PDF documents, the conversion to Word may take longer.  4. Evaluate the document in Word. Open the saved document in Microsoft Word, and scroll through it to confirm that text and images have been
918
 in DOCX format, for use in Word 2007 or 2010. If you’re using earlier versions of Word, choose File > Save As > Microsoft Word > Word 97-2003 Document to save a DOC file.  Tip: If you want to save only part of a PDF file as a Word document, select
919
 the Save As dialog box, click Settings. Select Retain Flowing Text or Retain Page Layout, depending on your priority. You can select options to include comments, images, run OCR (optical character recognition), and specify the language setting for
920
 for OCR. Click OK to close the dialog box, and then click Save to save the file. Acrobat displays the status of the conversion process as it works. When you save complex PDF documents, the conversion to Word may take longer.  4. Evaluate the document
921
 your priority. You can select options to include comments, images, run OCR (optical character recognition), and specify the language setting for OCR. Click OK to close the dialog box, and then click Save to save the file. Acrobat displays the status
922
 > Word 97-2003 Document to save a DOC file.  Tip: If you want to save only part of a PDF file as a Word document, select the part you want to save and then right-click (Windows) or Control-click (Mac OS), choose Export Selection As, and then choose
923
 East Coast Lagoon Food Centre, for example, houses numerous satay stalls, as well as some that sell cold sugar cane juice... The ambience here is really lovely and you can have your food 'alfresco', under the swaying coconut palms... Open
924
 folks who decided to span their wings...). . Food Courts are typically more expensive (and somewhat less authentic) than Hawker Centres, and their main advantage is their location within the city's large shopping malls, which means they make a
925
 Mandarin Hotel, 333 Orchard Road Tel: 6831 6291  Open daily, 10 am - 10 pm  Nestled in a classic shophouseone, Garibaldi has been around for quite some time and still retains its position as one of Singapore's most sought after restaurants. The menu
926
 Nos. 14 or 16 travel to Katong from Orchard Road (Lucky Plaza, Midpoint Orchard, or Concorde Hotel), as well as from Raffles Hotel (Bras Basah side). Routes 10 and 10-e come here from Fullerton Square (near the Merlion Statue).  Singapore Zoo and
927
 Universal Studios This stately casino-resort boasts some fabulous restaurants, cafés and shops, as well as world-class entertainment spectacles like the "Lake of Dreams" (integrating sound and light effects, pyrotechnics and water) and the very popular
928
 the classic Fullerton Hotel, to the Merlion fountain-statue, one of Singapore's most recognized landmarks. We will then cross the river on historic Cavenagh Bridge and visit "Raffles Landing Site", before entering the Asian Civilisations Museum,
929
 town or elsewhere, but in spite of the inconvenience, it is still a fairly quick and inexpensive way of travelling to/from the airport (Daily, 5:30am – after 11pm).  The MRT (Mass Rapid Transit ) is Singapore's fastest and most comfortable means of
930
  MRT: Orchard  Fish Head Curry is the "specialite de la maison" here, but there are many other curry specialties you can try...  Blu  Open daily for lunch and dinner  Praised by both Wine & Dine and Tatler magazines as one of Singapore's best
931
  Tel: 6445 8833  East Coast Seafood Centre Tel: 6448 3636 MRT: Take a cab from Eunos-MRT  Raffles Hotel has made a name for itself as the ultimate place for "British colonialstyle high tea" in Singapore... The hotel is, indeed, one of the best
932
 all of the fonts, formatting, colours and graphics of any source document, regardless of the application and platform used to create it. Adobe PDF is an ideal format for electronic document distribution as it overcomes the problems commonly
933
 source document, regardless of the application and platform used to create it. Adobe PDF is an ideal format for electronic document distribution as it overcomes the problems commonly encountered with electronic file sharing. •  Anyone, anywhere can
934
 to create it. Adobe PDF is an ideal format for electronic document distribution as it overcomes the problems commonly encountered with electronic file sharing. •  Anyone, anywhere can open a PDF file. All you need is the free Adobe Acrobat Reader.
935
 PDF Files Adobe® Portable Document Format (PDF) is a universal file format that preserves all of the fonts, formatting, colours and graphics of any source document, regardless of the application and platform used to create it. Adobe PDF is an ideal
936
 used to create the documents.  •  PDF files always print correctly on any printing device.  •  PDF files always display exactly as created, regardless of fonts, software, and operating systems. Fonts, and graphics are not lost due to platform,
937
 Adobe® Portable Document Format (PDF) is a universal file format that preserves all of the fonts, formatting, colours and graphics of any source document, regardless of the application and platform used to create it. Adobe PDF is an ideal format for
938
 •  Anyone, anywhere can open a PDF file. All you need is the free Adobe Acrobat Reader. Recipients of other file formats sometimes can't open files because they don't have the applications used to create the documents.  •  PDF files always print
939
 platform, software, and version incompatibilities.  •  The free Acrobat Reader is easy to download and can be freely distributed by anyone.  •  Compact PDF files are smaller than their source files and download a page at a time for fast display on the
940
 and graphics are not lost due to platform, software, and version incompatibilities.  •  The free Acrobat Reader is easy to download and can be freely distributed by anyone.  •  Compact PDF files are smaller than their source files and download a
941
 Format (PDF) is a universal file format that preserves all of the fonts, formatting, colours and graphics of any source document, regardless of the application and platform used to create it. Adobe PDF is an ideal format for electronic document
942
 Adobe Acrobat Reader. Recipients of other file formats sometimes can't open files because they don't have the applications used to create the documents.  •  PDF files always print correctly on any printing device.  •  PDF files always display
943
 (PDF) is a universal file format that preserves all of the fonts, formatting, colours and graphics of any source document, regardless of the application and platform used to create it. Adobe PDF is an ideal format for electronic document
944
 file format that preserves all of the fonts, formatting, colours and graphics of any source document, regardless of the application and platform used to create it. Adobe PDF is an ideal format for electronic document distribution as it overcomes the
945
 correctly on any printing device.  •  PDF files always display exactly as created, regardless of fonts, software, and operating systems. Fonts, and graphics are not lost due to platform, software, and version incompatibilities.  •  The free Acrobat
946
 •  Anyone, anywhere can open a PDF file. All you need is the free Adobe Acrobat Reader. Recipients of other file formats sometimes can't open files because they don't have the applications used to create the documents.  •  PDF files always print
947
  •  PDF files always print correctly on any printing device.  •  PDF files always display exactly as created, regardless of fonts, software, and operating systems. Fonts, and graphics are not lost due to platform, software, and version
948
 3.2. The detailed steps of the AD algorithm for k-n-match search, namely “KNMatchAD”, is illustrated in Figure 4. Line 1 initializes some structures used in the algorithm. appear[i] maintains the number of appearances of point i. It has c elements,
949
 Then a database is a set of d-dimensional points, where d is the dimensionality. The notation used in this paper is summarized in Table 1 for easy reference.  2.1  The K -N -Match Problem For ease of illustration, we start with the simplest form of the
950
 AD algorithm for k-n-match search, namely “KNMatchAD”, is illustrated in Figure 4. Line 1 initializes some structures used in the algorithm. appear[i] maintains the number of appearances of point i. It has c elements, where c is the cardinality of the
951
 their performance deteriorates dramatically as dimensionality becomes high. [21] has shown this phenomenon both analytically and experimentally. Therefore, the authors of [21] proposed an algorithm based on compression, called the vector
952
 to access in each dimension, in both directions (attributes smaller than 2 We only use 1 byte for each element of appear[ ], which can work for up to 256 dimensions. For a data set of 1 million records, the memory usage is 1 Megabytes. This should be
953
 and an adaption from the VA-file algorithm for our problem in the following. We will use the VA-file based algorithm as a competitor when evaluating the efficiency of the AD algorithm in the experimental study.  4.1  Disk Based AD Algorithm  As we can
954
 here.  6.  RELATED WORK  A popular method for similarity search is to first extract from objects some features such as image colors [14], shapes [17] and texts [19], and then use nearest neighbor queries to search similar objects [10, 14]. In the last
